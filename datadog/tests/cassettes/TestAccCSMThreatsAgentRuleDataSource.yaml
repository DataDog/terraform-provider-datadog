---
version: 2
interactions:
    - id: 0
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 165
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: |
            {"data":{"attributes":{"description":"im a rule","enabled":false,"expression":"open.file.name == \"etc/shadow/password\"","name":"ztfkbnhtzk"},"type":"agent_rule"}}
        form: {}
        headers:
            Accept:
                - application/json
            Content-Type:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules
        method: POST
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"}}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 544.87025ms
    - id: 1
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"}}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 145.4045ms
    - id: 2
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"}}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 143.204667ms
    - id: 3
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"}}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 144.506417ms
    - id: 4
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":[{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"vg6-omq-vv4","attributes":{"version":1,"name":"wawhgdyumt","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295102041,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295102041,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"3yb-106-xrm","attributes":{"version":3,"name":"my_terraform_rule2","description":"my terraform rule","expression":"bind.addr.ip==1.6.1.9","category":"Kernel Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747140640989,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747141373736,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"rtp-dom-1am","attributes":{"version":1,"name":"agent_rule2","description":"My Agent rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":true,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747062863277,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747062863277,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"1vs-h3p-spa","attributes":{"version":1,"name":"000000bangtestnumber","description":"should_work_with_number","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702433529,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":60000000,"append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g5c-vnp-xf2","attributes":{"version":1,"name":"000000bangtest","description":"should_work_with_string","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702410743,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d4v-xci-tzk","attributes":{"version":1,"name":"000000second","description":"ahahaha","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743701600763,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"by5-5gy-ajb","attributes":{"version":2,"name":"kernel_module_load","description":"A kernel module was loaded","expression":"load_module.loaded_from_memory == false && load_module.name not in [\"nf_tables\", \"iptable_filter\", \"ip6table_filter\", \"bpfilter\", \"ip6_tables\", \"ip6table_nat\", \"nf_reject_ipv4\", \"ipt_REJECT\", \"iptable_raw\", \"udp_diag\", \"inet_diag\"] && process.ancestors.file.name not in [~\"falcon*\", \"unattended-upgrade\", \"apt.systemd.daily\", \"xtables-legacy-multi\", \"ssm-agent-worker\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737734329380,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"c5x-fzi-cfu","attributes":{"version":2,"name":"known_dll_registry_key_modified","description":"Windows Known DLLs location registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737044905726,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fcw-skn-8l6","attributes":{"version":1,"name":"shell_net_connection","description":"A shell made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && process.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"] && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980532395,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jwd-mhg-rzc","attributes":{"version":1,"name":"interpreter_outbound_connection","description":"An interpreter made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && process.file.name in [~\"python2*\", ~\"python3*\", \"node\", \"perl\", ~\"ruby*\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980527270,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7k7-mzh-fhj","attributes":{"version":1,"name":"irc_connection","description":"A process made an outbound IRC connection","expression":"connect.addr.port == 6667 && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980517121,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gff-p0p-hzz","attributes":{"version":1,"name":"p2pinfect_connection","description":"A process made a connection to a port associated with P2PInfect malware","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && connect.addr.port >= 60100 && connect.addr.port <= 60150","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980466118,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0yh-tmv-2ir","attributes":{"version":1,"name":"socat_shell","description":"Process arguments indicating possible socat shell detected","expression":"((exec.file.name == \"socat\") || (exec.comm == \"socat\")) && exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\", ~\"*exec*\", ~\"*pty*\", ~\"*setsid*\", ~\"*stderr*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536410363,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zwp-lhw-osb","attributes":{"version":1,"name":"udev_modification","description":"Device rule created","expression":"open.file.path in [~\"/etc/udev/rules.d/*\", ~\"/lib/udev/rules.d/*\", ~\"/usr/lib/udev/rules.d/*\", ~\"/usr/local/lib/udev/rules.d/*\", ~\"/run/udev/rules.d/*\"] && open.flags & O_CREAT > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405283,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"p4u-oh0-avq","attributes":{"version":1,"name":"devshm_execution","description":"A file executed from /dev/shm/ directory","expression":"exec.file.path == \"/dev/shm/**\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jdx-661-6he","attributes":{"version":1,"name":"ssh_nonstandard_connection","description":"SSH initiated a connection on a nonstandard port","expression":"connect.addr.port in [80, 8080, 88, 443, 8443, 4444] && process.file.name == \"ssh\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395054,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ozf-woz-u9t","attributes":{"version":2,"name":"libpam_ebpf_hook","description":"Library libpam.so hooked using eBPF","expression":"bpf.cmd == BPF_MAP_CREATE && process.args in [r\"libpam\\.so\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395021,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k02-h52-5kl","attributes":{"version":1,"name":"overwrite_entrypoint","description":"A process attempted to overwrite the container entrypoint","expression":"open.file.path == \"/proc/self/fd/1\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0 && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389957,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qwh-aci-cax","attributes":{"version":2,"name":"cron_at_job_creation_open","description":"An unauthorized job was added to cron scheduling","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389882,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cvg-paj-akm","attributes":{"version":2,"name":"cron_at_job_creation_chown","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chown.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536379705,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ecq-lqb-dko","attributes":{"version":1,"name":"find_credentials","description":"find command searching for sensitive files","expression":"exec.comm == \"find\" && exec.args in [~\"*credentials*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374661,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jig-hjw-dqq","attributes":{"version":1,"name":"webdriver_spawned_shell","description":"Browser WebDriver spawned shell","expression":"process.parent.file.name in [~\"chromedriver*\", \"geckodriver\"] && exec.file.name not in [\"chrome\", \"google-chrome\", \"chromium\", \"firefox\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374638,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cjg-f8o-kp3","attributes":{"version":2,"name":"tunnel_traffic","description":"Tunneling or port forwarding tool used","expression":"((exec.comm == \"pivotnacci\" || exec.comm == \"gost\") && process.args_flags in [\"L\", \"C\", \"R\"]) || (exec.comm in [\"ssh\", \"sshd\"] && process.args_flags in [\"R\", \"L\", \"D\", \"w\"] && process.args in [r\"((25[0-5]|(2[0-4]|1\\d|[1-9])\\d)\\.?\\b){4}\"] ) || (exec.comm == \"sshuttle\" && process.args_flags in [\"r\", \"remote\", \"l\", \"listen\"]) || (exec.comm == \"socat\" && process.args in [r\"(TCP4-LISTEN:|SOCKS)\"]) || (exec.comm in [\"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\", \"ssf\", \"3proxy\", \"ngrok\"] && process.parent.comm in [\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"])","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374597,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-5ct-v09","attributes":{"version":1,"name":"netcat_shell","description":"Process arguments indicating possible netcat shell detected","expression":"exec.file.name in [\"netcat\", \"nc\", \"ncat\"] && ((exec.args_flags in [\"l\"] && exec.args_flags in [\"p\"]) || (exec.args_flags in [\"n\"] && exec.args_flags in [\"v\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536369507,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qyq-78u-ql6","attributes":{"version":1,"name":"cups_spawned_shell","description":"Shell process spawned from print server","expression":"exec.file.name != \"\" && process.parent.file.name == \"foomatic-rip\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364424,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdw-b2j-bpy","attributes":{"version":1,"name":"debugfs_in_container","description":"The debugfs was executed in a container","expression":"exec.comm == \"debugfs\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364396,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dt3-f0b-e8d","attributes":{"version":1,"name":"webapp_imds_V1_request","description":"Web application requested IMDSv1 credentials","expression":"imds.aws.is_imds_v2 == false && imds.url =~ \"*/*/meta-data/iam/security-credentials/*\" && (process.ancestors.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.ancestors.file.name =~ \"php*\" || process.ancestors.file.name == \"java\")","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359279,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dat-hhr-7xk","attributes":{"version":2,"name":"cron_at_job_creation_link","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (link.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || link.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-hyn-s1j","attributes":{"version":1,"name":"release_agent_escape","description":"Container escape attempted by overwriting release_agent","expression":"open.file.name == \"release_agent\" && open.file.path in [\"/tmp/**\", \"/home/**\", \"/root/**\", \"/*\"] && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354195,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vvo-iqz-sr2","attributes":{"version":1,"name":"file_sync_exfil","description":"The rclone utility was executed","expression":"exec.file.name in [\"rclone\", \"rsync\", \"sftp\", \"ftp\", \"scp\", \"dcp\", \"rcp\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354189,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-jbt-ag7","attributes":{"version":1,"name":"unshare_in_container","description":"The unshare utility was executed in a container","expression":"exec.comm == \"unshare\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349072,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rhn-60e-ocl","attributes":{"version":2,"name":"iptables_egress_allowed","description":"Egress traffic allowed using iptables","expression":"exec.comm == \"iptables\" && process.args in [r\"OUTPUT.*((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}.*ACCEPT\"] && process.args not in [r\"(127\\.)|(10\\.)|(172\\.1[6-9]\\.)|(172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(192\\.168\\.)|(169\\.254\\.)\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349046,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ol8-rm4-6j5","attributes":{"version":1,"name":"aws_cli_usage","description":"The AWS CLI utility was executed","expression":"exec.file.name == \"aws\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343955,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"956-hlb-btg","attributes":{"version":1,"name":"php_shell","description":"Process arguments indicating possible php shell detected","expression":"exec.file.name == \"php\" && exec.args_flags in [\"r\"] && ((exec.args in [~\"*socket_bind*\", ~\"*socket_listen*\", ~\"*socket_accept*\", ~\"*socket_create*\", ~\"*socket_write*\", ~\"*socket_read*\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343942,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gu9-82k-92p","attributes":{"version":2,"name":"cron_at_job_creation_chmod","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chmod.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && chmod.file.destination.mode != chmod.file.mode\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343900,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oad-qwd-via","attributes":{"version":2,"name":"compile_after_delivery","description":"A compiler wrote a suspicious file in a container","expression":"open.flags & O_CREAT > 0\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.ko\", ~\".*\"])\n  || open.file.path in [~\"/var/tmp/**\", ~\"/root/**\", ~\"*/bin/*\", ~\"/usr/local/lib/**\"]\n)\n&& (process.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"])\n&& process.file.name not in [\"pip\", ~\"python*\"]\n&& container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536323502,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vx6-cyx-ksx","attributes":{"version":1,"name":"openssl_backdoor","description":"openssl used to establish backdoor","expression":"exec.comm == \"openssl\" && exec.args =~ \"*s_client*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318450,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4p-qiy-v1g","attributes":{"version":2,"name":"compiler_in_container","description":"A compiler was executed inside of a container","expression":"(exec.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || exec.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || (exec.file.name == \"go\" && exec.args in [~\"*build*\", ~\"*run*\"])) && container.id !=\"\" && process.ancestors.file.path != \"/usr/bin/cilium-agent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318401,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n17-fnl-a6b","attributes":{"version":1,"name":"mount_in_container","description":"The mount utility was executed in a container","expression":"exec.comm == \"mount\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313319,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ylt-39s-jwc","attributes":{"version":2,"name":"cron_at_job_creation_unlink","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (unlink.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313305,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyp-ktn-4kd","attributes":{"version":1,"name":"nsenter_in_container","description":"nsenter used to breakout of container","expression":"exec.file.name == \"nsenter\" && exec.args_options in [\"target=1\", \"t=1\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308211,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mp4-mte-fr7","attributes":{"version":1,"name":"ssh_outbound_connection","description":"A process connected to an SSH server","expression":"connect.addr.port == 22 && connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.ip not in [127.0.0.0/8]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308194,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jix-kop-8dg","attributes":{"version":2,"name":"ransomware_note","description":"Possible ransomware note created under common user directories","expression":"open.flags & O_CREAT > 0\n&& open.file.path in [~\"/home/**\", ~\"/root/**\", ~\"/bin/**\", ~\"/usr/bin/**\", ~\"/opt/**\", ~\"/etc/**\", ~\"/var/log/**\", ~\"/var/lib/log/**\", ~\"/var/backup/**\", ~\"/var/www/**\"]\n&& open.file.name in [r\"(?i)(restore|recover|read|instruction|how_to|ransom|lock).*(your_|crypt|lock|file|ransom)\"] && open.file.name not in [r\"\\.lock$\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308136,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x0q-bqb-eo1","attributes":{"version":2,"name":"windows_cryptominer_process","description":"A cryptominer was potentially executed","expression":"exec.cmdline in [~\"*cpu-priority*\", ~\"*donate-level*\", ~\"*randomx-1gb-pages*\", ~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536303070,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"txo-xll-se0","attributes":{"version":2,"name":"suspicious_dll_write","description":"Dll written to a suspicious directory","expression":"create.file.name =~ \"*.dll\" && create.file.device_path not in [~\"\\Device\\*\\Windows\\System32\\**\", ~\"\\Device\\*\\ProgramData\\docker\\**\"] && process.file.name != \"dockerd.exe\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536297939,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zig-zjk-wem","attributes":{"version":1,"name":"perl_shell","description":"Process arguments indicating possible perl bind shell detected","expression":"exec.file.name == ~\"perl*\" && exec.args_flags in [\"e\"] && ((exec.args in [~\"*socket*\", ~\"*bind*\", ~\"*sockaddr*\", ~\"*listen*\", ~\"*accept\", ~\"*stdin*\", ~\"*stdout\"]) || (exec.args in [~\"*/bin/sh*\", ~\"*/bin/bash*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292914,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qfj-nw1-1zg","attributes":{"version":1,"name":"modified_file_requesting_imds_creds","description":"Recently modified file requested credentials from IMDS","expression":"imds.url =~ \"/*/meta-data/iam/security-credentials/*\" && (process.parent.file.modification_time < 120s || process.file.modification_time < 30s)","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292897,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yhp-mh7-pgn","attributes":{"version":2,"name":"cron_at_job_creation_rename","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (rename.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || rename.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287823,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ers-kyx-kaq","attributes":{"version":2,"name":"cron_at_job_creation_utimes","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (utimes.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287800,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sjm-2is-v4s","attributes":{"version":1,"name":"tar_execution","description":"Tar archive created","expression":"exec.file.path == \"/usr/bin/tar\" && exec.args_flags in [\"create\",\"c\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xhr-7kq-dpo","attributes":{"version":1,"name":"user_deleted_tty","description":"A user was deleted via an interactive session","expression":"exec.file.name in [\"userdel\", \"deluser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d0z-hzd-y7v","attributes":{"version":1,"name":"cryptominer_envs","description":"Process environment variables match cryptocurrency miner","expression":"exec.envs in [\"POOL_USER\", \"POOL_URL\", \"POOL_PASS\", \"DONATE_LEVEL\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eav-mud-yh0","attributes":{"version":1,"name":"credential_modified_utimes","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (utimes.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g2j-1lc-iub","attributes":{"version":1,"name":"kernel_module_chown","description":"A new kernel module was added","expression":"(\n    (chown.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5x8-617-k9v","attributes":{"version":1,"name":"chaussette","description":"Execution of a java process","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cdy-4sl-0vh","attributes":{"version":1,"name":"dirty_pipe_exploitation","description":"Potential Dirty pipe exploitation","expression":"(splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) > 0  && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8fk-hlc-jgx","attributes":{"version":1,"name":"registry_hives_file_path_key_modified","description":"Windows registry hives file location key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\hivelist*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ggj-tkx-3i5","attributes":{"version":1,"name":"windows_hosts_file_modified","description":"the windows hosts file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\Drivers\\etc\\hosts\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hmg-jnt-cra","attributes":{"version":1,"name":"kernel_module_link","description":"A new kernel module was added","expression":"(\n    (link.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || link.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"b7q-33d-ehp","attributes":{"version":1,"name":"inveigh_tool_usage","description":"Process executed with arguments common with Inveigh tool usage","expression":"exec.cmdline in [~\"*SpooferIP*\", ~\"*ReplyToIPs*\", ~\"*ReplyToDomains*\", ~\"*ReplyToMACs*\", ~\"*SnifferIP*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdj-3ys-gul","attributes":{"version":1,"name":"redis_sandbox_escape","description":"Detects CVE-2022-0543","expression":"(open.file.path =~ \"/usr/lib/x86_64-linux-gnu/*\" && open.file.name in [\"libc-2.29.so\", \"libc-2.30.so\", \"libc-2.31.so\", \"libc-2.32.so\", \"libc-2.33.so\", \"libc-2.34.so\", \"libc-2.35.so\", \"libc-2.36.so\", \"libc-2.37.so\"]) && process.ancestors.comm in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kof-qfg-4z7","attributes":{"version":1,"name":"certutil_usage","description":"Certutil was executed to transmit or decode a potentially malicious file","expression":"exec.file.name == \"certutil.exe\" && ((exec.cmdline =~ \"*urlcache*\" && exec.cmdline =~ \"*split*\") || exec.cmdline =~ \"*decode*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"u0y-4yq-w99","attributes":{"version":1,"name":"pwnkit_privilege_escalation","description":"A process was spawned with indicators of exploitation of CVE-2021-4034","expression":"(exec.file.path == \"/usr/bin/pkexec\" && exec.envs in [~\"*SHELL*\", ~\"*PATH*\"] && exec.envs not in [~\"*DISPLAY*\", ~\"*DESKTOP_SESSION*\"] && exec.uid != 0)","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yyp-3qo-77g","attributes":{"version":1,"name":"pci_11_5_critical_binaries_utimes","description":"Critical system binaries may have been modified","expression":"(\n    (utimes.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ijj-sdz-ghy","attributes":{"version":1,"name":"nick_new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjg-ztr-xts","attributes":{"version":1,"name":"suspicious_ntdsutil_usage","description":"Suspicious usage of ntdsutil","expression":"exec.file.name == \"ntdsutil.exe\" && exec.cmdline in [~\"*ntds*\", ~\"*create*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fqj-dnw-hmo","attributes":{"version":1,"name":"kernel_module_unlink","description":"A new kernel module was added","expression":"(\n    (unlink.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4nd-g5m-1xh","attributes":{"version":1,"name":"mount_proc_hide","description":"Process hidden using mount","expression":"mount.mountpoint.path in [~\"/proc/1*\", ~\"/proc/2*\", ~\"/proc/3*\", ~\"/proc/4*\", ~\"/proc/5*\", ~\"/proc/6*\", ~\"/proc/7*\", ~\"/proc/8*\", ~\"/proc/9*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wui-ktw-zwv","attributes":{"version":1,"name":"pam_modification_utimes","description":"PAM may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yrc-jyx-l5i","attributes":{"version":1,"name":"tty_shell_in_container","description":"A shell with a TTY was executed in a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && process.tty_name != \"\" && process.container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vqh-8ry-vsb","attributes":{"version":1,"name":"pam_modification_link","description":"PAM may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || link.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n4m-q5y-yhu","attributes":{"version":1,"name":"ssl_certificate_tampering_unlink","description":"SSL certificates may have been tampered with","expression":"(\n    (unlink.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8i4-ehq-i3p","attributes":{"version":1,"name":"gcp_imds","description":"An GCP IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token\", ~\"*169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fje-48p-1n8","attributes":{"version":1,"name":"ssh_authorized_keys_unlink","description":"SSH modified keys may have been modified","expression":"(\n    unlink.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (unlink.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"luu-gor-cgb","attributes":{"version":1,"name":"sudoers_policy_modified_utimes","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (utimes.file.path == \"/etc/sudoers\")\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"89r-spf-prk","attributes":{"version":1,"name":"credential_modified_open_v2","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    open.flags & ((O_CREAT|O_RDWR|O_WRONLY|O_TRUNC)) > 0 &&\n    (open.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"490-ewn-i16","attributes":{"version":1,"name":"chatroom_request","description":"A DNS request was made for a chatroom domain","expression":"dns.question.name in [\"discord.com\", \"api.telegram.org\", \"cdn.discordapp.com\"]","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vzm-iv2-vhs","attributes":{"version":1,"name":"windows_test_default_rule","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pyu-xzd-leo","attributes":{"version":1,"name":"user_created_tty","description":"A user was created via an interactive session","expression":"exec.file.name in [\"useradd\", \"newusers\", \"adduser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && exec.args_flags not in [\"D\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zdm-kv0-gca","attributes":{"version":1,"name":"net_file_download","description":"A suspicious file was written by a network utility","expression":"open.flags & O_CREAT > 0 && process.comm in [\"wget\", \"curl\", \"lwp-download\"]\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.sh\", ~\"*.c\", ~\"*.so\", ~\"*.ko\"])\n  || open.file.path in [~\"/usr/**\", ~\"/lib/**\", ~\"/etc/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5ts-w6u-tfl","attributes":{"version":1,"name":"registry_runkey_modified","description":"A Registry runkey has been modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\RunonceEx\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jgi-rfz-rlb","attributes":{"version":1,"name":"pam_modification_unlink","description":"PAM may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"coy-qpb-suv","attributes":{"version":1,"name":"credential_modified_unlink","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (unlink.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-9tn-irt","attributes":{"version":1,"name":"ssl_certificate_tampering_link","description":"SSL certificates may have been tampered with","expression":"(\n    (link.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || link.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.name !~ \"runc*\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dig-cav-hhc","attributes":{"version":1,"name":"kmod_list","description":"Kernel modules were listed using the kmod command","expression":"exec.comm == \"kmod\" && exec.args in [~\"*list*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jlg-roy-9zx","attributes":{"version":1,"name":"auditd_rule_file_modified","description":"The auditd rules file was modified without using auditctl","expression":"open.file.path in [\"/etc/audit/rules.d/audit.rules\", \"/etc/audit/audit.rules\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"v83-av9-xuy","attributes":{"version":1,"name":"ntds_in_commandline","description":"NTDS file referenced in commandline","expression":"exec.cmdline =~ \"*ntds.dit*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rnj-nwd-n5v","attributes":{"version":1,"name":"procdump_usage","description":"Testing a default windows agent rule","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pjn-4hr-bot","attributes":{"version":1,"name":"suspicious_suid_execution","description":"Recently written or modified suid file has been executed","expression":"((process.file.mode & S_ISUID > 0) && process.file.modification_time < 30s) && exec.file.name != \"\" && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bw8-ud8-qzq","attributes":{"version":1,"name":"net_util_exfiltration","description":"Exfiltration attempt via network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] &&\nexec.args_options in [ ~\"post-file=*\", ~\"post-data=*\", ~\"T=*\", ~\"d=@*\", ~\"upload-file=*\", ~\"F=file*\"] &&\nexec.args not in [~\"*localhost*\", ~\"*127.0.0.1*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4jd-zjb-ybo","attributes":{"version":1,"name":"shell_history_symlink","description":"A symbolic link for shell history was created targeting /dev/null","expression":"exec.comm == \"ln\" && exec.args in [~\"*.*history*\", \"/dev/null\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"can-pva-exd","attributes":{"version":1,"name":"suspicious_container_client","description":"A container management utility was executed in a container","expression":"exec.file.name in [\"docker\", \"kubectl\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bb8-sg5-ful","attributes":{"version":1,"name":"kernel_module_load_container","description":"A container loaded a new kernel module","expression":"load_module.name != \"\" && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yzz-sm2-0ff","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chmod","description":"Critical system binaries may have been modified","expression":"(\n    (chmod.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7nx-gb8-9t4","attributes":{"version":1,"name":"rc_scripts_modified","description":"RC scripts modified","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && (open.file.path in [\"/etc/rc.common\", \"/etc/rc.local\"])) && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"npo-tkf-eex","attributes":{"version":1,"name":"pam_modification_chmod","description":"PAM may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gw4-kqw-q1l","attributes":{"version":1,"name":"new_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"atm-kqf-qa2","attributes":{"version":1,"name":"systemd_modification_chmod","description":"A service may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oqc-9gu-uq5","attributes":{"version":1,"name":"ssl_certificate_tampering_utimes","description":"SSL certificates may have been tampered with","expression":"(\n    (utimes.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-7qi-s5j","attributes":{"version":1,"name":"pci_11_5_critical_binaries_unlink","description":"Critical system binaries may have been modified","expression":"(\n    (unlink.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bqm-bp1-dpv","attributes":{"version":1,"name":"nsswitch_conf_mod_link","description":"nsswitch may have been modified without authorization","expression":"(\n    (link.file.path in [ \"/etc/nsswitch.conf\" ]\n    || link.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nah-p3m-dgh","attributes":{"version":1,"name":"database_shell_execution","description":"A database application spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\nprocess.parent.file.name in [\"mysqld\", \"mongod\", \"postgres\"] &&\n!(process.parent.file.name == \"initdb\" &&\nexec.args == \"-c locale -a\") &&\n!(process.parent.file.name == \"postgres\" &&\nexec.args == ~\"*pg_wal*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4mm-9uv-w3t","attributes":{"version":1,"name":"shell_profile_modification","description":"Shell profile was modified","expression":"open.file.path in [~\"/home/*/*profile\", ~\"/home/*/*rc\"] && open.flags & ((O_CREAT|O_TRUNC|O_RDWR|O_WRONLY)) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6q-hmw-lae","attributes":{"version":1,"name":"auditd_config_modified","description":"The auditd configuration file was modified without using auditctl","expression":"open.file.path == \"/etc/audit/auditd.conf\" && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"brz-yda-nve","attributes":{"version":1,"name":"ssh_authorized_keys_link","description":"SSH modified keys may have been modified","expression":"(\n    link.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (link.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || link.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4be-qms-wyo","attributes":{"version":1,"name":"windows_update_registry_key_modified","description":"Windows update registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsUpdate*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ttl-6wn-1ke","attributes":{"version":1,"name":"ssh_it_tool_config_write","description":"The configuration directory for an ssh worm","expression":"open.file.path in [~\"/root/.prng/*\", ~\"/home/*/.prng/*\", ~\"/root/.config/prng/*\", ~\"/home/*/.config/prng/*\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n0c-0if-hne","attributes":{"version":1,"name":"nsswitch_conf_mod_chmod","description":"nsswitch may have been modified without authorization","expression":"(\n    (chmod.file.path in [ \"/etc/nsswitch.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ryr-yxl-ilk","attributes":{"version":1,"name":"nsswitch_conf_mod_utimes","description":"nsswitch may have been modified without authorization","expression":"(\n    (utimes.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"61g-xow-oup","attributes":{"version":1,"name":"nsswitch_conf_mod_chown","description":"nsswitch may have been modified without authorization","expression":"(\n    (chown.file.path in [ \"/etc/nsswitch.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"es9-b6s-upq","attributes":{"version":1,"name":"ssl_certificate_tampering_open_v2","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"\n&& container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x79-zfs-0ix","attributes":{"version":1,"name":"omigod","description":"Omiagent spawns a privileged child process","expression":"exec.uid >= 0 && process.ancestors.file.name == \"omiagent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8ks-vsd-y6y","attributes":{"version":1,"name":"ssl_certificate_tampering_open","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zb2-wpx-aff","attributes":{"version":1,"name":"new_binary_execution_in_container","description":"A container executed a new binary not found in the container image","expression":"container.id != \"\" && process.file.in_upper_layer && process.file.modification_time < 30s && exec.file.name != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k6c-tqa-hjv","attributes":{"version":1,"name":"ssh_authorized_keys_open_v2","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uwk-qfs-oqe","attributes":{"version":1,"name":"kernel_module_chmod","description":"A new kernel module was added","expression":"(\n    (chmod.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"czs-lbr-7k2","attributes":{"version":1,"name":"ptrace_antidebug","description":"A process uses an anti-debugging technique to block debuggers","expression":"ptrace.request == PTRACE_TRACEME && process.file.name != \"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bpu-wji-3ed","attributes":{"version":1,"name":"exec_lsmod","description":"Kernel modules were listed using the lsmod command","expression":"exec.comm == \"lsmod\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jch-xfg-uak","attributes":{"version":1,"name":"nsswitch_conf_mod_unlink","description":"nsswitch may have been modified without authorization","expression":"(\n    (unlink.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yue-sj6-ucc","attributes":{"version":1,"name":"ssl_certificate_tampering_rename","description":"SSL certificates may have been tampered with","expression":"(\n    (rename.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || rename.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rp7-w2i-wnj","attributes":{"version":1,"name":"credential_modified_link","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (link.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || link.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mcj-rg7-foe","attributes":{"version":1,"name":"credential_modified_rename","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (rename.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || rename.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yu3-bwu-ji4","attributes":{"version":1,"name":"nick_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jcr-yly-myj","attributes":{"version":1,"name":"ssl_certificate_tampering_chown","description":"SSL certificates may have been tampered with","expression":"(\n    (chown.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"llc-wxw-5uh","attributes":{"version":1,"name":"dirty_pipe_attempt","description":"Potential Dirty pipe exploitation attempt","expression":"(splice.pipe_entry_flag & PIPE_BUF_FLAG_CAN_MERGE) != 0 && (splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) == 0 && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x7k-bop-jcu","attributes":{"version":1,"name":"windows_com_rpc_debugging_registry_key_modified","description":"Windows RPC COM debugging registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ypb-aen-wts","attributes":{"version":1,"name":"mount_host_fs","description":"The host file system was mounted in a container","expression":"mount.source.path == \"/\" && mount.fs_type != \"overlay\" && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zjd-e62-fkk","attributes":{"version":1,"name":"release_agent_container_breakout","description":"A process attempted to write to the release_agent file of a cgroup, indicating a potential container breakout attempt","expression":"container.id != \"\" && open.file.name == \"release_agent\" && open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":1646684459816,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgc-7yd-gpm","attributes":{"version":1,"name":"pci_11_5_critical_binaries_rename","description":"Critical system binaries may have been modified","expression":"(\n    (rename.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || rename.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bue-96a-bwo","attributes":{"version":1,"name":"pam_modification_rename","description":"PAM may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || rename.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nue-ulh-gxb","attributes":{"version":1,"name":"aws_imds","description":"An AWS IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/latest/meta-data/iam/security-credentials/*\", ~\"*169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\", ~\"*169.254.170.2/*/credentials?id=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"55u-gp9-m0k","attributes":{"version":1,"name":"invalid_agent_constraint","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"0.0.0 >= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8og-5of-lw8","attributes":{"version":1,"name":"offensive_k8s_tool","description":"A known kubernetes pentesting tool has been executed","expression":"(exec.file.name in [ ~\"python*\" ] && (\"KubiScan.py\" in exec.argv || \"kubestriker\" in exec.argv ) ) || exec.file.name in [ \"kubiscan\",\"kdigger\",\"kube-hunter\",\"rakkess\",\"peirates\",\"kubescape\",\"kubeaudit\",\"kube-linter\",\"stratus\",~\"botb-*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fdj-qws-x9g","attributes":{"version":1,"name":"sudoers_policy_modified_chmod","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chmod.file.path == \"/etc/sudoers\")\n) && chmod.file.destination.mode != chmod.file.mode && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqf-gv4-huh","attributes":{"version":1,"name":"windows_test_default_rule_b","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jji-uaq-xqi","attributes":{"version":1,"name":"net_util_in_container","description":"A network utility was executed in a container","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id != \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tj0-f4s-grz","attributes":{"version":1,"name":"pam_modification_chown","description":"PAM may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mmg-bkt-mx4","attributes":{"version":1,"name":"exec_whoami","description":"The whoami command was executed","expression":"exec.comm == \"whoami\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ao4-966-ahr","attributes":{"version":1,"name":"sensitive_tracing","description":"A process is tracing privileged processes or sshd for possible credential dumping","expression":"(ptrace.request == PTRACE_PEEKTEXT || ptrace.request == PTRACE_PEEKDATA || ptrace.request == PTRACE_PEEKUSR) && ptrace.tracee.euid == 0 && process.comm not in [\"dlv\", \"dlv-linux-amd64\", \"strace\", \"gdb\", \"lldb-server\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mrk-tku-sbc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chown","description":"Critical system binaries may have been modified","expression":"(\n    (chown.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nk2-hcg-hf5","attributes":{"version":1,"name":"kernel_module_load_from_memory","description":"A kernel module was loaded from memory","expression":"load_module.loaded_from_memory == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hau-g4f-zzo","attributes":{"version":1,"name":"apparmor_modified_tty","description":"An AppArmor profile was modified in an interactive session","expression":"exec.file.name in [\"aa-disable\", \"aa-complain\", \"aa-audit\"] && exec.tty_name !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0gp-zoy-gyb","attributes":{"version":1,"name":"runc_leaky_fd","description":"The container breakout CVE-2024-21626 was successful","expression":"chdir.syscall.path =~ \"/proc/self/fd/*\" && chdir.file.path == \"/sys/fs/cgroup\" && process.file.name =~ \"runc.*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wqb-yxc-mtb","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open_v2","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vpa-xoh-cia","attributes":{"version":1,"name":"procdump_execution","description":"A tool used to dump process memory has been executed","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vlv-1qs-cjz","attributes":{"version":1,"name":"sudoers_policy_modified_rename","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (rename.file.path == \"/etc/sudoers\"\n    || rename.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"itl-shq-qre","attributes":{"version":1,"name":"nsswitch_conf_mod_open_v2","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && container.created_at > 90s && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fpl-fno-4u3","attributes":{"version":1,"name":"aws_eks_service_account_token_accessed","description":"The AWS EKS service account token was accessed","expression":"open.file.path =~ \"/var/run/secrets/eks.amazonaws.com/serviceaccount/**\" && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"3vq-bya-qsj","attributes":{"version":1,"name":"windows_security_essentials_executable_modified","description":"microsoft security essentials executable modified","expression":"write.file.device_path in [~\"\\Device\\*\\Program Files\\Microsoft Security Client\\msseces.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"08i-pvz-95h","attributes":{"version":1,"name":"crackmap_exec_executed","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme.exe*\", ~\"*cme.py*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpx-hnf-bc6","attributes":{"version":1,"name":"critical_registry_export","description":"regedit used to export critical registry hive","expression":"exec.file.name in [\"reg.exe\", \"regedit.exe\"] && exec.cmdline in [~\"*hklm*\", ~\"*hkey_local_machine*\", ~\"*system*\", ~\"*sam*\", ~\"*security*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aoh-97n-qus","attributes":{"version":1,"name":"redis_save_module","description":"Redis module has been created","expression":"(open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0 && open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.rdb\", ~\"*.aof\", ~\"*.so\"]) && process.file.name in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqg-9ps-mhw","attributes":{"version":1,"name":"passwd_execution","description":"The passwd or chpasswd utility was used to modify an account password","expression":"exec.file.path in [\"/usr/bin/passwd\", \"/usr/sbin/chpasswd\"] && exec.args_flags not in [\"S\", \"status\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4r-2xn-ha0","attributes":{"version":1,"name":"sudoers_policy_modified_open","description":"Sudoers policy file may have been modified without authorization","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n(open.file.path == \"/etc/sudoers\")) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"azw-x88-p7j","attributes":{"version":1,"name":"kubernetes_dns_enumeration","description":"Kubernetes DNS enumeration","expression":"dns.question.name == \"any.any.svc.cluster.local\" && dns.question.type == SRV && container.id != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vma-bsh-4d1","attributes":{"version":1,"name":"kernel_msr_write","description":"A process attempted to enable writing to model-specific registers","expression":"exec.comm == \"modprobe\" && process.args =~ \"*msr*allow_writes*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aed-rue-lpr","attributes":{"version":1,"name":"ip_check_domain","description":"A DNS lookup was done for a IP check service","expression":"dns.question.name in [\"icanhazip.com\", \"ip-api.com\", \"myip.opendns.com\", \"checkip.amazonaws.com\", \"whatismyip.akamai.com\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"stp-dwk-4j7","attributes":{"version":1,"name":"delete_system_log","description":"A process deleted common system log files","expression":"unlink.file.path in [\"/var/run/utmp\", \"/var/log/wtmp\", \"/var/log/btmp\", \"/var/log/lastlog\", \"/var/log/faillog\", \"/var/log/syslog\", \"/var/log/messages\", \"/var/log/secure\", \"/var/log/auth.log\", \"/var/log/boot.log\", \"/var/log/kern.log\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4s4-ezo-w7q","attributes":{"version":1,"name":"dynamic_linker_config_write","description":"A process wrote to a dynamic linker config file","expression":"open.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdc-uhk-mtc","attributes":{"version":1,"name":"ssh_authorized_keys_open","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgq-fea-q99","attributes":{"version":1,"name":"windows_system_enviroment_variable_registry_key_modified","description":"Windows environment variable registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Environment*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n9y-2nc-no0","attributes":{"version":1,"name":"dotnet_dump_execution","description":"Dotnet_dump was used to dump a process memory","expression":"exec.cmdline =~ \"*dotnet-dump*\" && exec.cmdline =~ \"*collect*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"r3m-72r-y8g","attributes":{"version":1,"name":"shell_history_truncated","description":"Shell History was Deleted","expression":"open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && open.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && open.file.path in [~\"/root/*\", ~\"/home/**\"] && process.file.name == \"truncate\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zqc-vts-wok","attributes":{"version":1,"name":"nsswitch_conf_mod_open","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"usg-zrs-ckt","attributes":{"version":1,"name":"winlogon_registry_key_modified","description":"Windows winlogon registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x4t-j4v-l4r","attributes":{"version":1,"name":"windows_explorer_executable_modified","description":"windows explorer file has been modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\explorer.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"9mk-a4g-rb5","attributes":{"version":1,"name":"crackmap_exec_usage","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cqr-wm9-cjl","attributes":{"version":1,"name":"systemd_modification_open","description":"A service may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cxw-5gm-pid","attributes":{"version":1,"name":"curl_docker_socket","description":"The Docker socket was referenced in a cURL command","expression":"exec.file.name == \"curl\" && exec.args_flags in [\"unix-socket\"] && exec.args in [~\"*docker.sock*\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpf-aeq-icx","attributes":{"version":1,"name":"ssh_authorized_keys_chown","description":"SSH modified keys may have been modified","expression":"(\n    chown.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chown.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iqk-ui0-v8c","attributes":{"version":1,"name":"hidden_file_executed","description":"A hidden file was executed in a suspicious folder","expression":"exec.file.name =~ \".*\" && exec.file.path in [~\"/home/**\", ~\"/tmp/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"s1j-kv4-llt","attributes":{"version":1,"name":"selinux_disable_enforcement","description":"SELinux enforcement status was disabled","expression":"selinux.enforce.status in [\"permissive\", \"disabled\"] && process.ancestors.args != ~\"*BECOME-SUCCESS*\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a9j-6xn-afo","attributes":{"version":1,"name":"sliver_c2_implant_execution","description":"process arguments match sliver c2 implant","expression":"exec.cmdline =~ \"*NoExit *\" && exec.cmdline =~ \"*Command *\" && exec.cmdline =~ \"*[Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vb1-l7o-skr","attributes":{"version":1,"name":"ssl_certificate_tampering_chmod","description":"SSL certificates may have been tampered with","expression":"(\n    (chmod.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.mode != chmod.file.destination.mode\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1or-3oo-rag","attributes":{"version":1,"name":"new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qme-vau-bk4","attributes":{"version":1,"name":"potential_web_shell_parent","description":"A web application spawned a shell or shell utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] || exec.comm in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\n(process.parent.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.parent.file.name =~ \"php*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7ft-hzb-mpc","attributes":{"version":1,"name":"critical_windows_files_modified","description":"a critical windows file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hbd-kty-ixx","attributes":{"version":1,"name":"kernel_module_utimes","description":"A new kernel module was added","expression":"(\n    (utimes.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rly-bqo-sg1","attributes":{"version":1,"name":"systemd_modification_utimes","description":"A service may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eda-l1r-hrq","attributes":{"version":1,"name":"relay_attack_tool_execution","description":"Process matches known relay attack tool","expression":"exec.file.name in [~\"*PetitPotam*\", ~\"*RottenPotato*\", ~\"*HotPotato*\", ~\"*JuicyPotato*\", ~\"*just_dce_*\", ~\"*Juicy Potato*\", \"rot.exe\", \"Potato.exe\", \"SpoolSample.exe\", \"Responder.exe\", ~\"*smbrelayx*\", ~\"*smbrelayx*\", ~\"*ntlmrelayx*\", ~\"*LocalPotato*\"] || exec.cmdline in [~\"*Invoke-Tater*\", ~\"*smbrelay*\", ~\"*ntlmrelay*\", ~\"*cme smb*\", ~\"*ntlm:NTLMhash*\", ~\"*Invoke-PetitPotam*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rbo-40l-grx","attributes":{"version":1,"name":"net_unusual_request","description":"Network utility executed with suspicious URI","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*.php*\", ~\"*.jpg*\"] ","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gci-o39-u6v","attributes":{"version":1,"name":"read_kubeconfig","description":"The kubeconfig file was accessed","expression":"open.file.path in [~\"/home/*/.kube/config\", \"/root/.kube/config\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1uw-i6q-m5n","attributes":{"version":1,"name":"nsswitch_conf_mod_rename","description":"nsswitch may have been modified without authorization","expression":"(\n    (rename.file.path in [ \"/etc/nsswitch.conf\" ]\n    || rename.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ynr-dvw-x2x","attributes":{"version":1,"name":"ssh_authorized_keys_rename","description":"SSH modified keys may have been modified","expression":"(\n    rename.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (rename.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || rename.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fme-ym2-lwi","attributes":{"version":1,"name":"systemd_modification_link","description":"A service may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || link.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tht-nwe-guf","attributes":{"version":1,"name":"k8s_pod_service_account_token_accessed","description":"The Kubernetes pod service account token was accessed","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"] && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"] && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6d-gre-qls","attributes":{"version":1,"name":"service_stop","description":"systemctl used to stop a service","expression":"exec.file.name == \"systemctl\" && exec.args in [~\"*stop*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ljs-qkf-c4r","attributes":{"version":1,"name":"pam_modification_open","description":"PAM may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vhj-z63-abi","attributes":{"version":1,"name":"systemd_modification_chown","description":"A service may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pho-wta-zir","attributes":{"version":1,"name":"net_util","description":"A network utility was executed","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id == \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"m36-fmz-1bi","attributes":{"version":1,"name":"executable_bit_added","description":"The executable bit was added to a newly created file","expression":"chmod.file.in_upper_layer &&\nchmod.file.change_time < 30s &&\ncontainer.id != \"\" &&\nchmod.file.destination.mode != chmod.file.mode &&\nchmod.file.destination.mode & S_IXUSR|S_IXGRP|S_IXOTH > 0 &&\nprocess.argv in [\"+x\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5j0-kon-1hn","attributes":{"version":1,"name":"sudoers_policy_modified_link","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (link.file.path == \"/etc/sudoers\"\n    || link.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hsw-h1t-p9n","attributes":{"version":1,"name":"suid_file_execution","description":"a SUID file was executed","expression":"(setuid.euid == 0 || setuid.uid  == 0)  && process.file.mode & S_ISUID > 0  && process.file.uid == 0  && process.uid != 0  && process.file.path != \"/usr/bin/sudo\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"da1-a9j-tw9","attributes":{"version":1,"name":"sudoers_policy_modified_unlink","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (unlink.file.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4tw-oex-wnc","attributes":{"version":1,"name":"cryptominer_args","description":"A process launched with arguments associated with cryptominers","expression":"exec.args_options in [~\"cpu-priority*\", ~\"donate-level*\"] || exec.args_flags == \"randomx-1gb-pages\" || exec.args in [~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uga-lal-zqb","attributes":{"version":1,"name":"php_spawning_shell","description":"PHP web application spawning shell","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name in [\"php.exe\",\"php-cgi.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"alv-iwj-sbs","attributes":{"version":1,"name":"systemd_modification_unlink","description":"A service may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nsy-20w-pj6","attributes":{"version":1,"name":"sharpup_tool_usage","description":"sharpup tool used for local privilege escalation","expression":"exec.file.name == \"sharpup.exe\" && exec.cmdline in [~\"*HijackablePaths*\", ~\"*UnquotedServicePath*\", ~\"*ProcessDLLHijack*\", ~\"*ModifiableServiceBinaries*\", ~\"*ModifiableScheduledTask*\", ~\"*DomainGPPPassword*\", ~\"*CachedGPPPassword*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mam-ir1-532","attributes":{"version":1,"name":"windows_cryptographic_blocking_policy_registry_key_modified","description":"Windows cryptographic blocking policy modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllRemoveSignedDataMsg*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tn9-vck-we9","attributes":{"version":1,"name":"shell_history_deleted","description":"Shell History was Deleted","expression":"unlink.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && unlink.file.path in [~\"/root/**\", ~\"/home/**\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ows-d9p-s2b","attributes":{"version":1,"name":"runc_modification","description":"The runc binary was modified in a non-standard way","expression":"open.file.path in [\"/usr/bin/runc\", \"/usr/sbin/runc\", \"/usr/bin/docker-runc\"]\n&& open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"on3-qxk-zeh","attributes":{"version":1,"name":"paste_site","description":"A DNS lookup was done for a pastebin-like site","expression":"dns.question.name in [\"pastebin.com\", \"ghostbin.com\", \"termbin.com\", \"klgrth.io\", \"rentry.co\", \"transfer.sh\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdi-lzv-pki","attributes":{"version":1,"name":"azure_imds","description":"An Azure IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/metadata/identity/oauth2/token?api-version=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qay-zpa-akb","attributes":{"version":1,"name":"rubeus_execution","description":"process arguments match rubeus credential theft tool","expression":"exec.cmdline in [~\"*asreproast*\", ~\"*/service:krbtgt*\", ~\"*dump /luid:0x*\", ~\"*kerberoast*\", ~\"*createonly /program*\", ~\"*ptt /ticket*\", ~\"*impersonateuser*\", ~\"*renew /ticket*\", ~\"*asktgt /user*\", ~\"*harvest /interval*\", ~\"*s4u /user*\", ~\"*hash /password*\", ~\"*golden /aes256*\", ~\"*silver /user*\", \"*rubeus*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uty-ayo-tpv","attributes":{"version":1,"name":"wmi_spawning_shell","description":"Command executed via WMI","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name == \"WmiPrvSE.exe\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"icy-i3s-bvd","attributes":{"version":1,"name":"deploy_priv_container","description":"A privileged container was created","expression":"exec.file.name != \"\" && container.created_at < 1s && process.cap_permitted & CAP_SYS_ADMIN > 0","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6du-s2a-foz","attributes":{"version":1,"name":"suspicious_bitsadmin_usage","description":"A suspicious bitsadmin command has been executed","expression":"exec.file.name == \"bitsadmin.exe\" && exec.cmdline in [~\"*addfile*\", ~\"*create*\", ~\"*resume*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dco-vsp-sto","attributes":{"version":1,"name":"ssh_authorized_keys_chmod","description":"SSH modified keys may have been modified","expression":"(\n    chmod.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chmod.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyc-tp1-xr1","attributes":{"version":1,"name":"windows_boot_registry_key_modified","description":"Windows boot registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\IniFileMapping\\SYSTEM.ini\\boot*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-cg7-96w","attributes":{"version":1,"name":"sudoers_policy_modified_chown","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chown.file.path == \"/etc/sudoers\")\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bft-ikt-sfa","attributes":{"version":1,"name":"registry_service_runkey_modified","description":"Service registry runkey modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\CurrentVersion\\RunServices\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ydm-yqo-f9t","attributes":{"version":1,"name":"looney_tunables_exploit","description":"Looney Tunables (CVE-2023-4911) exploit attempted","expression":"exec.file.mode & S_ISUID > 0 && exec.file.uid == 0 && exec.uid != 0 && exec.envs in [~\"*GLIBC_TUNABLES*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wpy-igs-bcp","attributes":{"version":1,"name":"windows_shell_folders_registry_key_modified","description":"Windows shell folders registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders*\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gyj-yid-n02","attributes":{"version":1,"name":"ptrace_injection","description":"A process attempted to inject code into another process","expression":"ptrace.request == PTRACE_POKETEXT || ptrace.request == PTRACE_POKEDATA || ptrace.request == PTRACE_POKEUSR","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kxe-vss-47x","attributes":{"version":1,"name":"windows_firewall_configuration_registry_key_modified","description":"Windows firewall configuration registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zxv-eui-tgr","attributes":{"version":1,"name":"auditctl_usage","description":"The auditctl command was used to modify auditd","expression":"exec.file.name == \"auditctl\" && exec.args_flags not in [\"s\", \"l\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ccs-c0e-kx6","attributes":{"version":1,"name":"minidump_usage","description":"Process memory was dumped using the minidump function from comsvcs.dll","expression":"exec.cmdline =~ \"*MiniDump*\" && exec.cmdline =~ \"*comsvcs*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"we1-nic-zhp","attributes":{"version":1,"name":"base64_decode","description":"The base64 command was used to decode information","expression":"exec.file.name == \"base64\" && exec.args_flags in [\"d\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mjs-qml-f6e","attributes":{"version":1,"name":"systemd_modification_rename","description":"A service may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"elg-0ho-jjb","attributes":{"version":1,"name":"powershell_empire_uac_bypass","description":"A process was executed matching arguments for a UAC bypass technique common in powershell empire","expression":"exec.cmdline in [~\"*-NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*\", ~\"*-NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dzi-svp-ub2","attributes":{"version":1,"name":"memfd_create","description":"memfd object created","expression":"exec.file.name =~ \"memfd*\" && exec.file.path == \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iv0-azx-iwi","attributes":{"version":1,"name":"interactive_shell_in_container","description":"An interactive shell was started inside of a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && exec.args_flags in [\"i\"] && container.id !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mgb-ejl-c5b","attributes":{"version":1,"name":"kernel_module_rename","description":"A new kernel module was added","expression":"(\n    (rename.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dug-aqp-7zn","attributes":{"version":1,"name":"exec_wrmsr","description":"The wrmsr program executed","expression":"exec.comm == \"wrmsr\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wrz-nq9-pi8","attributes":{"version":1,"name":"mining_pool_lookup","description":"A process resolved a DNS name associated with cryptomining activity","expression":"dns.question.name in [~\"*.minexmr.com\", \"minexmr.com\", ~\"*.nanopool.org\", \"nanopool.org\", ~\"*.supportxmr.com\", \"supportxmr.com\", ~\"*.c3pool.com\", \"c3pool.com\", ~\"*.p2pool.io\", \"p2pool.io\", ~\"*.ethermine.org\", \"ethermine.org\", ~\"*.f2pool.com\", \"f2pool.com\", ~\"*.poolin.me\", \"poolin.me\", ~\"*.rplant.xyz\", \"rplant.xyz\", ~\"*.miningocean.org\", \"miningocean.org\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"01c-hgk-8x3","attributes":{"version":1,"name":"credential_modified_chmod","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chmod.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ld1-hxu-zdf","attributes":{"version":1,"name":"nick_new_java_detect_with_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"foogazi\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"z0y-kio-bf4","attributes":{"version":1,"name":"kernel_module_open","description":"A new kernel module was added","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xtf-uqt-mh0","attributes":{"version":1,"name":"common_net_intrusion_util","description":"A network utility (nmap) commonly used in intrusion attacks was executed","expression":"exec.file.name in [\"nmap\", \"masscan\", \"fping\", \"zgrab\", \"zgrab2\", \"rustscan\", \"pnscan\"] && exec.args_flags not in [\"V\", \"version\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"l5b-qmr-hi6","attributes":{"version":1,"name":"ssh_authorized_keys_utimes","description":"SSH modified keys may have been modified","expression":"(\n    utimes.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (utimes.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qa1-stp-xpl","attributes":{"version":1,"name":"open_msr_writes","description":"A process opened a model-specific register (MSR) configuration file","expression":"open.file.path == \"/sys/module/msr/parameters/allow_writes\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cwr-kgl-5xs","attributes":{"version":1,"name":"credential_modified_chown","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chown.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"am6-icr-cgg","attributes":{"version":1,"name":"package_management_in_container","description":"Package management was detected in a container","expression":"exec.file.path in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"esx-z8e-qcs","attributes":{"version":1,"name":"safeboot_modification","description":"Safeboot registry modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\SafeBoot\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sdk-dp7-vt0","attributes":{"version":1,"name":"jupyter_shell_execution","description":"A Jupyter notebook executed a shell","expression":"(exec.file.name in [\"cat\",\"chgrp\",\"chmod\",\"chown\",\"cp\",\"date\",\"dd\",\"df\",\"dir\",\"echo\",\"ln\",\"ls\",\"mkdir\",\"mknod\",\"mktemp\",\"mv\",\"pwd\",\"readlink\",\"rm\",\"rmdir\",\"sleep\",\"stty\",\"sync\",\"touch\",\"uname\",\"vdir\",\"arch\",\"b2sum\",\"base32\",\"base64\",\"basename\",\"chcon\",\"cksum\",\"comm\",\"csplit\",\"cut\",\"dircolors\",\"dirname\",\"du\",\"env\",\"expand\",\"expr\",\"factor\",\"fmt\",\"fold\",\"groups\",\"head\",\"hostid\",\"id\",\"install\",\"join\",\"link\",\"logname\",\"md5sum\",\"textutils\",\"mkfifo\",\"nice\",\"nl\",\"nohup\",\"nproc\",\"numfmt\",\"od\",\"paste\",\"pathchk\",\"pinky\",\"pr\",\"printenv\",\"printf\",\"ptx\",\"realpath\",\"runcon\",\"seq\",\"sha1sum\",\"sha224sum\",\"sha256sum\",\"sha384sum\",\"sha512sum\",\"shred\",\"shuf\",\"sort\",\"split\",\"stat\",\"stdbuf\",\"sum\",\"tac\",\"tail\",\"tee\",\"test\",\"timeout\",\"tr\",\"truncate\",\"tsort\",\"tty\",\"unexpand\",\"uniq\",\"unlink\",\"users\",\"wc\",\"who\",\"whoami\",\"chroot\"] || exec.file.name in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"]) && process.ancestors.comm in [\"jupyter-noteboo\", \"jupyter-lab\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hnz-ezh-lyu","attributes":{"version":1,"name":"ld_preload_unusual_library_path","description":"The LD_PRELOAD variable is populated by a link to a suspicious file directory","expression":"exec.envs in [~\"LD_PRELOAD=*/tmp/*\", ~\"LD_PRELOAD=/dev/shm/*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjo-mdq-mi1","attributes":{"version":1,"name":"dynamic_linker_config_unlink","description":"A process unlinked a dynamic linker config file","expression":"unlink.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"psf-hiy-3ji","attributes":{"version":1,"name":"scheduled_task_creation","description":"A scheduled task was created","expression":"exec.cmdline in [~\"*at.exe\",~\"*schtasks*\"] && exec.cmdline =~ \"*create*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6vb-fkj-cdc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ktg-ng9-izk","attributes":{"version":1,"name":"kernel_module_load_from_memory_container","description":"A kernel module was loaded from memory inside a container","expression":"load_module.loaded_from_memory == true && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0qf-cha-qci","attributes":{"version":1,"name":"java_shell_execution_parent","description":"A java process spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"])\n&& process.parent.file.name in [\"java\", \"jspawnhelper\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gz3-l4z-bzr","attributes":{"version":1,"name":"network_sniffing_tool","description":"Local account groups were enumerated after container start up","expression":"exec.file.name in [\"tcpdump\", \"tshark\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hob-7or-knu","attributes":{"version":1,"name":"python_cli_code","description":"Python code was provided on the command line","expression":"exec.file.name == ~\"python*\" && exec.args_flags in [\"c\"] && exec.args in [~\"*-c*SOCK_STREAM*\", ~\"*-c*subprocess*\", ~\"*-c*/bash*\", ~\"*-c*/bin/sh*\", ~\"*-c*pty.spawn*\"] && exec.args !~ \"*setuptools*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"buh-tbl-6k1","attributes":{"version":1,"name":"pci_11_5_critical_binaries_link","description":"Critical system binaries may have been modified","expression":"(\n    (link.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || link.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521243,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"}]}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 278.158458ms
    - id: 5
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":[{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"vg6-omq-vv4","attributes":{"version":1,"name":"wawhgdyumt","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295102041,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295102041,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"3yb-106-xrm","attributes":{"version":3,"name":"my_terraform_rule2","description":"my terraform rule","expression":"bind.addr.ip==1.6.1.9","category":"Kernel Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747140640989,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747141373736,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"rtp-dom-1am","attributes":{"version":1,"name":"agent_rule2","description":"My Agent rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":true,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747062863277,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747062863277,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"1vs-h3p-spa","attributes":{"version":1,"name":"000000bangtestnumber","description":"should_work_with_number","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702433529,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":60000000,"append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g5c-vnp-xf2","attributes":{"version":1,"name":"000000bangtest","description":"should_work_with_string","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702410743,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d4v-xci-tzk","attributes":{"version":1,"name":"000000second","description":"ahahaha","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743701600763,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"by5-5gy-ajb","attributes":{"version":2,"name":"kernel_module_load","description":"A kernel module was loaded","expression":"load_module.loaded_from_memory == false && load_module.name not in [\"nf_tables\", \"iptable_filter\", \"ip6table_filter\", \"bpfilter\", \"ip6_tables\", \"ip6table_nat\", \"nf_reject_ipv4\", \"ipt_REJECT\", \"iptable_raw\", \"udp_diag\", \"inet_diag\"] && process.ancestors.file.name not in [~\"falcon*\", \"unattended-upgrade\", \"apt.systemd.daily\", \"xtables-legacy-multi\", \"ssm-agent-worker\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737734329380,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"c5x-fzi-cfu","attributes":{"version":2,"name":"known_dll_registry_key_modified","description":"Windows Known DLLs location registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737044905726,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fcw-skn-8l6","attributes":{"version":1,"name":"shell_net_connection","description":"A shell made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && process.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"] && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980532395,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jwd-mhg-rzc","attributes":{"version":1,"name":"interpreter_outbound_connection","description":"An interpreter made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && process.file.name in [~\"python2*\", ~\"python3*\", \"node\", \"perl\", ~\"ruby*\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980527270,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7k7-mzh-fhj","attributes":{"version":1,"name":"irc_connection","description":"A process made an outbound IRC connection","expression":"connect.addr.port == 6667 && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980517121,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gff-p0p-hzz","attributes":{"version":1,"name":"p2pinfect_connection","description":"A process made a connection to a port associated with P2PInfect malware","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && connect.addr.port >= 60100 && connect.addr.port <= 60150","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980466118,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0yh-tmv-2ir","attributes":{"version":1,"name":"socat_shell","description":"Process arguments indicating possible socat shell detected","expression":"((exec.file.name == \"socat\") || (exec.comm == \"socat\")) && exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\", ~\"*exec*\", ~\"*pty*\", ~\"*setsid*\", ~\"*stderr*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536410363,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zwp-lhw-osb","attributes":{"version":1,"name":"udev_modification","description":"Device rule created","expression":"open.file.path in [~\"/etc/udev/rules.d/*\", ~\"/lib/udev/rules.d/*\", ~\"/usr/lib/udev/rules.d/*\", ~\"/usr/local/lib/udev/rules.d/*\", ~\"/run/udev/rules.d/*\"] && open.flags & O_CREAT > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405283,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"p4u-oh0-avq","attributes":{"version":1,"name":"devshm_execution","description":"A file executed from /dev/shm/ directory","expression":"exec.file.path == \"/dev/shm/**\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jdx-661-6he","attributes":{"version":1,"name":"ssh_nonstandard_connection","description":"SSH initiated a connection on a nonstandard port","expression":"connect.addr.port in [80, 8080, 88, 443, 8443, 4444] && process.file.name == \"ssh\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395054,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ozf-woz-u9t","attributes":{"version":2,"name":"libpam_ebpf_hook","description":"Library libpam.so hooked using eBPF","expression":"bpf.cmd == BPF_MAP_CREATE && process.args in [r\"libpam\\.so\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395021,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k02-h52-5kl","attributes":{"version":1,"name":"overwrite_entrypoint","description":"A process attempted to overwrite the container entrypoint","expression":"open.file.path == \"/proc/self/fd/1\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0 && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389957,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qwh-aci-cax","attributes":{"version":2,"name":"cron_at_job_creation_open","description":"An unauthorized job was added to cron scheduling","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389882,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cvg-paj-akm","attributes":{"version":2,"name":"cron_at_job_creation_chown","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chown.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536379705,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ecq-lqb-dko","attributes":{"version":1,"name":"find_credentials","description":"find command searching for sensitive files","expression":"exec.comm == \"find\" && exec.args in [~\"*credentials*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374661,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jig-hjw-dqq","attributes":{"version":1,"name":"webdriver_spawned_shell","description":"Browser WebDriver spawned shell","expression":"process.parent.file.name in [~\"chromedriver*\", \"geckodriver\"] && exec.file.name not in [\"chrome\", \"google-chrome\", \"chromium\", \"firefox\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374638,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cjg-f8o-kp3","attributes":{"version":2,"name":"tunnel_traffic","description":"Tunneling or port forwarding tool used","expression":"((exec.comm == \"pivotnacci\" || exec.comm == \"gost\") && process.args_flags in [\"L\", \"C\", \"R\"]) || (exec.comm in [\"ssh\", \"sshd\"] && process.args_flags in [\"R\", \"L\", \"D\", \"w\"] && process.args in [r\"((25[0-5]|(2[0-4]|1\\d|[1-9])\\d)\\.?\\b){4}\"] ) || (exec.comm == \"sshuttle\" && process.args_flags in [\"r\", \"remote\", \"l\", \"listen\"]) || (exec.comm == \"socat\" && process.args in [r\"(TCP4-LISTEN:|SOCKS)\"]) || (exec.comm in [\"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\", \"ssf\", \"3proxy\", \"ngrok\"] && process.parent.comm in [\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"])","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374597,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-5ct-v09","attributes":{"version":1,"name":"netcat_shell","description":"Process arguments indicating possible netcat shell detected","expression":"exec.file.name in [\"netcat\", \"nc\", \"ncat\"] && ((exec.args_flags in [\"l\"] && exec.args_flags in [\"p\"]) || (exec.args_flags in [\"n\"] && exec.args_flags in [\"v\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536369507,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qyq-78u-ql6","attributes":{"version":1,"name":"cups_spawned_shell","description":"Shell process spawned from print server","expression":"exec.file.name != \"\" && process.parent.file.name == \"foomatic-rip\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364424,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdw-b2j-bpy","attributes":{"version":1,"name":"debugfs_in_container","description":"The debugfs was executed in a container","expression":"exec.comm == \"debugfs\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364396,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dt3-f0b-e8d","attributes":{"version":1,"name":"webapp_imds_V1_request","description":"Web application requested IMDSv1 credentials","expression":"imds.aws.is_imds_v2 == false && imds.url =~ \"*/*/meta-data/iam/security-credentials/*\" && (process.ancestors.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.ancestors.file.name =~ \"php*\" || process.ancestors.file.name == \"java\")","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359279,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dat-hhr-7xk","attributes":{"version":2,"name":"cron_at_job_creation_link","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (link.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || link.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-hyn-s1j","attributes":{"version":1,"name":"release_agent_escape","description":"Container escape attempted by overwriting release_agent","expression":"open.file.name == \"release_agent\" && open.file.path in [\"/tmp/**\", \"/home/**\", \"/root/**\", \"/*\"] && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354195,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vvo-iqz-sr2","attributes":{"version":1,"name":"file_sync_exfil","description":"The rclone utility was executed","expression":"exec.file.name in [\"rclone\", \"rsync\", \"sftp\", \"ftp\", \"scp\", \"dcp\", \"rcp\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354189,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-jbt-ag7","attributes":{"version":1,"name":"unshare_in_container","description":"The unshare utility was executed in a container","expression":"exec.comm == \"unshare\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349072,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rhn-60e-ocl","attributes":{"version":2,"name":"iptables_egress_allowed","description":"Egress traffic allowed using iptables","expression":"exec.comm == \"iptables\" && process.args in [r\"OUTPUT.*((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}.*ACCEPT\"] && process.args not in [r\"(127\\.)|(10\\.)|(172\\.1[6-9]\\.)|(172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(192\\.168\\.)|(169\\.254\\.)\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349046,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ol8-rm4-6j5","attributes":{"version":1,"name":"aws_cli_usage","description":"The AWS CLI utility was executed","expression":"exec.file.name == \"aws\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343955,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"956-hlb-btg","attributes":{"version":1,"name":"php_shell","description":"Process arguments indicating possible php shell detected","expression":"exec.file.name == \"php\" && exec.args_flags in [\"r\"] && ((exec.args in [~\"*socket_bind*\", ~\"*socket_listen*\", ~\"*socket_accept*\", ~\"*socket_create*\", ~\"*socket_write*\", ~\"*socket_read*\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343942,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gu9-82k-92p","attributes":{"version":2,"name":"cron_at_job_creation_chmod","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chmod.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && chmod.file.destination.mode != chmod.file.mode\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343900,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oad-qwd-via","attributes":{"version":2,"name":"compile_after_delivery","description":"A compiler wrote a suspicious file in a container","expression":"open.flags & O_CREAT > 0\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.ko\", ~\".*\"])\n  || open.file.path in [~\"/var/tmp/**\", ~\"/root/**\", ~\"*/bin/*\", ~\"/usr/local/lib/**\"]\n)\n&& (process.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"])\n&& process.file.name not in [\"pip\", ~\"python*\"]\n&& container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536323502,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vx6-cyx-ksx","attributes":{"version":1,"name":"openssl_backdoor","description":"openssl used to establish backdoor","expression":"exec.comm == \"openssl\" && exec.args =~ \"*s_client*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318450,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4p-qiy-v1g","attributes":{"version":2,"name":"compiler_in_container","description":"A compiler was executed inside of a container","expression":"(exec.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || exec.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || (exec.file.name == \"go\" && exec.args in [~\"*build*\", ~\"*run*\"])) && container.id !=\"\" && process.ancestors.file.path != \"/usr/bin/cilium-agent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318401,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n17-fnl-a6b","attributes":{"version":1,"name":"mount_in_container","description":"The mount utility was executed in a container","expression":"exec.comm == \"mount\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313319,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ylt-39s-jwc","attributes":{"version":2,"name":"cron_at_job_creation_unlink","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (unlink.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313305,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyp-ktn-4kd","attributes":{"version":1,"name":"nsenter_in_container","description":"nsenter used to breakout of container","expression":"exec.file.name == \"nsenter\" && exec.args_options in [\"target=1\", \"t=1\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308211,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mp4-mte-fr7","attributes":{"version":1,"name":"ssh_outbound_connection","description":"A process connected to an SSH server","expression":"connect.addr.port == 22 && connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.ip not in [127.0.0.0/8]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308194,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jix-kop-8dg","attributes":{"version":2,"name":"ransomware_note","description":"Possible ransomware note created under common user directories","expression":"open.flags & O_CREAT > 0\n&& open.file.path in [~\"/home/**\", ~\"/root/**\", ~\"/bin/**\", ~\"/usr/bin/**\", ~\"/opt/**\", ~\"/etc/**\", ~\"/var/log/**\", ~\"/var/lib/log/**\", ~\"/var/backup/**\", ~\"/var/www/**\"]\n&& open.file.name in [r\"(?i)(restore|recover|read|instruction|how_to|ransom|lock).*(your_|crypt|lock|file|ransom)\"] && open.file.name not in [r\"\\.lock$\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308136,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x0q-bqb-eo1","attributes":{"version":2,"name":"windows_cryptominer_process","description":"A cryptominer was potentially executed","expression":"exec.cmdline in [~\"*cpu-priority*\", ~\"*donate-level*\", ~\"*randomx-1gb-pages*\", ~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536303070,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"txo-xll-se0","attributes":{"version":2,"name":"suspicious_dll_write","description":"Dll written to a suspicious directory","expression":"create.file.name =~ \"*.dll\" && create.file.device_path not in [~\"\\Device\\*\\Windows\\System32\\**\", ~\"\\Device\\*\\ProgramData\\docker\\**\"] && process.file.name != \"dockerd.exe\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536297939,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zig-zjk-wem","attributes":{"version":1,"name":"perl_shell","description":"Process arguments indicating possible perl bind shell detected","expression":"exec.file.name == ~\"perl*\" && exec.args_flags in [\"e\"] && ((exec.args in [~\"*socket*\", ~\"*bind*\", ~\"*sockaddr*\", ~\"*listen*\", ~\"*accept\", ~\"*stdin*\", ~\"*stdout\"]) || (exec.args in [~\"*/bin/sh*\", ~\"*/bin/bash*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292914,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qfj-nw1-1zg","attributes":{"version":1,"name":"modified_file_requesting_imds_creds","description":"Recently modified file requested credentials from IMDS","expression":"imds.url =~ \"/*/meta-data/iam/security-credentials/*\" && (process.parent.file.modification_time < 120s || process.file.modification_time < 30s)","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292897,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yhp-mh7-pgn","attributes":{"version":2,"name":"cron_at_job_creation_rename","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (rename.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || rename.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287823,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ers-kyx-kaq","attributes":{"version":2,"name":"cron_at_job_creation_utimes","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (utimes.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287800,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sjm-2is-v4s","attributes":{"version":1,"name":"tar_execution","description":"Tar archive created","expression":"exec.file.path == \"/usr/bin/tar\" && exec.args_flags in [\"create\",\"c\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xhr-7kq-dpo","attributes":{"version":1,"name":"user_deleted_tty","description":"A user was deleted via an interactive session","expression":"exec.file.name in [\"userdel\", \"deluser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d0z-hzd-y7v","attributes":{"version":1,"name":"cryptominer_envs","description":"Process environment variables match cryptocurrency miner","expression":"exec.envs in [\"POOL_USER\", \"POOL_URL\", \"POOL_PASS\", \"DONATE_LEVEL\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eav-mud-yh0","attributes":{"version":1,"name":"credential_modified_utimes","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (utimes.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g2j-1lc-iub","attributes":{"version":1,"name":"kernel_module_chown","description":"A new kernel module was added","expression":"(\n    (chown.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5x8-617-k9v","attributes":{"version":1,"name":"chaussette","description":"Execution of a java process","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cdy-4sl-0vh","attributes":{"version":1,"name":"dirty_pipe_exploitation","description":"Potential Dirty pipe exploitation","expression":"(splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) > 0  && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8fk-hlc-jgx","attributes":{"version":1,"name":"registry_hives_file_path_key_modified","description":"Windows registry hives file location key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\hivelist*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ggj-tkx-3i5","attributes":{"version":1,"name":"windows_hosts_file_modified","description":"the windows hosts file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\Drivers\\etc\\hosts\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hmg-jnt-cra","attributes":{"version":1,"name":"kernel_module_link","description":"A new kernel module was added","expression":"(\n    (link.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || link.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"b7q-33d-ehp","attributes":{"version":1,"name":"inveigh_tool_usage","description":"Process executed with arguments common with Inveigh tool usage","expression":"exec.cmdline in [~\"*SpooferIP*\", ~\"*ReplyToIPs*\", ~\"*ReplyToDomains*\", ~\"*ReplyToMACs*\", ~\"*SnifferIP*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdj-3ys-gul","attributes":{"version":1,"name":"redis_sandbox_escape","description":"Detects CVE-2022-0543","expression":"(open.file.path =~ \"/usr/lib/x86_64-linux-gnu/*\" && open.file.name in [\"libc-2.29.so\", \"libc-2.30.so\", \"libc-2.31.so\", \"libc-2.32.so\", \"libc-2.33.so\", \"libc-2.34.so\", \"libc-2.35.so\", \"libc-2.36.so\", \"libc-2.37.so\"]) && process.ancestors.comm in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kof-qfg-4z7","attributes":{"version":1,"name":"certutil_usage","description":"Certutil was executed to transmit or decode a potentially malicious file","expression":"exec.file.name == \"certutil.exe\" && ((exec.cmdline =~ \"*urlcache*\" && exec.cmdline =~ \"*split*\") || exec.cmdline =~ \"*decode*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"u0y-4yq-w99","attributes":{"version":1,"name":"pwnkit_privilege_escalation","description":"A process was spawned with indicators of exploitation of CVE-2021-4034","expression":"(exec.file.path == \"/usr/bin/pkexec\" && exec.envs in [~\"*SHELL*\", ~\"*PATH*\"] && exec.envs not in [~\"*DISPLAY*\", ~\"*DESKTOP_SESSION*\"] && exec.uid != 0)","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yyp-3qo-77g","attributes":{"version":1,"name":"pci_11_5_critical_binaries_utimes","description":"Critical system binaries may have been modified","expression":"(\n    (utimes.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ijj-sdz-ghy","attributes":{"version":1,"name":"nick_new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjg-ztr-xts","attributes":{"version":1,"name":"suspicious_ntdsutil_usage","description":"Suspicious usage of ntdsutil","expression":"exec.file.name == \"ntdsutil.exe\" && exec.cmdline in [~\"*ntds*\", ~\"*create*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fqj-dnw-hmo","attributes":{"version":1,"name":"kernel_module_unlink","description":"A new kernel module was added","expression":"(\n    (unlink.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4nd-g5m-1xh","attributes":{"version":1,"name":"mount_proc_hide","description":"Process hidden using mount","expression":"mount.mountpoint.path in [~\"/proc/1*\", ~\"/proc/2*\", ~\"/proc/3*\", ~\"/proc/4*\", ~\"/proc/5*\", ~\"/proc/6*\", ~\"/proc/7*\", ~\"/proc/8*\", ~\"/proc/9*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wui-ktw-zwv","attributes":{"version":1,"name":"pam_modification_utimes","description":"PAM may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yrc-jyx-l5i","attributes":{"version":1,"name":"tty_shell_in_container","description":"A shell with a TTY was executed in a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && process.tty_name != \"\" && process.container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vqh-8ry-vsb","attributes":{"version":1,"name":"pam_modification_link","description":"PAM may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || link.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n4m-q5y-yhu","attributes":{"version":1,"name":"ssl_certificate_tampering_unlink","description":"SSL certificates may have been tampered with","expression":"(\n    (unlink.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8i4-ehq-i3p","attributes":{"version":1,"name":"gcp_imds","description":"An GCP IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token\", ~\"*169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fje-48p-1n8","attributes":{"version":1,"name":"ssh_authorized_keys_unlink","description":"SSH modified keys may have been modified","expression":"(\n    unlink.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (unlink.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"luu-gor-cgb","attributes":{"version":1,"name":"sudoers_policy_modified_utimes","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (utimes.file.path == \"/etc/sudoers\")\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"89r-spf-prk","attributes":{"version":1,"name":"credential_modified_open_v2","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    open.flags & ((O_CREAT|O_RDWR|O_WRONLY|O_TRUNC)) > 0 &&\n    (open.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"490-ewn-i16","attributes":{"version":1,"name":"chatroom_request","description":"A DNS request was made for a chatroom domain","expression":"dns.question.name in [\"discord.com\", \"api.telegram.org\", \"cdn.discordapp.com\"]","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vzm-iv2-vhs","attributes":{"version":1,"name":"windows_test_default_rule","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pyu-xzd-leo","attributes":{"version":1,"name":"user_created_tty","description":"A user was created via an interactive session","expression":"exec.file.name in [\"useradd\", \"newusers\", \"adduser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && exec.args_flags not in [\"D\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zdm-kv0-gca","attributes":{"version":1,"name":"net_file_download","description":"A suspicious file was written by a network utility","expression":"open.flags & O_CREAT > 0 && process.comm in [\"wget\", \"curl\", \"lwp-download\"]\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.sh\", ~\"*.c\", ~\"*.so\", ~\"*.ko\"])\n  || open.file.path in [~\"/usr/**\", ~\"/lib/**\", ~\"/etc/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5ts-w6u-tfl","attributes":{"version":1,"name":"registry_runkey_modified","description":"A Registry runkey has been modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\RunonceEx\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jgi-rfz-rlb","attributes":{"version":1,"name":"pam_modification_unlink","description":"PAM may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"coy-qpb-suv","attributes":{"version":1,"name":"credential_modified_unlink","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (unlink.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-9tn-irt","attributes":{"version":1,"name":"ssl_certificate_tampering_link","description":"SSL certificates may have been tampered with","expression":"(\n    (link.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || link.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.name !~ \"runc*\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dig-cav-hhc","attributes":{"version":1,"name":"kmod_list","description":"Kernel modules were listed using the kmod command","expression":"exec.comm == \"kmod\" && exec.args in [~\"*list*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jlg-roy-9zx","attributes":{"version":1,"name":"auditd_rule_file_modified","description":"The auditd rules file was modified without using auditctl","expression":"open.file.path in [\"/etc/audit/rules.d/audit.rules\", \"/etc/audit/audit.rules\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"v83-av9-xuy","attributes":{"version":1,"name":"ntds_in_commandline","description":"NTDS file referenced in commandline","expression":"exec.cmdline =~ \"*ntds.dit*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rnj-nwd-n5v","attributes":{"version":1,"name":"procdump_usage","description":"Testing a default windows agent rule","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pjn-4hr-bot","attributes":{"version":1,"name":"suspicious_suid_execution","description":"Recently written or modified suid file has been executed","expression":"((process.file.mode & S_ISUID > 0) && process.file.modification_time < 30s) && exec.file.name != \"\" && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bw8-ud8-qzq","attributes":{"version":1,"name":"net_util_exfiltration","description":"Exfiltration attempt via network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] &&\nexec.args_options in [ ~\"post-file=*\", ~\"post-data=*\", ~\"T=*\", ~\"d=@*\", ~\"upload-file=*\", ~\"F=file*\"] &&\nexec.args not in [~\"*localhost*\", ~\"*127.0.0.1*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4jd-zjb-ybo","attributes":{"version":1,"name":"shell_history_symlink","description":"A symbolic link for shell history was created targeting /dev/null","expression":"exec.comm == \"ln\" && exec.args in [~\"*.*history*\", \"/dev/null\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"can-pva-exd","attributes":{"version":1,"name":"suspicious_container_client","description":"A container management utility was executed in a container","expression":"exec.file.name in [\"docker\", \"kubectl\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bb8-sg5-ful","attributes":{"version":1,"name":"kernel_module_load_container","description":"A container loaded a new kernel module","expression":"load_module.name != \"\" && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yzz-sm2-0ff","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chmod","description":"Critical system binaries may have been modified","expression":"(\n    (chmod.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7nx-gb8-9t4","attributes":{"version":1,"name":"rc_scripts_modified","description":"RC scripts modified","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && (open.file.path in [\"/etc/rc.common\", \"/etc/rc.local\"])) && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"npo-tkf-eex","attributes":{"version":1,"name":"pam_modification_chmod","description":"PAM may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gw4-kqw-q1l","attributes":{"version":1,"name":"new_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"atm-kqf-qa2","attributes":{"version":1,"name":"systemd_modification_chmod","description":"A service may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oqc-9gu-uq5","attributes":{"version":1,"name":"ssl_certificate_tampering_utimes","description":"SSL certificates may have been tampered with","expression":"(\n    (utimes.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-7qi-s5j","attributes":{"version":1,"name":"pci_11_5_critical_binaries_unlink","description":"Critical system binaries may have been modified","expression":"(\n    (unlink.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bqm-bp1-dpv","attributes":{"version":1,"name":"nsswitch_conf_mod_link","description":"nsswitch may have been modified without authorization","expression":"(\n    (link.file.path in [ \"/etc/nsswitch.conf\" ]\n    || link.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nah-p3m-dgh","attributes":{"version":1,"name":"database_shell_execution","description":"A database application spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\nprocess.parent.file.name in [\"mysqld\", \"mongod\", \"postgres\"] &&\n!(process.parent.file.name == \"initdb\" &&\nexec.args == \"-c locale -a\") &&\n!(process.parent.file.name == \"postgres\" &&\nexec.args == ~\"*pg_wal*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4mm-9uv-w3t","attributes":{"version":1,"name":"shell_profile_modification","description":"Shell profile was modified","expression":"open.file.path in [~\"/home/*/*profile\", ~\"/home/*/*rc\"] && open.flags & ((O_CREAT|O_TRUNC|O_RDWR|O_WRONLY)) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6q-hmw-lae","attributes":{"version":1,"name":"auditd_config_modified","description":"The auditd configuration file was modified without using auditctl","expression":"open.file.path == \"/etc/audit/auditd.conf\" && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"brz-yda-nve","attributes":{"version":1,"name":"ssh_authorized_keys_link","description":"SSH modified keys may have been modified","expression":"(\n    link.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (link.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || link.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4be-qms-wyo","attributes":{"version":1,"name":"windows_update_registry_key_modified","description":"Windows update registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsUpdate*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ttl-6wn-1ke","attributes":{"version":1,"name":"ssh_it_tool_config_write","description":"The configuration directory for an ssh worm","expression":"open.file.path in [~\"/root/.prng/*\", ~\"/home/*/.prng/*\", ~\"/root/.config/prng/*\", ~\"/home/*/.config/prng/*\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n0c-0if-hne","attributes":{"version":1,"name":"nsswitch_conf_mod_chmod","description":"nsswitch may have been modified without authorization","expression":"(\n    (chmod.file.path in [ \"/etc/nsswitch.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ryr-yxl-ilk","attributes":{"version":1,"name":"nsswitch_conf_mod_utimes","description":"nsswitch may have been modified without authorization","expression":"(\n    (utimes.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"61g-xow-oup","attributes":{"version":1,"name":"nsswitch_conf_mod_chown","description":"nsswitch may have been modified without authorization","expression":"(\n    (chown.file.path in [ \"/etc/nsswitch.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"es9-b6s-upq","attributes":{"version":1,"name":"ssl_certificate_tampering_open_v2","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"\n&& container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x79-zfs-0ix","attributes":{"version":1,"name":"omigod","description":"Omiagent spawns a privileged child process","expression":"exec.uid >= 0 && process.ancestors.file.name == \"omiagent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8ks-vsd-y6y","attributes":{"version":1,"name":"ssl_certificate_tampering_open","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zb2-wpx-aff","attributes":{"version":1,"name":"new_binary_execution_in_container","description":"A container executed a new binary not found in the container image","expression":"container.id != \"\" && process.file.in_upper_layer && process.file.modification_time < 30s && exec.file.name != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k6c-tqa-hjv","attributes":{"version":1,"name":"ssh_authorized_keys_open_v2","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uwk-qfs-oqe","attributes":{"version":1,"name":"kernel_module_chmod","description":"A new kernel module was added","expression":"(\n    (chmod.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"czs-lbr-7k2","attributes":{"version":1,"name":"ptrace_antidebug","description":"A process uses an anti-debugging technique to block debuggers","expression":"ptrace.request == PTRACE_TRACEME && process.file.name != \"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bpu-wji-3ed","attributes":{"version":1,"name":"exec_lsmod","description":"Kernel modules were listed using the lsmod command","expression":"exec.comm == \"lsmod\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jch-xfg-uak","attributes":{"version":1,"name":"nsswitch_conf_mod_unlink","description":"nsswitch may have been modified without authorization","expression":"(\n    (unlink.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yue-sj6-ucc","attributes":{"version":1,"name":"ssl_certificate_tampering_rename","description":"SSL certificates may have been tampered with","expression":"(\n    (rename.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || rename.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rp7-w2i-wnj","attributes":{"version":1,"name":"credential_modified_link","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (link.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || link.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mcj-rg7-foe","attributes":{"version":1,"name":"credential_modified_rename","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (rename.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || rename.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yu3-bwu-ji4","attributes":{"version":1,"name":"nick_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jcr-yly-myj","attributes":{"version":1,"name":"ssl_certificate_tampering_chown","description":"SSL certificates may have been tampered with","expression":"(\n    (chown.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"llc-wxw-5uh","attributes":{"version":1,"name":"dirty_pipe_attempt","description":"Potential Dirty pipe exploitation attempt","expression":"(splice.pipe_entry_flag & PIPE_BUF_FLAG_CAN_MERGE) != 0 && (splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) == 0 && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x7k-bop-jcu","attributes":{"version":1,"name":"windows_com_rpc_debugging_registry_key_modified","description":"Windows RPC COM debugging registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ypb-aen-wts","attributes":{"version":1,"name":"mount_host_fs","description":"The host file system was mounted in a container","expression":"mount.source.path == \"/\" && mount.fs_type != \"overlay\" && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zjd-e62-fkk","attributes":{"version":1,"name":"release_agent_container_breakout","description":"A process attempted to write to the release_agent file of a cgroup, indicating a potential container breakout attempt","expression":"container.id != \"\" && open.file.name == \"release_agent\" && open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":1646684459816,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgc-7yd-gpm","attributes":{"version":1,"name":"pci_11_5_critical_binaries_rename","description":"Critical system binaries may have been modified","expression":"(\n    (rename.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || rename.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bue-96a-bwo","attributes":{"version":1,"name":"pam_modification_rename","description":"PAM may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || rename.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nue-ulh-gxb","attributes":{"version":1,"name":"aws_imds","description":"An AWS IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/latest/meta-data/iam/security-credentials/*\", ~\"*169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\", ~\"*169.254.170.2/*/credentials?id=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"55u-gp9-m0k","attributes":{"version":1,"name":"invalid_agent_constraint","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"0.0.0 >= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8og-5of-lw8","attributes":{"version":1,"name":"offensive_k8s_tool","description":"A known kubernetes pentesting tool has been executed","expression":"(exec.file.name in [ ~\"python*\" ] && (\"KubiScan.py\" in exec.argv || \"kubestriker\" in exec.argv ) ) || exec.file.name in [ \"kubiscan\",\"kdigger\",\"kube-hunter\",\"rakkess\",\"peirates\",\"kubescape\",\"kubeaudit\",\"kube-linter\",\"stratus\",~\"botb-*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fdj-qws-x9g","attributes":{"version":1,"name":"sudoers_policy_modified_chmod","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chmod.file.path == \"/etc/sudoers\")\n) && chmod.file.destination.mode != chmod.file.mode && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqf-gv4-huh","attributes":{"version":1,"name":"windows_test_default_rule_b","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jji-uaq-xqi","attributes":{"version":1,"name":"net_util_in_container","description":"A network utility was executed in a container","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id != \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tj0-f4s-grz","attributes":{"version":1,"name":"pam_modification_chown","description":"PAM may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mmg-bkt-mx4","attributes":{"version":1,"name":"exec_whoami","description":"The whoami command was executed","expression":"exec.comm == \"whoami\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ao4-966-ahr","attributes":{"version":1,"name":"sensitive_tracing","description":"A process is tracing privileged processes or sshd for possible credential dumping","expression":"(ptrace.request == PTRACE_PEEKTEXT || ptrace.request == PTRACE_PEEKDATA || ptrace.request == PTRACE_PEEKUSR) && ptrace.tracee.euid == 0 && process.comm not in [\"dlv\", \"dlv-linux-amd64\", \"strace\", \"gdb\", \"lldb-server\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mrk-tku-sbc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chown","description":"Critical system binaries may have been modified","expression":"(\n    (chown.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nk2-hcg-hf5","attributes":{"version":1,"name":"kernel_module_load_from_memory","description":"A kernel module was loaded from memory","expression":"load_module.loaded_from_memory == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hau-g4f-zzo","attributes":{"version":1,"name":"apparmor_modified_tty","description":"An AppArmor profile was modified in an interactive session","expression":"exec.file.name in [\"aa-disable\", \"aa-complain\", \"aa-audit\"] && exec.tty_name !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0gp-zoy-gyb","attributes":{"version":1,"name":"runc_leaky_fd","description":"The container breakout CVE-2024-21626 was successful","expression":"chdir.syscall.path =~ \"/proc/self/fd/*\" && chdir.file.path == \"/sys/fs/cgroup\" && process.file.name =~ \"runc.*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wqb-yxc-mtb","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open_v2","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vpa-xoh-cia","attributes":{"version":1,"name":"procdump_execution","description":"A tool used to dump process memory has been executed","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vlv-1qs-cjz","attributes":{"version":1,"name":"sudoers_policy_modified_rename","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (rename.file.path == \"/etc/sudoers\"\n    || rename.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"itl-shq-qre","attributes":{"version":1,"name":"nsswitch_conf_mod_open_v2","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && container.created_at > 90s && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fpl-fno-4u3","attributes":{"version":1,"name":"aws_eks_service_account_token_accessed","description":"The AWS EKS service account token was accessed","expression":"open.file.path =~ \"/var/run/secrets/eks.amazonaws.com/serviceaccount/**\" && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"3vq-bya-qsj","attributes":{"version":1,"name":"windows_security_essentials_executable_modified","description":"microsoft security essentials executable modified","expression":"write.file.device_path in [~\"\\Device\\*\\Program Files\\Microsoft Security Client\\msseces.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"08i-pvz-95h","attributes":{"version":1,"name":"crackmap_exec_executed","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme.exe*\", ~\"*cme.py*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpx-hnf-bc6","attributes":{"version":1,"name":"critical_registry_export","description":"regedit used to export critical registry hive","expression":"exec.file.name in [\"reg.exe\", \"regedit.exe\"] && exec.cmdline in [~\"*hklm*\", ~\"*hkey_local_machine*\", ~\"*system*\", ~\"*sam*\", ~\"*security*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aoh-97n-qus","attributes":{"version":1,"name":"redis_save_module","description":"Redis module has been created","expression":"(open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0 && open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.rdb\", ~\"*.aof\", ~\"*.so\"]) && process.file.name in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqg-9ps-mhw","attributes":{"version":1,"name":"passwd_execution","description":"The passwd or chpasswd utility was used to modify an account password","expression":"exec.file.path in [\"/usr/bin/passwd\", \"/usr/sbin/chpasswd\"] && exec.args_flags not in [\"S\", \"status\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4r-2xn-ha0","attributes":{"version":1,"name":"sudoers_policy_modified_open","description":"Sudoers policy file may have been modified without authorization","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n(open.file.path == \"/etc/sudoers\")) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"azw-x88-p7j","attributes":{"version":1,"name":"kubernetes_dns_enumeration","description":"Kubernetes DNS enumeration","expression":"dns.question.name == \"any.any.svc.cluster.local\" && dns.question.type == SRV && container.id != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vma-bsh-4d1","attributes":{"version":1,"name":"kernel_msr_write","description":"A process attempted to enable writing to model-specific registers","expression":"exec.comm == \"modprobe\" && process.args =~ \"*msr*allow_writes*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aed-rue-lpr","attributes":{"version":1,"name":"ip_check_domain","description":"A DNS lookup was done for a IP check service","expression":"dns.question.name in [\"icanhazip.com\", \"ip-api.com\", \"myip.opendns.com\", \"checkip.amazonaws.com\", \"whatismyip.akamai.com\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"stp-dwk-4j7","attributes":{"version":1,"name":"delete_system_log","description":"A process deleted common system log files","expression":"unlink.file.path in [\"/var/run/utmp\", \"/var/log/wtmp\", \"/var/log/btmp\", \"/var/log/lastlog\", \"/var/log/faillog\", \"/var/log/syslog\", \"/var/log/messages\", \"/var/log/secure\", \"/var/log/auth.log\", \"/var/log/boot.log\", \"/var/log/kern.log\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4s4-ezo-w7q","attributes":{"version":1,"name":"dynamic_linker_config_write","description":"A process wrote to a dynamic linker config file","expression":"open.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdc-uhk-mtc","attributes":{"version":1,"name":"ssh_authorized_keys_open","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgq-fea-q99","attributes":{"version":1,"name":"windows_system_enviroment_variable_registry_key_modified","description":"Windows environment variable registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Environment*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n9y-2nc-no0","attributes":{"version":1,"name":"dotnet_dump_execution","description":"Dotnet_dump was used to dump a process memory","expression":"exec.cmdline =~ \"*dotnet-dump*\" && exec.cmdline =~ \"*collect*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"r3m-72r-y8g","attributes":{"version":1,"name":"shell_history_truncated","description":"Shell History was Deleted","expression":"open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && open.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && open.file.path in [~\"/root/*\", ~\"/home/**\"] && process.file.name == \"truncate\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zqc-vts-wok","attributes":{"version":1,"name":"nsswitch_conf_mod_open","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"usg-zrs-ckt","attributes":{"version":1,"name":"winlogon_registry_key_modified","description":"Windows winlogon registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x4t-j4v-l4r","attributes":{"version":1,"name":"windows_explorer_executable_modified","description":"windows explorer file has been modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\explorer.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"9mk-a4g-rb5","attributes":{"version":1,"name":"crackmap_exec_usage","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cqr-wm9-cjl","attributes":{"version":1,"name":"systemd_modification_open","description":"A service may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cxw-5gm-pid","attributes":{"version":1,"name":"curl_docker_socket","description":"The Docker socket was referenced in a cURL command","expression":"exec.file.name == \"curl\" && exec.args_flags in [\"unix-socket\"] && exec.args in [~\"*docker.sock*\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpf-aeq-icx","attributes":{"version":1,"name":"ssh_authorized_keys_chown","description":"SSH modified keys may have been modified","expression":"(\n    chown.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chown.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iqk-ui0-v8c","attributes":{"version":1,"name":"hidden_file_executed","description":"A hidden file was executed in a suspicious folder","expression":"exec.file.name =~ \".*\" && exec.file.path in [~\"/home/**\", ~\"/tmp/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"s1j-kv4-llt","attributes":{"version":1,"name":"selinux_disable_enforcement","description":"SELinux enforcement status was disabled","expression":"selinux.enforce.status in [\"permissive\", \"disabled\"] && process.ancestors.args != ~\"*BECOME-SUCCESS*\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a9j-6xn-afo","attributes":{"version":1,"name":"sliver_c2_implant_execution","description":"process arguments match sliver c2 implant","expression":"exec.cmdline =~ \"*NoExit *\" && exec.cmdline =~ \"*Command *\" && exec.cmdline =~ \"*[Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vb1-l7o-skr","attributes":{"version":1,"name":"ssl_certificate_tampering_chmod","description":"SSL certificates may have been tampered with","expression":"(\n    (chmod.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.mode != chmod.file.destination.mode\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1or-3oo-rag","attributes":{"version":1,"name":"new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qme-vau-bk4","attributes":{"version":1,"name":"potential_web_shell_parent","description":"A web application spawned a shell or shell utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] || exec.comm in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\n(process.parent.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.parent.file.name =~ \"php*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7ft-hzb-mpc","attributes":{"version":1,"name":"critical_windows_files_modified","description":"a critical windows file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hbd-kty-ixx","attributes":{"version":1,"name":"kernel_module_utimes","description":"A new kernel module was added","expression":"(\n    (utimes.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rly-bqo-sg1","attributes":{"version":1,"name":"systemd_modification_utimes","description":"A service may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eda-l1r-hrq","attributes":{"version":1,"name":"relay_attack_tool_execution","description":"Process matches known relay attack tool","expression":"exec.file.name in [~\"*PetitPotam*\", ~\"*RottenPotato*\", ~\"*HotPotato*\", ~\"*JuicyPotato*\", ~\"*just_dce_*\", ~\"*Juicy Potato*\", \"rot.exe\", \"Potato.exe\", \"SpoolSample.exe\", \"Responder.exe\", ~\"*smbrelayx*\", ~\"*smbrelayx*\", ~\"*ntlmrelayx*\", ~\"*LocalPotato*\"] || exec.cmdline in [~\"*Invoke-Tater*\", ~\"*smbrelay*\", ~\"*ntlmrelay*\", ~\"*cme smb*\", ~\"*ntlm:NTLMhash*\", ~\"*Invoke-PetitPotam*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rbo-40l-grx","attributes":{"version":1,"name":"net_unusual_request","description":"Network utility executed with suspicious URI","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*.php*\", ~\"*.jpg*\"] ","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gci-o39-u6v","attributes":{"version":1,"name":"read_kubeconfig","description":"The kubeconfig file was accessed","expression":"open.file.path in [~\"/home/*/.kube/config\", \"/root/.kube/config\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1uw-i6q-m5n","attributes":{"version":1,"name":"nsswitch_conf_mod_rename","description":"nsswitch may have been modified without authorization","expression":"(\n    (rename.file.path in [ \"/etc/nsswitch.conf\" ]\n    || rename.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ynr-dvw-x2x","attributes":{"version":1,"name":"ssh_authorized_keys_rename","description":"SSH modified keys may have been modified","expression":"(\n    rename.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (rename.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || rename.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fme-ym2-lwi","attributes":{"version":1,"name":"systemd_modification_link","description":"A service may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || link.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tht-nwe-guf","attributes":{"version":1,"name":"k8s_pod_service_account_token_accessed","description":"The Kubernetes pod service account token was accessed","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"] && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"] && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6d-gre-qls","attributes":{"version":1,"name":"service_stop","description":"systemctl used to stop a service","expression":"exec.file.name == \"systemctl\" && exec.args in [~\"*stop*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ljs-qkf-c4r","attributes":{"version":1,"name":"pam_modification_open","description":"PAM may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vhj-z63-abi","attributes":{"version":1,"name":"systemd_modification_chown","description":"A service may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pho-wta-zir","attributes":{"version":1,"name":"net_util","description":"A network utility was executed","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id == \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"m36-fmz-1bi","attributes":{"version":1,"name":"executable_bit_added","description":"The executable bit was added to a newly created file","expression":"chmod.file.in_upper_layer &&\nchmod.file.change_time < 30s &&\ncontainer.id != \"\" &&\nchmod.file.destination.mode != chmod.file.mode &&\nchmod.file.destination.mode & S_IXUSR|S_IXGRP|S_IXOTH > 0 &&\nprocess.argv in [\"+x\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5j0-kon-1hn","attributes":{"version":1,"name":"sudoers_policy_modified_link","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (link.file.path == \"/etc/sudoers\"\n    || link.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hsw-h1t-p9n","attributes":{"version":1,"name":"suid_file_execution","description":"a SUID file was executed","expression":"(setuid.euid == 0 || setuid.uid  == 0)  && process.file.mode & S_ISUID > 0  && process.file.uid == 0  && process.uid != 0  && process.file.path != \"/usr/bin/sudo\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"da1-a9j-tw9","attributes":{"version":1,"name":"sudoers_policy_modified_unlink","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (unlink.file.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4tw-oex-wnc","attributes":{"version":1,"name":"cryptominer_args","description":"A process launched with arguments associated with cryptominers","expression":"exec.args_options in [~\"cpu-priority*\", ~\"donate-level*\"] || exec.args_flags == \"randomx-1gb-pages\" || exec.args in [~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uga-lal-zqb","attributes":{"version":1,"name":"php_spawning_shell","description":"PHP web application spawning shell","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name in [\"php.exe\",\"php-cgi.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"alv-iwj-sbs","attributes":{"version":1,"name":"systemd_modification_unlink","description":"A service may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nsy-20w-pj6","attributes":{"version":1,"name":"sharpup_tool_usage","description":"sharpup tool used for local privilege escalation","expression":"exec.file.name == \"sharpup.exe\" && exec.cmdline in [~\"*HijackablePaths*\", ~\"*UnquotedServicePath*\", ~\"*ProcessDLLHijack*\", ~\"*ModifiableServiceBinaries*\", ~\"*ModifiableScheduledTask*\", ~\"*DomainGPPPassword*\", ~\"*CachedGPPPassword*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mam-ir1-532","attributes":{"version":1,"name":"windows_cryptographic_blocking_policy_registry_key_modified","description":"Windows cryptographic blocking policy modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllRemoveSignedDataMsg*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tn9-vck-we9","attributes":{"version":1,"name":"shell_history_deleted","description":"Shell History was Deleted","expression":"unlink.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && unlink.file.path in [~\"/root/**\", ~\"/home/**\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ows-d9p-s2b","attributes":{"version":1,"name":"runc_modification","description":"The runc binary was modified in a non-standard way","expression":"open.file.path in [\"/usr/bin/runc\", \"/usr/sbin/runc\", \"/usr/bin/docker-runc\"]\n&& open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"on3-qxk-zeh","attributes":{"version":1,"name":"paste_site","description":"A DNS lookup was done for a pastebin-like site","expression":"dns.question.name in [\"pastebin.com\", \"ghostbin.com\", \"termbin.com\", \"klgrth.io\", \"rentry.co\", \"transfer.sh\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdi-lzv-pki","attributes":{"version":1,"name":"azure_imds","description":"An Azure IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/metadata/identity/oauth2/token?api-version=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qay-zpa-akb","attributes":{"version":1,"name":"rubeus_execution","description":"process arguments match rubeus credential theft tool","expression":"exec.cmdline in [~\"*asreproast*\", ~\"*/service:krbtgt*\", ~\"*dump /luid:0x*\", ~\"*kerberoast*\", ~\"*createonly /program*\", ~\"*ptt /ticket*\", ~\"*impersonateuser*\", ~\"*renew /ticket*\", ~\"*asktgt /user*\", ~\"*harvest /interval*\", ~\"*s4u /user*\", ~\"*hash /password*\", ~\"*golden /aes256*\", ~\"*silver /user*\", \"*rubeus*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uty-ayo-tpv","attributes":{"version":1,"name":"wmi_spawning_shell","description":"Command executed via WMI","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name == \"WmiPrvSE.exe\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"icy-i3s-bvd","attributes":{"version":1,"name":"deploy_priv_container","description":"A privileged container was created","expression":"exec.file.name != \"\" && container.created_at < 1s && process.cap_permitted & CAP_SYS_ADMIN > 0","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6du-s2a-foz","attributes":{"version":1,"name":"suspicious_bitsadmin_usage","description":"A suspicious bitsadmin command has been executed","expression":"exec.file.name == \"bitsadmin.exe\" && exec.cmdline in [~\"*addfile*\", ~\"*create*\", ~\"*resume*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dco-vsp-sto","attributes":{"version":1,"name":"ssh_authorized_keys_chmod","description":"SSH modified keys may have been modified","expression":"(\n    chmod.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chmod.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyc-tp1-xr1","attributes":{"version":1,"name":"windows_boot_registry_key_modified","description":"Windows boot registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\IniFileMapping\\SYSTEM.ini\\boot*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-cg7-96w","attributes":{"version":1,"name":"sudoers_policy_modified_chown","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chown.file.path == \"/etc/sudoers\")\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bft-ikt-sfa","attributes":{"version":1,"name":"registry_service_runkey_modified","description":"Service registry runkey modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\CurrentVersion\\RunServices\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ydm-yqo-f9t","attributes":{"version":1,"name":"looney_tunables_exploit","description":"Looney Tunables (CVE-2023-4911) exploit attempted","expression":"exec.file.mode & S_ISUID > 0 && exec.file.uid == 0 && exec.uid != 0 && exec.envs in [~\"*GLIBC_TUNABLES*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wpy-igs-bcp","attributes":{"version":1,"name":"windows_shell_folders_registry_key_modified","description":"Windows shell folders registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders*\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gyj-yid-n02","attributes":{"version":1,"name":"ptrace_injection","description":"A process attempted to inject code into another process","expression":"ptrace.request == PTRACE_POKETEXT || ptrace.request == PTRACE_POKEDATA || ptrace.request == PTRACE_POKEUSR","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kxe-vss-47x","attributes":{"version":1,"name":"windows_firewall_configuration_registry_key_modified","description":"Windows firewall configuration registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zxv-eui-tgr","attributes":{"version":1,"name":"auditctl_usage","description":"The auditctl command was used to modify auditd","expression":"exec.file.name == \"auditctl\" && exec.args_flags not in [\"s\", \"l\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ccs-c0e-kx6","attributes":{"version":1,"name":"minidump_usage","description":"Process memory was dumped using the minidump function from comsvcs.dll","expression":"exec.cmdline =~ \"*MiniDump*\" && exec.cmdline =~ \"*comsvcs*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"we1-nic-zhp","attributes":{"version":1,"name":"base64_decode","description":"The base64 command was used to decode information","expression":"exec.file.name == \"base64\" && exec.args_flags in [\"d\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mjs-qml-f6e","attributes":{"version":1,"name":"systemd_modification_rename","description":"A service may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"elg-0ho-jjb","attributes":{"version":1,"name":"powershell_empire_uac_bypass","description":"A process was executed matching arguments for a UAC bypass technique common in powershell empire","expression":"exec.cmdline in [~\"*-NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*\", ~\"*-NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dzi-svp-ub2","attributes":{"version":1,"name":"memfd_create","description":"memfd object created","expression":"exec.file.name =~ \"memfd*\" && exec.file.path == \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iv0-azx-iwi","attributes":{"version":1,"name":"interactive_shell_in_container","description":"An interactive shell was started inside of a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && exec.args_flags in [\"i\"] && container.id !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mgb-ejl-c5b","attributes":{"version":1,"name":"kernel_module_rename","description":"A new kernel module was added","expression":"(\n    (rename.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dug-aqp-7zn","attributes":{"version":1,"name":"exec_wrmsr","description":"The wrmsr program executed","expression":"exec.comm == \"wrmsr\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wrz-nq9-pi8","attributes":{"version":1,"name":"mining_pool_lookup","description":"A process resolved a DNS name associated with cryptomining activity","expression":"dns.question.name in [~\"*.minexmr.com\", \"minexmr.com\", ~\"*.nanopool.org\", \"nanopool.org\", ~\"*.supportxmr.com\", \"supportxmr.com\", ~\"*.c3pool.com\", \"c3pool.com\", ~\"*.p2pool.io\", \"p2pool.io\", ~\"*.ethermine.org\", \"ethermine.org\", ~\"*.f2pool.com\", \"f2pool.com\", ~\"*.poolin.me\", \"poolin.me\", ~\"*.rplant.xyz\", \"rplant.xyz\", ~\"*.miningocean.org\", \"miningocean.org\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"01c-hgk-8x3","attributes":{"version":1,"name":"credential_modified_chmod","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chmod.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ld1-hxu-zdf","attributes":{"version":1,"name":"nick_new_java_detect_with_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"foogazi\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"z0y-kio-bf4","attributes":{"version":1,"name":"kernel_module_open","description":"A new kernel module was added","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xtf-uqt-mh0","attributes":{"version":1,"name":"common_net_intrusion_util","description":"A network utility (nmap) commonly used in intrusion attacks was executed","expression":"exec.file.name in [\"nmap\", \"masscan\", \"fping\", \"zgrab\", \"zgrab2\", \"rustscan\", \"pnscan\"] && exec.args_flags not in [\"V\", \"version\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"l5b-qmr-hi6","attributes":{"version":1,"name":"ssh_authorized_keys_utimes","description":"SSH modified keys may have been modified","expression":"(\n    utimes.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (utimes.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qa1-stp-xpl","attributes":{"version":1,"name":"open_msr_writes","description":"A process opened a model-specific register (MSR) configuration file","expression":"open.file.path == \"/sys/module/msr/parameters/allow_writes\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cwr-kgl-5xs","attributes":{"version":1,"name":"credential_modified_chown","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chown.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"am6-icr-cgg","attributes":{"version":1,"name":"package_management_in_container","description":"Package management was detected in a container","expression":"exec.file.path in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"esx-z8e-qcs","attributes":{"version":1,"name":"safeboot_modification","description":"Safeboot registry modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\SafeBoot\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sdk-dp7-vt0","attributes":{"version":1,"name":"jupyter_shell_execution","description":"A Jupyter notebook executed a shell","expression":"(exec.file.name in [\"cat\",\"chgrp\",\"chmod\",\"chown\",\"cp\",\"date\",\"dd\",\"df\",\"dir\",\"echo\",\"ln\",\"ls\",\"mkdir\",\"mknod\",\"mktemp\",\"mv\",\"pwd\",\"readlink\",\"rm\",\"rmdir\",\"sleep\",\"stty\",\"sync\",\"touch\",\"uname\",\"vdir\",\"arch\",\"b2sum\",\"base32\",\"base64\",\"basename\",\"chcon\",\"cksum\",\"comm\",\"csplit\",\"cut\",\"dircolors\",\"dirname\",\"du\",\"env\",\"expand\",\"expr\",\"factor\",\"fmt\",\"fold\",\"groups\",\"head\",\"hostid\",\"id\",\"install\",\"join\",\"link\",\"logname\",\"md5sum\",\"textutils\",\"mkfifo\",\"nice\",\"nl\",\"nohup\",\"nproc\",\"numfmt\",\"od\",\"paste\",\"pathchk\",\"pinky\",\"pr\",\"printenv\",\"printf\",\"ptx\",\"realpath\",\"runcon\",\"seq\",\"sha1sum\",\"sha224sum\",\"sha256sum\",\"sha384sum\",\"sha512sum\",\"shred\",\"shuf\",\"sort\",\"split\",\"stat\",\"stdbuf\",\"sum\",\"tac\",\"tail\",\"tee\",\"test\",\"timeout\",\"tr\",\"truncate\",\"tsort\",\"tty\",\"unexpand\",\"uniq\",\"unlink\",\"users\",\"wc\",\"who\",\"whoami\",\"chroot\"] || exec.file.name in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"]) && process.ancestors.comm in [\"jupyter-noteboo\", \"jupyter-lab\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hnz-ezh-lyu","attributes":{"version":1,"name":"ld_preload_unusual_library_path","description":"The LD_PRELOAD variable is populated by a link to a suspicious file directory","expression":"exec.envs in [~\"LD_PRELOAD=*/tmp/*\", ~\"LD_PRELOAD=/dev/shm/*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjo-mdq-mi1","attributes":{"version":1,"name":"dynamic_linker_config_unlink","description":"A process unlinked a dynamic linker config file","expression":"unlink.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"psf-hiy-3ji","attributes":{"version":1,"name":"scheduled_task_creation","description":"A scheduled task was created","expression":"exec.cmdline in [~\"*at.exe\",~\"*schtasks*\"] && exec.cmdline =~ \"*create*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6vb-fkj-cdc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ktg-ng9-izk","attributes":{"version":1,"name":"kernel_module_load_from_memory_container","description":"A kernel module was loaded from memory inside a container","expression":"load_module.loaded_from_memory == true && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0qf-cha-qci","attributes":{"version":1,"name":"java_shell_execution_parent","description":"A java process spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"])\n&& process.parent.file.name in [\"java\", \"jspawnhelper\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gz3-l4z-bzr","attributes":{"version":1,"name":"network_sniffing_tool","description":"Local account groups were enumerated after container start up","expression":"exec.file.name in [\"tcpdump\", \"tshark\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hob-7or-knu","attributes":{"version":1,"name":"python_cli_code","description":"Python code was provided on the command line","expression":"exec.file.name == ~\"python*\" && exec.args_flags in [\"c\"] && exec.args in [~\"*-c*SOCK_STREAM*\", ~\"*-c*subprocess*\", ~\"*-c*/bash*\", ~\"*-c*/bin/sh*\", ~\"*-c*pty.spawn*\"] && exec.args !~ \"*setuptools*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"buh-tbl-6k1","attributes":{"version":1,"name":"pci_11_5_critical_binaries_link","description":"Critical system binaries may have been modified","expression":"(\n    (link.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || link.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521243,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"}]}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 182.42925ms
    - id: 6
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":[{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"vg6-omq-vv4","attributes":{"version":1,"name":"wawhgdyumt","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295102041,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295102041,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"3yb-106-xrm","attributes":{"version":3,"name":"my_terraform_rule2","description":"my terraform rule","expression":"bind.addr.ip==1.6.1.9","category":"Kernel Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747140640989,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747141373736,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"rtp-dom-1am","attributes":{"version":1,"name":"agent_rule2","description":"My Agent rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":true,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747062863277,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747062863277,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"1vs-h3p-spa","attributes":{"version":1,"name":"000000bangtestnumber","description":"should_work_with_number","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702433529,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":60000000,"append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g5c-vnp-xf2","attributes":{"version":1,"name":"000000bangtest","description":"should_work_with_string","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702410743,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d4v-xci-tzk","attributes":{"version":1,"name":"000000second","description":"ahahaha","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743701600763,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"by5-5gy-ajb","attributes":{"version":2,"name":"kernel_module_load","description":"A kernel module was loaded","expression":"load_module.loaded_from_memory == false && load_module.name not in [\"nf_tables\", \"iptable_filter\", \"ip6table_filter\", \"bpfilter\", \"ip6_tables\", \"ip6table_nat\", \"nf_reject_ipv4\", \"ipt_REJECT\", \"iptable_raw\", \"udp_diag\", \"inet_diag\"] && process.ancestors.file.name not in [~\"falcon*\", \"unattended-upgrade\", \"apt.systemd.daily\", \"xtables-legacy-multi\", \"ssm-agent-worker\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737734329380,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"c5x-fzi-cfu","attributes":{"version":2,"name":"known_dll_registry_key_modified","description":"Windows Known DLLs location registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737044905726,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fcw-skn-8l6","attributes":{"version":1,"name":"shell_net_connection","description":"A shell made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && process.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"] && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980532395,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jwd-mhg-rzc","attributes":{"version":1,"name":"interpreter_outbound_connection","description":"An interpreter made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && process.file.name in [~\"python2*\", ~\"python3*\", \"node\", \"perl\", ~\"ruby*\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980527270,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7k7-mzh-fhj","attributes":{"version":1,"name":"irc_connection","description":"A process made an outbound IRC connection","expression":"connect.addr.port == 6667 && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980517121,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gff-p0p-hzz","attributes":{"version":1,"name":"p2pinfect_connection","description":"A process made a connection to a port associated with P2PInfect malware","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && connect.addr.port >= 60100 && connect.addr.port <= 60150","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980466118,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0yh-tmv-2ir","attributes":{"version":1,"name":"socat_shell","description":"Process arguments indicating possible socat shell detected","expression":"((exec.file.name == \"socat\") || (exec.comm == \"socat\")) && exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\", ~\"*exec*\", ~\"*pty*\", ~\"*setsid*\", ~\"*stderr*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536410363,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zwp-lhw-osb","attributes":{"version":1,"name":"udev_modification","description":"Device rule created","expression":"open.file.path in [~\"/etc/udev/rules.d/*\", ~\"/lib/udev/rules.d/*\", ~\"/usr/lib/udev/rules.d/*\", ~\"/usr/local/lib/udev/rules.d/*\", ~\"/run/udev/rules.d/*\"] && open.flags & O_CREAT > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405283,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"p4u-oh0-avq","attributes":{"version":1,"name":"devshm_execution","description":"A file executed from /dev/shm/ directory","expression":"exec.file.path == \"/dev/shm/**\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jdx-661-6he","attributes":{"version":1,"name":"ssh_nonstandard_connection","description":"SSH initiated a connection on a nonstandard port","expression":"connect.addr.port in [80, 8080, 88, 443, 8443, 4444] && process.file.name == \"ssh\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395054,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ozf-woz-u9t","attributes":{"version":2,"name":"libpam_ebpf_hook","description":"Library libpam.so hooked using eBPF","expression":"bpf.cmd == BPF_MAP_CREATE && process.args in [r\"libpam\\.so\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395021,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k02-h52-5kl","attributes":{"version":1,"name":"overwrite_entrypoint","description":"A process attempted to overwrite the container entrypoint","expression":"open.file.path == \"/proc/self/fd/1\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0 && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389957,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qwh-aci-cax","attributes":{"version":2,"name":"cron_at_job_creation_open","description":"An unauthorized job was added to cron scheduling","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389882,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cvg-paj-akm","attributes":{"version":2,"name":"cron_at_job_creation_chown","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chown.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536379705,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ecq-lqb-dko","attributes":{"version":1,"name":"find_credentials","description":"find command searching for sensitive files","expression":"exec.comm == \"find\" && exec.args in [~\"*credentials*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374661,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jig-hjw-dqq","attributes":{"version":1,"name":"webdriver_spawned_shell","description":"Browser WebDriver spawned shell","expression":"process.parent.file.name in [~\"chromedriver*\", \"geckodriver\"] && exec.file.name not in [\"chrome\", \"google-chrome\", \"chromium\", \"firefox\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374638,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cjg-f8o-kp3","attributes":{"version":2,"name":"tunnel_traffic","description":"Tunneling or port forwarding tool used","expression":"((exec.comm == \"pivotnacci\" || exec.comm == \"gost\") && process.args_flags in [\"L\", \"C\", \"R\"]) || (exec.comm in [\"ssh\", \"sshd\"] && process.args_flags in [\"R\", \"L\", \"D\", \"w\"] && process.args in [r\"((25[0-5]|(2[0-4]|1\\d|[1-9])\\d)\\.?\\b){4}\"] ) || (exec.comm == \"sshuttle\" && process.args_flags in [\"r\", \"remote\", \"l\", \"listen\"]) || (exec.comm == \"socat\" && process.args in [r\"(TCP4-LISTEN:|SOCKS)\"]) || (exec.comm in [\"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\", \"ssf\", \"3proxy\", \"ngrok\"] && process.parent.comm in [\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"])","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374597,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-5ct-v09","attributes":{"version":1,"name":"netcat_shell","description":"Process arguments indicating possible netcat shell detected","expression":"exec.file.name in [\"netcat\", \"nc\", \"ncat\"] && ((exec.args_flags in [\"l\"] && exec.args_flags in [\"p\"]) || (exec.args_flags in [\"n\"] && exec.args_flags in [\"v\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536369507,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qyq-78u-ql6","attributes":{"version":1,"name":"cups_spawned_shell","description":"Shell process spawned from print server","expression":"exec.file.name != \"\" && process.parent.file.name == \"foomatic-rip\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364424,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdw-b2j-bpy","attributes":{"version":1,"name":"debugfs_in_container","description":"The debugfs was executed in a container","expression":"exec.comm == \"debugfs\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364396,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dt3-f0b-e8d","attributes":{"version":1,"name":"webapp_imds_V1_request","description":"Web application requested IMDSv1 credentials","expression":"imds.aws.is_imds_v2 == false && imds.url =~ \"*/*/meta-data/iam/security-credentials/*\" && (process.ancestors.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.ancestors.file.name =~ \"php*\" || process.ancestors.file.name == \"java\")","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359279,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dat-hhr-7xk","attributes":{"version":2,"name":"cron_at_job_creation_link","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (link.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || link.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-hyn-s1j","attributes":{"version":1,"name":"release_agent_escape","description":"Container escape attempted by overwriting release_agent","expression":"open.file.name == \"release_agent\" && open.file.path in [\"/tmp/**\", \"/home/**\", \"/root/**\", \"/*\"] && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354195,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vvo-iqz-sr2","attributes":{"version":1,"name":"file_sync_exfil","description":"The rclone utility was executed","expression":"exec.file.name in [\"rclone\", \"rsync\", \"sftp\", \"ftp\", \"scp\", \"dcp\", \"rcp\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354189,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-jbt-ag7","attributes":{"version":1,"name":"unshare_in_container","description":"The unshare utility was executed in a container","expression":"exec.comm == \"unshare\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349072,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rhn-60e-ocl","attributes":{"version":2,"name":"iptables_egress_allowed","description":"Egress traffic allowed using iptables","expression":"exec.comm == \"iptables\" && process.args in [r\"OUTPUT.*((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}.*ACCEPT\"] && process.args not in [r\"(127\\.)|(10\\.)|(172\\.1[6-9]\\.)|(172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(192\\.168\\.)|(169\\.254\\.)\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349046,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ol8-rm4-6j5","attributes":{"version":1,"name":"aws_cli_usage","description":"The AWS CLI utility was executed","expression":"exec.file.name == \"aws\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343955,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"956-hlb-btg","attributes":{"version":1,"name":"php_shell","description":"Process arguments indicating possible php shell detected","expression":"exec.file.name == \"php\" && exec.args_flags in [\"r\"] && ((exec.args in [~\"*socket_bind*\", ~\"*socket_listen*\", ~\"*socket_accept*\", ~\"*socket_create*\", ~\"*socket_write*\", ~\"*socket_read*\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343942,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gu9-82k-92p","attributes":{"version":2,"name":"cron_at_job_creation_chmod","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chmod.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && chmod.file.destination.mode != chmod.file.mode\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343900,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oad-qwd-via","attributes":{"version":2,"name":"compile_after_delivery","description":"A compiler wrote a suspicious file in a container","expression":"open.flags & O_CREAT > 0\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.ko\", ~\".*\"])\n  || open.file.path in [~\"/var/tmp/**\", ~\"/root/**\", ~\"*/bin/*\", ~\"/usr/local/lib/**\"]\n)\n&& (process.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"])\n&& process.file.name not in [\"pip\", ~\"python*\"]\n&& container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536323502,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vx6-cyx-ksx","attributes":{"version":1,"name":"openssl_backdoor","description":"openssl used to establish backdoor","expression":"exec.comm == \"openssl\" && exec.args =~ \"*s_client*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318450,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4p-qiy-v1g","attributes":{"version":2,"name":"compiler_in_container","description":"A compiler was executed inside of a container","expression":"(exec.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || exec.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || (exec.file.name == \"go\" && exec.args in [~\"*build*\", ~\"*run*\"])) && container.id !=\"\" && process.ancestors.file.path != \"/usr/bin/cilium-agent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318401,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n17-fnl-a6b","attributes":{"version":1,"name":"mount_in_container","description":"The mount utility was executed in a container","expression":"exec.comm == \"mount\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313319,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ylt-39s-jwc","attributes":{"version":2,"name":"cron_at_job_creation_unlink","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (unlink.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313305,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyp-ktn-4kd","attributes":{"version":1,"name":"nsenter_in_container","description":"nsenter used to breakout of container","expression":"exec.file.name == \"nsenter\" && exec.args_options in [\"target=1\", \"t=1\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308211,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mp4-mte-fr7","attributes":{"version":1,"name":"ssh_outbound_connection","description":"A process connected to an SSH server","expression":"connect.addr.port == 22 && connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.ip not in [127.0.0.0/8]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308194,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jix-kop-8dg","attributes":{"version":2,"name":"ransomware_note","description":"Possible ransomware note created under common user directories","expression":"open.flags & O_CREAT > 0\n&& open.file.path in [~\"/home/**\", ~\"/root/**\", ~\"/bin/**\", ~\"/usr/bin/**\", ~\"/opt/**\", ~\"/etc/**\", ~\"/var/log/**\", ~\"/var/lib/log/**\", ~\"/var/backup/**\", ~\"/var/www/**\"]\n&& open.file.name in [r\"(?i)(restore|recover|read|instruction|how_to|ransom|lock).*(your_|crypt|lock|file|ransom)\"] && open.file.name not in [r\"\\.lock$\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308136,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x0q-bqb-eo1","attributes":{"version":2,"name":"windows_cryptominer_process","description":"A cryptominer was potentially executed","expression":"exec.cmdline in [~\"*cpu-priority*\", ~\"*donate-level*\", ~\"*randomx-1gb-pages*\", ~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536303070,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"txo-xll-se0","attributes":{"version":2,"name":"suspicious_dll_write","description":"Dll written to a suspicious directory","expression":"create.file.name =~ \"*.dll\" && create.file.device_path not in [~\"\\Device\\*\\Windows\\System32\\**\", ~\"\\Device\\*\\ProgramData\\docker\\**\"] && process.file.name != \"dockerd.exe\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536297939,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zig-zjk-wem","attributes":{"version":1,"name":"perl_shell","description":"Process arguments indicating possible perl bind shell detected","expression":"exec.file.name == ~\"perl*\" && exec.args_flags in [\"e\"] && ((exec.args in [~\"*socket*\", ~\"*bind*\", ~\"*sockaddr*\", ~\"*listen*\", ~\"*accept\", ~\"*stdin*\", ~\"*stdout\"]) || (exec.args in [~\"*/bin/sh*\", ~\"*/bin/bash*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292914,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qfj-nw1-1zg","attributes":{"version":1,"name":"modified_file_requesting_imds_creds","description":"Recently modified file requested credentials from IMDS","expression":"imds.url =~ \"/*/meta-data/iam/security-credentials/*\" && (process.parent.file.modification_time < 120s || process.file.modification_time < 30s)","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292897,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yhp-mh7-pgn","attributes":{"version":2,"name":"cron_at_job_creation_rename","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (rename.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || rename.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287823,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ers-kyx-kaq","attributes":{"version":2,"name":"cron_at_job_creation_utimes","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (utimes.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287800,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sjm-2is-v4s","attributes":{"version":1,"name":"tar_execution","description":"Tar archive created","expression":"exec.file.path == \"/usr/bin/tar\" && exec.args_flags in [\"create\",\"c\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xhr-7kq-dpo","attributes":{"version":1,"name":"user_deleted_tty","description":"A user was deleted via an interactive session","expression":"exec.file.name in [\"userdel\", \"deluser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d0z-hzd-y7v","attributes":{"version":1,"name":"cryptominer_envs","description":"Process environment variables match cryptocurrency miner","expression":"exec.envs in [\"POOL_USER\", \"POOL_URL\", \"POOL_PASS\", \"DONATE_LEVEL\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eav-mud-yh0","attributes":{"version":1,"name":"credential_modified_utimes","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (utimes.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g2j-1lc-iub","attributes":{"version":1,"name":"kernel_module_chown","description":"A new kernel module was added","expression":"(\n    (chown.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5x8-617-k9v","attributes":{"version":1,"name":"chaussette","description":"Execution of a java process","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cdy-4sl-0vh","attributes":{"version":1,"name":"dirty_pipe_exploitation","description":"Potential Dirty pipe exploitation","expression":"(splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) > 0  && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8fk-hlc-jgx","attributes":{"version":1,"name":"registry_hives_file_path_key_modified","description":"Windows registry hives file location key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\hivelist*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ggj-tkx-3i5","attributes":{"version":1,"name":"windows_hosts_file_modified","description":"the windows hosts file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\Drivers\\etc\\hosts\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hmg-jnt-cra","attributes":{"version":1,"name":"kernel_module_link","description":"A new kernel module was added","expression":"(\n    (link.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || link.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"b7q-33d-ehp","attributes":{"version":1,"name":"inveigh_tool_usage","description":"Process executed with arguments common with Inveigh tool usage","expression":"exec.cmdline in [~\"*SpooferIP*\", ~\"*ReplyToIPs*\", ~\"*ReplyToDomains*\", ~\"*ReplyToMACs*\", ~\"*SnifferIP*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdj-3ys-gul","attributes":{"version":1,"name":"redis_sandbox_escape","description":"Detects CVE-2022-0543","expression":"(open.file.path =~ \"/usr/lib/x86_64-linux-gnu/*\" && open.file.name in [\"libc-2.29.so\", \"libc-2.30.so\", \"libc-2.31.so\", \"libc-2.32.so\", \"libc-2.33.so\", \"libc-2.34.so\", \"libc-2.35.so\", \"libc-2.36.so\", \"libc-2.37.so\"]) && process.ancestors.comm in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kof-qfg-4z7","attributes":{"version":1,"name":"certutil_usage","description":"Certutil was executed to transmit or decode a potentially malicious file","expression":"exec.file.name == \"certutil.exe\" && ((exec.cmdline =~ \"*urlcache*\" && exec.cmdline =~ \"*split*\") || exec.cmdline =~ \"*decode*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"u0y-4yq-w99","attributes":{"version":1,"name":"pwnkit_privilege_escalation","description":"A process was spawned with indicators of exploitation of CVE-2021-4034","expression":"(exec.file.path == \"/usr/bin/pkexec\" && exec.envs in [~\"*SHELL*\", ~\"*PATH*\"] && exec.envs not in [~\"*DISPLAY*\", ~\"*DESKTOP_SESSION*\"] && exec.uid != 0)","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yyp-3qo-77g","attributes":{"version":1,"name":"pci_11_5_critical_binaries_utimes","description":"Critical system binaries may have been modified","expression":"(\n    (utimes.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ijj-sdz-ghy","attributes":{"version":1,"name":"nick_new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjg-ztr-xts","attributes":{"version":1,"name":"suspicious_ntdsutil_usage","description":"Suspicious usage of ntdsutil","expression":"exec.file.name == \"ntdsutil.exe\" && exec.cmdline in [~\"*ntds*\", ~\"*create*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fqj-dnw-hmo","attributes":{"version":1,"name":"kernel_module_unlink","description":"A new kernel module was added","expression":"(\n    (unlink.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4nd-g5m-1xh","attributes":{"version":1,"name":"mount_proc_hide","description":"Process hidden using mount","expression":"mount.mountpoint.path in [~\"/proc/1*\", ~\"/proc/2*\", ~\"/proc/3*\", ~\"/proc/4*\", ~\"/proc/5*\", ~\"/proc/6*\", ~\"/proc/7*\", ~\"/proc/8*\", ~\"/proc/9*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wui-ktw-zwv","attributes":{"version":1,"name":"pam_modification_utimes","description":"PAM may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yrc-jyx-l5i","attributes":{"version":1,"name":"tty_shell_in_container","description":"A shell with a TTY was executed in a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && process.tty_name != \"\" && process.container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vqh-8ry-vsb","attributes":{"version":1,"name":"pam_modification_link","description":"PAM may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || link.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n4m-q5y-yhu","attributes":{"version":1,"name":"ssl_certificate_tampering_unlink","description":"SSL certificates may have been tampered with","expression":"(\n    (unlink.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8i4-ehq-i3p","attributes":{"version":1,"name":"gcp_imds","description":"An GCP IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token\", ~\"*169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fje-48p-1n8","attributes":{"version":1,"name":"ssh_authorized_keys_unlink","description":"SSH modified keys may have been modified","expression":"(\n    unlink.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (unlink.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"luu-gor-cgb","attributes":{"version":1,"name":"sudoers_policy_modified_utimes","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (utimes.file.path == \"/etc/sudoers\")\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"89r-spf-prk","attributes":{"version":1,"name":"credential_modified_open_v2","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    open.flags & ((O_CREAT|O_RDWR|O_WRONLY|O_TRUNC)) > 0 &&\n    (open.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"490-ewn-i16","attributes":{"version":1,"name":"chatroom_request","description":"A DNS request was made for a chatroom domain","expression":"dns.question.name in [\"discord.com\", \"api.telegram.org\", \"cdn.discordapp.com\"]","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vzm-iv2-vhs","attributes":{"version":1,"name":"windows_test_default_rule","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pyu-xzd-leo","attributes":{"version":1,"name":"user_created_tty","description":"A user was created via an interactive session","expression":"exec.file.name in [\"useradd\", \"newusers\", \"adduser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && exec.args_flags not in [\"D\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zdm-kv0-gca","attributes":{"version":1,"name":"net_file_download","description":"A suspicious file was written by a network utility","expression":"open.flags & O_CREAT > 0 && process.comm in [\"wget\", \"curl\", \"lwp-download\"]\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.sh\", ~\"*.c\", ~\"*.so\", ~\"*.ko\"])\n  || open.file.path in [~\"/usr/**\", ~\"/lib/**\", ~\"/etc/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5ts-w6u-tfl","attributes":{"version":1,"name":"registry_runkey_modified","description":"A Registry runkey has been modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\RunonceEx\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jgi-rfz-rlb","attributes":{"version":1,"name":"pam_modification_unlink","description":"PAM may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"coy-qpb-suv","attributes":{"version":1,"name":"credential_modified_unlink","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (unlink.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-9tn-irt","attributes":{"version":1,"name":"ssl_certificate_tampering_link","description":"SSL certificates may have been tampered with","expression":"(\n    (link.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || link.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.name !~ \"runc*\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dig-cav-hhc","attributes":{"version":1,"name":"kmod_list","description":"Kernel modules were listed using the kmod command","expression":"exec.comm == \"kmod\" && exec.args in [~\"*list*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jlg-roy-9zx","attributes":{"version":1,"name":"auditd_rule_file_modified","description":"The auditd rules file was modified without using auditctl","expression":"open.file.path in [\"/etc/audit/rules.d/audit.rules\", \"/etc/audit/audit.rules\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"v83-av9-xuy","attributes":{"version":1,"name":"ntds_in_commandline","description":"NTDS file referenced in commandline","expression":"exec.cmdline =~ \"*ntds.dit*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rnj-nwd-n5v","attributes":{"version":1,"name":"procdump_usage","description":"Testing a default windows agent rule","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pjn-4hr-bot","attributes":{"version":1,"name":"suspicious_suid_execution","description":"Recently written or modified suid file has been executed","expression":"((process.file.mode & S_ISUID > 0) && process.file.modification_time < 30s) && exec.file.name != \"\" && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bw8-ud8-qzq","attributes":{"version":1,"name":"net_util_exfiltration","description":"Exfiltration attempt via network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] &&\nexec.args_options in [ ~\"post-file=*\", ~\"post-data=*\", ~\"T=*\", ~\"d=@*\", ~\"upload-file=*\", ~\"F=file*\"] &&\nexec.args not in [~\"*localhost*\", ~\"*127.0.0.1*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4jd-zjb-ybo","attributes":{"version":1,"name":"shell_history_symlink","description":"A symbolic link for shell history was created targeting /dev/null","expression":"exec.comm == \"ln\" && exec.args in [~\"*.*history*\", \"/dev/null\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"can-pva-exd","attributes":{"version":1,"name":"suspicious_container_client","description":"A container management utility was executed in a container","expression":"exec.file.name in [\"docker\", \"kubectl\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bb8-sg5-ful","attributes":{"version":1,"name":"kernel_module_load_container","description":"A container loaded a new kernel module","expression":"load_module.name != \"\" && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yzz-sm2-0ff","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chmod","description":"Critical system binaries may have been modified","expression":"(\n    (chmod.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7nx-gb8-9t4","attributes":{"version":1,"name":"rc_scripts_modified","description":"RC scripts modified","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && (open.file.path in [\"/etc/rc.common\", \"/etc/rc.local\"])) && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"npo-tkf-eex","attributes":{"version":1,"name":"pam_modification_chmod","description":"PAM may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gw4-kqw-q1l","attributes":{"version":1,"name":"new_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"atm-kqf-qa2","attributes":{"version":1,"name":"systemd_modification_chmod","description":"A service may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oqc-9gu-uq5","attributes":{"version":1,"name":"ssl_certificate_tampering_utimes","description":"SSL certificates may have been tampered with","expression":"(\n    (utimes.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-7qi-s5j","attributes":{"version":1,"name":"pci_11_5_critical_binaries_unlink","description":"Critical system binaries may have been modified","expression":"(\n    (unlink.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bqm-bp1-dpv","attributes":{"version":1,"name":"nsswitch_conf_mod_link","description":"nsswitch may have been modified without authorization","expression":"(\n    (link.file.path in [ \"/etc/nsswitch.conf\" ]\n    || link.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nah-p3m-dgh","attributes":{"version":1,"name":"database_shell_execution","description":"A database application spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\nprocess.parent.file.name in [\"mysqld\", \"mongod\", \"postgres\"] &&\n!(process.parent.file.name == \"initdb\" &&\nexec.args == \"-c locale -a\") &&\n!(process.parent.file.name == \"postgres\" &&\nexec.args == ~\"*pg_wal*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4mm-9uv-w3t","attributes":{"version":1,"name":"shell_profile_modification","description":"Shell profile was modified","expression":"open.file.path in [~\"/home/*/*profile\", ~\"/home/*/*rc\"] && open.flags & ((O_CREAT|O_TRUNC|O_RDWR|O_WRONLY)) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6q-hmw-lae","attributes":{"version":1,"name":"auditd_config_modified","description":"The auditd configuration file was modified without using auditctl","expression":"open.file.path == \"/etc/audit/auditd.conf\" && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"brz-yda-nve","attributes":{"version":1,"name":"ssh_authorized_keys_link","description":"SSH modified keys may have been modified","expression":"(\n    link.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (link.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || link.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4be-qms-wyo","attributes":{"version":1,"name":"windows_update_registry_key_modified","description":"Windows update registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsUpdate*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ttl-6wn-1ke","attributes":{"version":1,"name":"ssh_it_tool_config_write","description":"The configuration directory for an ssh worm","expression":"open.file.path in [~\"/root/.prng/*\", ~\"/home/*/.prng/*\", ~\"/root/.config/prng/*\", ~\"/home/*/.config/prng/*\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n0c-0if-hne","attributes":{"version":1,"name":"nsswitch_conf_mod_chmod","description":"nsswitch may have been modified without authorization","expression":"(\n    (chmod.file.path in [ \"/etc/nsswitch.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ryr-yxl-ilk","attributes":{"version":1,"name":"nsswitch_conf_mod_utimes","description":"nsswitch may have been modified without authorization","expression":"(\n    (utimes.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"61g-xow-oup","attributes":{"version":1,"name":"nsswitch_conf_mod_chown","description":"nsswitch may have been modified without authorization","expression":"(\n    (chown.file.path in [ \"/etc/nsswitch.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"es9-b6s-upq","attributes":{"version":1,"name":"ssl_certificate_tampering_open_v2","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"\n&& container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x79-zfs-0ix","attributes":{"version":1,"name":"omigod","description":"Omiagent spawns a privileged child process","expression":"exec.uid >= 0 && process.ancestors.file.name == \"omiagent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8ks-vsd-y6y","attributes":{"version":1,"name":"ssl_certificate_tampering_open","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zb2-wpx-aff","attributes":{"version":1,"name":"new_binary_execution_in_container","description":"A container executed a new binary not found in the container image","expression":"container.id != \"\" && process.file.in_upper_layer && process.file.modification_time < 30s && exec.file.name != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k6c-tqa-hjv","attributes":{"version":1,"name":"ssh_authorized_keys_open_v2","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uwk-qfs-oqe","attributes":{"version":1,"name":"kernel_module_chmod","description":"A new kernel module was added","expression":"(\n    (chmod.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"czs-lbr-7k2","attributes":{"version":1,"name":"ptrace_antidebug","description":"A process uses an anti-debugging technique to block debuggers","expression":"ptrace.request == PTRACE_TRACEME && process.file.name != \"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bpu-wji-3ed","attributes":{"version":1,"name":"exec_lsmod","description":"Kernel modules were listed using the lsmod command","expression":"exec.comm == \"lsmod\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jch-xfg-uak","attributes":{"version":1,"name":"nsswitch_conf_mod_unlink","description":"nsswitch may have been modified without authorization","expression":"(\n    (unlink.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yue-sj6-ucc","attributes":{"version":1,"name":"ssl_certificate_tampering_rename","description":"SSL certificates may have been tampered with","expression":"(\n    (rename.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || rename.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rp7-w2i-wnj","attributes":{"version":1,"name":"credential_modified_link","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (link.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || link.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mcj-rg7-foe","attributes":{"version":1,"name":"credential_modified_rename","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (rename.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || rename.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yu3-bwu-ji4","attributes":{"version":1,"name":"nick_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jcr-yly-myj","attributes":{"version":1,"name":"ssl_certificate_tampering_chown","description":"SSL certificates may have been tampered with","expression":"(\n    (chown.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"llc-wxw-5uh","attributes":{"version":1,"name":"dirty_pipe_attempt","description":"Potential Dirty pipe exploitation attempt","expression":"(splice.pipe_entry_flag & PIPE_BUF_FLAG_CAN_MERGE) != 0 && (splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) == 0 && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x7k-bop-jcu","attributes":{"version":1,"name":"windows_com_rpc_debugging_registry_key_modified","description":"Windows RPC COM debugging registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ypb-aen-wts","attributes":{"version":1,"name":"mount_host_fs","description":"The host file system was mounted in a container","expression":"mount.source.path == \"/\" && mount.fs_type != \"overlay\" && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zjd-e62-fkk","attributes":{"version":1,"name":"release_agent_container_breakout","description":"A process attempted to write to the release_agent file of a cgroup, indicating a potential container breakout attempt","expression":"container.id != \"\" && open.file.name == \"release_agent\" && open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":1646684459816,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgc-7yd-gpm","attributes":{"version":1,"name":"pci_11_5_critical_binaries_rename","description":"Critical system binaries may have been modified","expression":"(\n    (rename.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || rename.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bue-96a-bwo","attributes":{"version":1,"name":"pam_modification_rename","description":"PAM may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || rename.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nue-ulh-gxb","attributes":{"version":1,"name":"aws_imds","description":"An AWS IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/latest/meta-data/iam/security-credentials/*\", ~\"*169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\", ~\"*169.254.170.2/*/credentials?id=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"55u-gp9-m0k","attributes":{"version":1,"name":"invalid_agent_constraint","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"0.0.0 >= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8og-5of-lw8","attributes":{"version":1,"name":"offensive_k8s_tool","description":"A known kubernetes pentesting tool has been executed","expression":"(exec.file.name in [ ~\"python*\" ] && (\"KubiScan.py\" in exec.argv || \"kubestriker\" in exec.argv ) ) || exec.file.name in [ \"kubiscan\",\"kdigger\",\"kube-hunter\",\"rakkess\",\"peirates\",\"kubescape\",\"kubeaudit\",\"kube-linter\",\"stratus\",~\"botb-*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fdj-qws-x9g","attributes":{"version":1,"name":"sudoers_policy_modified_chmod","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chmod.file.path == \"/etc/sudoers\")\n) && chmod.file.destination.mode != chmod.file.mode && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqf-gv4-huh","attributes":{"version":1,"name":"windows_test_default_rule_b","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jji-uaq-xqi","attributes":{"version":1,"name":"net_util_in_container","description":"A network utility was executed in a container","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id != \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tj0-f4s-grz","attributes":{"version":1,"name":"pam_modification_chown","description":"PAM may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mmg-bkt-mx4","attributes":{"version":1,"name":"exec_whoami","description":"The whoami command was executed","expression":"exec.comm == \"whoami\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ao4-966-ahr","attributes":{"version":1,"name":"sensitive_tracing","description":"A process is tracing privileged processes or sshd for possible credential dumping","expression":"(ptrace.request == PTRACE_PEEKTEXT || ptrace.request == PTRACE_PEEKDATA || ptrace.request == PTRACE_PEEKUSR) && ptrace.tracee.euid == 0 && process.comm not in [\"dlv\", \"dlv-linux-amd64\", \"strace\", \"gdb\", \"lldb-server\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mrk-tku-sbc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chown","description":"Critical system binaries may have been modified","expression":"(\n    (chown.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nk2-hcg-hf5","attributes":{"version":1,"name":"kernel_module_load_from_memory","description":"A kernel module was loaded from memory","expression":"load_module.loaded_from_memory == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hau-g4f-zzo","attributes":{"version":1,"name":"apparmor_modified_tty","description":"An AppArmor profile was modified in an interactive session","expression":"exec.file.name in [\"aa-disable\", \"aa-complain\", \"aa-audit\"] && exec.tty_name !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0gp-zoy-gyb","attributes":{"version":1,"name":"runc_leaky_fd","description":"The container breakout CVE-2024-21626 was successful","expression":"chdir.syscall.path =~ \"/proc/self/fd/*\" && chdir.file.path == \"/sys/fs/cgroup\" && process.file.name =~ \"runc.*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wqb-yxc-mtb","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open_v2","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vpa-xoh-cia","attributes":{"version":1,"name":"procdump_execution","description":"A tool used to dump process memory has been executed","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vlv-1qs-cjz","attributes":{"version":1,"name":"sudoers_policy_modified_rename","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (rename.file.path == \"/etc/sudoers\"\n    || rename.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"itl-shq-qre","attributes":{"version":1,"name":"nsswitch_conf_mod_open_v2","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && container.created_at > 90s && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fpl-fno-4u3","attributes":{"version":1,"name":"aws_eks_service_account_token_accessed","description":"The AWS EKS service account token was accessed","expression":"open.file.path =~ \"/var/run/secrets/eks.amazonaws.com/serviceaccount/**\" && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"3vq-bya-qsj","attributes":{"version":1,"name":"windows_security_essentials_executable_modified","description":"microsoft security essentials executable modified","expression":"write.file.device_path in [~\"\\Device\\*\\Program Files\\Microsoft Security Client\\msseces.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"08i-pvz-95h","attributes":{"version":1,"name":"crackmap_exec_executed","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme.exe*\", ~\"*cme.py*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpx-hnf-bc6","attributes":{"version":1,"name":"critical_registry_export","description":"regedit used to export critical registry hive","expression":"exec.file.name in [\"reg.exe\", \"regedit.exe\"] && exec.cmdline in [~\"*hklm*\", ~\"*hkey_local_machine*\", ~\"*system*\", ~\"*sam*\", ~\"*security*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aoh-97n-qus","attributes":{"version":1,"name":"redis_save_module","description":"Redis module has been created","expression":"(open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0 && open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.rdb\", ~\"*.aof\", ~\"*.so\"]) && process.file.name in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqg-9ps-mhw","attributes":{"version":1,"name":"passwd_execution","description":"The passwd or chpasswd utility was used to modify an account password","expression":"exec.file.path in [\"/usr/bin/passwd\", \"/usr/sbin/chpasswd\"] && exec.args_flags not in [\"S\", \"status\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4r-2xn-ha0","attributes":{"version":1,"name":"sudoers_policy_modified_open","description":"Sudoers policy file may have been modified without authorization","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n(open.file.path == \"/etc/sudoers\")) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"azw-x88-p7j","attributes":{"version":1,"name":"kubernetes_dns_enumeration","description":"Kubernetes DNS enumeration","expression":"dns.question.name == \"any.any.svc.cluster.local\" && dns.question.type == SRV && container.id != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vma-bsh-4d1","attributes":{"version":1,"name":"kernel_msr_write","description":"A process attempted to enable writing to model-specific registers","expression":"exec.comm == \"modprobe\" && process.args =~ \"*msr*allow_writes*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aed-rue-lpr","attributes":{"version":1,"name":"ip_check_domain","description":"A DNS lookup was done for a IP check service","expression":"dns.question.name in [\"icanhazip.com\", \"ip-api.com\", \"myip.opendns.com\", \"checkip.amazonaws.com\", \"whatismyip.akamai.com\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"stp-dwk-4j7","attributes":{"version":1,"name":"delete_system_log","description":"A process deleted common system log files","expression":"unlink.file.path in [\"/var/run/utmp\", \"/var/log/wtmp\", \"/var/log/btmp\", \"/var/log/lastlog\", \"/var/log/faillog\", \"/var/log/syslog\", \"/var/log/messages\", \"/var/log/secure\", \"/var/log/auth.log\", \"/var/log/boot.log\", \"/var/log/kern.log\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4s4-ezo-w7q","attributes":{"version":1,"name":"dynamic_linker_config_write","description":"A process wrote to a dynamic linker config file","expression":"open.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdc-uhk-mtc","attributes":{"version":1,"name":"ssh_authorized_keys_open","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgq-fea-q99","attributes":{"version":1,"name":"windows_system_enviroment_variable_registry_key_modified","description":"Windows environment variable registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Environment*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n9y-2nc-no0","attributes":{"version":1,"name":"dotnet_dump_execution","description":"Dotnet_dump was used to dump a process memory","expression":"exec.cmdline =~ \"*dotnet-dump*\" && exec.cmdline =~ \"*collect*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"r3m-72r-y8g","attributes":{"version":1,"name":"shell_history_truncated","description":"Shell History was Deleted","expression":"open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && open.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && open.file.path in [~\"/root/*\", ~\"/home/**\"] && process.file.name == \"truncate\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zqc-vts-wok","attributes":{"version":1,"name":"nsswitch_conf_mod_open","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"usg-zrs-ckt","attributes":{"version":1,"name":"winlogon_registry_key_modified","description":"Windows winlogon registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x4t-j4v-l4r","attributes":{"version":1,"name":"windows_explorer_executable_modified","description":"windows explorer file has been modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\explorer.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"9mk-a4g-rb5","attributes":{"version":1,"name":"crackmap_exec_usage","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cqr-wm9-cjl","attributes":{"version":1,"name":"systemd_modification_open","description":"A service may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cxw-5gm-pid","attributes":{"version":1,"name":"curl_docker_socket","description":"The Docker socket was referenced in a cURL command","expression":"exec.file.name == \"curl\" && exec.args_flags in [\"unix-socket\"] && exec.args in [~\"*docker.sock*\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpf-aeq-icx","attributes":{"version":1,"name":"ssh_authorized_keys_chown","description":"SSH modified keys may have been modified","expression":"(\n    chown.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chown.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iqk-ui0-v8c","attributes":{"version":1,"name":"hidden_file_executed","description":"A hidden file was executed in a suspicious folder","expression":"exec.file.name =~ \".*\" && exec.file.path in [~\"/home/**\", ~\"/tmp/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"s1j-kv4-llt","attributes":{"version":1,"name":"selinux_disable_enforcement","description":"SELinux enforcement status was disabled","expression":"selinux.enforce.status in [\"permissive\", \"disabled\"] && process.ancestors.args != ~\"*BECOME-SUCCESS*\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a9j-6xn-afo","attributes":{"version":1,"name":"sliver_c2_implant_execution","description":"process arguments match sliver c2 implant","expression":"exec.cmdline =~ \"*NoExit *\" && exec.cmdline =~ \"*Command *\" && exec.cmdline =~ \"*[Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vb1-l7o-skr","attributes":{"version":1,"name":"ssl_certificate_tampering_chmod","description":"SSL certificates may have been tampered with","expression":"(\n    (chmod.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.mode != chmod.file.destination.mode\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1or-3oo-rag","attributes":{"version":1,"name":"new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qme-vau-bk4","attributes":{"version":1,"name":"potential_web_shell_parent","description":"A web application spawned a shell or shell utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] || exec.comm in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\n(process.parent.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.parent.file.name =~ \"php*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7ft-hzb-mpc","attributes":{"version":1,"name":"critical_windows_files_modified","description":"a critical windows file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hbd-kty-ixx","attributes":{"version":1,"name":"kernel_module_utimes","description":"A new kernel module was added","expression":"(\n    (utimes.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rly-bqo-sg1","attributes":{"version":1,"name":"systemd_modification_utimes","description":"A service may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eda-l1r-hrq","attributes":{"version":1,"name":"relay_attack_tool_execution","description":"Process matches known relay attack tool","expression":"exec.file.name in [~\"*PetitPotam*\", ~\"*RottenPotato*\", ~\"*HotPotato*\", ~\"*JuicyPotato*\", ~\"*just_dce_*\", ~\"*Juicy Potato*\", \"rot.exe\", \"Potato.exe\", \"SpoolSample.exe\", \"Responder.exe\", ~\"*smbrelayx*\", ~\"*smbrelayx*\", ~\"*ntlmrelayx*\", ~\"*LocalPotato*\"] || exec.cmdline in [~\"*Invoke-Tater*\", ~\"*smbrelay*\", ~\"*ntlmrelay*\", ~\"*cme smb*\", ~\"*ntlm:NTLMhash*\", ~\"*Invoke-PetitPotam*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rbo-40l-grx","attributes":{"version":1,"name":"net_unusual_request","description":"Network utility executed with suspicious URI","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*.php*\", ~\"*.jpg*\"] ","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gci-o39-u6v","attributes":{"version":1,"name":"read_kubeconfig","description":"The kubeconfig file was accessed","expression":"open.file.path in [~\"/home/*/.kube/config\", \"/root/.kube/config\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1uw-i6q-m5n","attributes":{"version":1,"name":"nsswitch_conf_mod_rename","description":"nsswitch may have been modified without authorization","expression":"(\n    (rename.file.path in [ \"/etc/nsswitch.conf\" ]\n    || rename.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ynr-dvw-x2x","attributes":{"version":1,"name":"ssh_authorized_keys_rename","description":"SSH modified keys may have been modified","expression":"(\n    rename.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (rename.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || rename.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fme-ym2-lwi","attributes":{"version":1,"name":"systemd_modification_link","description":"A service may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || link.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tht-nwe-guf","attributes":{"version":1,"name":"k8s_pod_service_account_token_accessed","description":"The Kubernetes pod service account token was accessed","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"] && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"] && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6d-gre-qls","attributes":{"version":1,"name":"service_stop","description":"systemctl used to stop a service","expression":"exec.file.name == \"systemctl\" && exec.args in [~\"*stop*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ljs-qkf-c4r","attributes":{"version":1,"name":"pam_modification_open","description":"PAM may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vhj-z63-abi","attributes":{"version":1,"name":"systemd_modification_chown","description":"A service may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pho-wta-zir","attributes":{"version":1,"name":"net_util","description":"A network utility was executed","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id == \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"m36-fmz-1bi","attributes":{"version":1,"name":"executable_bit_added","description":"The executable bit was added to a newly created file","expression":"chmod.file.in_upper_layer &&\nchmod.file.change_time < 30s &&\ncontainer.id != \"\" &&\nchmod.file.destination.mode != chmod.file.mode &&\nchmod.file.destination.mode & S_IXUSR|S_IXGRP|S_IXOTH > 0 &&\nprocess.argv in [\"+x\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5j0-kon-1hn","attributes":{"version":1,"name":"sudoers_policy_modified_link","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (link.file.path == \"/etc/sudoers\"\n    || link.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hsw-h1t-p9n","attributes":{"version":1,"name":"suid_file_execution","description":"a SUID file was executed","expression":"(setuid.euid == 0 || setuid.uid  == 0)  && process.file.mode & S_ISUID > 0  && process.file.uid == 0  && process.uid != 0  && process.file.path != \"/usr/bin/sudo\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"da1-a9j-tw9","attributes":{"version":1,"name":"sudoers_policy_modified_unlink","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (unlink.file.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4tw-oex-wnc","attributes":{"version":1,"name":"cryptominer_args","description":"A process launched with arguments associated with cryptominers","expression":"exec.args_options in [~\"cpu-priority*\", ~\"donate-level*\"] || exec.args_flags == \"randomx-1gb-pages\" || exec.args in [~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uga-lal-zqb","attributes":{"version":1,"name":"php_spawning_shell","description":"PHP web application spawning shell","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name in [\"php.exe\",\"php-cgi.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"alv-iwj-sbs","attributes":{"version":1,"name":"systemd_modification_unlink","description":"A service may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nsy-20w-pj6","attributes":{"version":1,"name":"sharpup_tool_usage","description":"sharpup tool used for local privilege escalation","expression":"exec.file.name == \"sharpup.exe\" && exec.cmdline in [~\"*HijackablePaths*\", ~\"*UnquotedServicePath*\", ~\"*ProcessDLLHijack*\", ~\"*ModifiableServiceBinaries*\", ~\"*ModifiableScheduledTask*\", ~\"*DomainGPPPassword*\", ~\"*CachedGPPPassword*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mam-ir1-532","attributes":{"version":1,"name":"windows_cryptographic_blocking_policy_registry_key_modified","description":"Windows cryptographic blocking policy modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllRemoveSignedDataMsg*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tn9-vck-we9","attributes":{"version":1,"name":"shell_history_deleted","description":"Shell History was Deleted","expression":"unlink.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && unlink.file.path in [~\"/root/**\", ~\"/home/**\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ows-d9p-s2b","attributes":{"version":1,"name":"runc_modification","description":"The runc binary was modified in a non-standard way","expression":"open.file.path in [\"/usr/bin/runc\", \"/usr/sbin/runc\", \"/usr/bin/docker-runc\"]\n&& open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"on3-qxk-zeh","attributes":{"version":1,"name":"paste_site","description":"A DNS lookup was done for a pastebin-like site","expression":"dns.question.name in [\"pastebin.com\", \"ghostbin.com\", \"termbin.com\", \"klgrth.io\", \"rentry.co\", \"transfer.sh\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdi-lzv-pki","attributes":{"version":1,"name":"azure_imds","description":"An Azure IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/metadata/identity/oauth2/token?api-version=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qay-zpa-akb","attributes":{"version":1,"name":"rubeus_execution","description":"process arguments match rubeus credential theft tool","expression":"exec.cmdline in [~\"*asreproast*\", ~\"*/service:krbtgt*\", ~\"*dump /luid:0x*\", ~\"*kerberoast*\", ~\"*createonly /program*\", ~\"*ptt /ticket*\", ~\"*impersonateuser*\", ~\"*renew /ticket*\", ~\"*asktgt /user*\", ~\"*harvest /interval*\", ~\"*s4u /user*\", ~\"*hash /password*\", ~\"*golden /aes256*\", ~\"*silver /user*\", \"*rubeus*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uty-ayo-tpv","attributes":{"version":1,"name":"wmi_spawning_shell","description":"Command executed via WMI","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name == \"WmiPrvSE.exe\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"icy-i3s-bvd","attributes":{"version":1,"name":"deploy_priv_container","description":"A privileged container was created","expression":"exec.file.name != \"\" && container.created_at < 1s && process.cap_permitted & CAP_SYS_ADMIN > 0","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6du-s2a-foz","attributes":{"version":1,"name":"suspicious_bitsadmin_usage","description":"A suspicious bitsadmin command has been executed","expression":"exec.file.name == \"bitsadmin.exe\" && exec.cmdline in [~\"*addfile*\", ~\"*create*\", ~\"*resume*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dco-vsp-sto","attributes":{"version":1,"name":"ssh_authorized_keys_chmod","description":"SSH modified keys may have been modified","expression":"(\n    chmod.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chmod.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyc-tp1-xr1","attributes":{"version":1,"name":"windows_boot_registry_key_modified","description":"Windows boot registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\IniFileMapping\\SYSTEM.ini\\boot*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-cg7-96w","attributes":{"version":1,"name":"sudoers_policy_modified_chown","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chown.file.path == \"/etc/sudoers\")\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bft-ikt-sfa","attributes":{"version":1,"name":"registry_service_runkey_modified","description":"Service registry runkey modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\CurrentVersion\\RunServices\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ydm-yqo-f9t","attributes":{"version":1,"name":"looney_tunables_exploit","description":"Looney Tunables (CVE-2023-4911) exploit attempted","expression":"exec.file.mode & S_ISUID > 0 && exec.file.uid == 0 && exec.uid != 0 && exec.envs in [~\"*GLIBC_TUNABLES*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wpy-igs-bcp","attributes":{"version":1,"name":"windows_shell_folders_registry_key_modified","description":"Windows shell folders registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders*\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gyj-yid-n02","attributes":{"version":1,"name":"ptrace_injection","description":"A process attempted to inject code into another process","expression":"ptrace.request == PTRACE_POKETEXT || ptrace.request == PTRACE_POKEDATA || ptrace.request == PTRACE_POKEUSR","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kxe-vss-47x","attributes":{"version":1,"name":"windows_firewall_configuration_registry_key_modified","description":"Windows firewall configuration registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zxv-eui-tgr","attributes":{"version":1,"name":"auditctl_usage","description":"The auditctl command was used to modify auditd","expression":"exec.file.name == \"auditctl\" && exec.args_flags not in [\"s\", \"l\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ccs-c0e-kx6","attributes":{"version":1,"name":"minidump_usage","description":"Process memory was dumped using the minidump function from comsvcs.dll","expression":"exec.cmdline =~ \"*MiniDump*\" && exec.cmdline =~ \"*comsvcs*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"we1-nic-zhp","attributes":{"version":1,"name":"base64_decode","description":"The base64 command was used to decode information","expression":"exec.file.name == \"base64\" && exec.args_flags in [\"d\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mjs-qml-f6e","attributes":{"version":1,"name":"systemd_modification_rename","description":"A service may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"elg-0ho-jjb","attributes":{"version":1,"name":"powershell_empire_uac_bypass","description":"A process was executed matching arguments for a UAC bypass technique common in powershell empire","expression":"exec.cmdline in [~\"*-NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*\", ~\"*-NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dzi-svp-ub2","attributes":{"version":1,"name":"memfd_create","description":"memfd object created","expression":"exec.file.name =~ \"memfd*\" && exec.file.path == \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iv0-azx-iwi","attributes":{"version":1,"name":"interactive_shell_in_container","description":"An interactive shell was started inside of a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && exec.args_flags in [\"i\"] && container.id !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mgb-ejl-c5b","attributes":{"version":1,"name":"kernel_module_rename","description":"A new kernel module was added","expression":"(\n    (rename.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dug-aqp-7zn","attributes":{"version":1,"name":"exec_wrmsr","description":"The wrmsr program executed","expression":"exec.comm == \"wrmsr\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wrz-nq9-pi8","attributes":{"version":1,"name":"mining_pool_lookup","description":"A process resolved a DNS name associated with cryptomining activity","expression":"dns.question.name in [~\"*.minexmr.com\", \"minexmr.com\", ~\"*.nanopool.org\", \"nanopool.org\", ~\"*.supportxmr.com\", \"supportxmr.com\", ~\"*.c3pool.com\", \"c3pool.com\", ~\"*.p2pool.io\", \"p2pool.io\", ~\"*.ethermine.org\", \"ethermine.org\", ~\"*.f2pool.com\", \"f2pool.com\", ~\"*.poolin.me\", \"poolin.me\", ~\"*.rplant.xyz\", \"rplant.xyz\", ~\"*.miningocean.org\", \"miningocean.org\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"01c-hgk-8x3","attributes":{"version":1,"name":"credential_modified_chmod","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chmod.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ld1-hxu-zdf","attributes":{"version":1,"name":"nick_new_java_detect_with_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"foogazi\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"z0y-kio-bf4","attributes":{"version":1,"name":"kernel_module_open","description":"A new kernel module was added","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xtf-uqt-mh0","attributes":{"version":1,"name":"common_net_intrusion_util","description":"A network utility (nmap) commonly used in intrusion attacks was executed","expression":"exec.file.name in [\"nmap\", \"masscan\", \"fping\", \"zgrab\", \"zgrab2\", \"rustscan\", \"pnscan\"] && exec.args_flags not in [\"V\", \"version\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"l5b-qmr-hi6","attributes":{"version":1,"name":"ssh_authorized_keys_utimes","description":"SSH modified keys may have been modified","expression":"(\n    utimes.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (utimes.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qa1-stp-xpl","attributes":{"version":1,"name":"open_msr_writes","description":"A process opened a model-specific register (MSR) configuration file","expression":"open.file.path == \"/sys/module/msr/parameters/allow_writes\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cwr-kgl-5xs","attributes":{"version":1,"name":"credential_modified_chown","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chown.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"am6-icr-cgg","attributes":{"version":1,"name":"package_management_in_container","description":"Package management was detected in a container","expression":"exec.file.path in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"esx-z8e-qcs","attributes":{"version":1,"name":"safeboot_modification","description":"Safeboot registry modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\SafeBoot\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sdk-dp7-vt0","attributes":{"version":1,"name":"jupyter_shell_execution","description":"A Jupyter notebook executed a shell","expression":"(exec.file.name in [\"cat\",\"chgrp\",\"chmod\",\"chown\",\"cp\",\"date\",\"dd\",\"df\",\"dir\",\"echo\",\"ln\",\"ls\",\"mkdir\",\"mknod\",\"mktemp\",\"mv\",\"pwd\",\"readlink\",\"rm\",\"rmdir\",\"sleep\",\"stty\",\"sync\",\"touch\",\"uname\",\"vdir\",\"arch\",\"b2sum\",\"base32\",\"base64\",\"basename\",\"chcon\",\"cksum\",\"comm\",\"csplit\",\"cut\",\"dircolors\",\"dirname\",\"du\",\"env\",\"expand\",\"expr\",\"factor\",\"fmt\",\"fold\",\"groups\",\"head\",\"hostid\",\"id\",\"install\",\"join\",\"link\",\"logname\",\"md5sum\",\"textutils\",\"mkfifo\",\"nice\",\"nl\",\"nohup\",\"nproc\",\"numfmt\",\"od\",\"paste\",\"pathchk\",\"pinky\",\"pr\",\"printenv\",\"printf\",\"ptx\",\"realpath\",\"runcon\",\"seq\",\"sha1sum\",\"sha224sum\",\"sha256sum\",\"sha384sum\",\"sha512sum\",\"shred\",\"shuf\",\"sort\",\"split\",\"stat\",\"stdbuf\",\"sum\",\"tac\",\"tail\",\"tee\",\"test\",\"timeout\",\"tr\",\"truncate\",\"tsort\",\"tty\",\"unexpand\",\"uniq\",\"unlink\",\"users\",\"wc\",\"who\",\"whoami\",\"chroot\"] || exec.file.name in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"]) && process.ancestors.comm in [\"jupyter-noteboo\", \"jupyter-lab\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hnz-ezh-lyu","attributes":{"version":1,"name":"ld_preload_unusual_library_path","description":"The LD_PRELOAD variable is populated by a link to a suspicious file directory","expression":"exec.envs in [~\"LD_PRELOAD=*/tmp/*\", ~\"LD_PRELOAD=/dev/shm/*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjo-mdq-mi1","attributes":{"version":1,"name":"dynamic_linker_config_unlink","description":"A process unlinked a dynamic linker config file","expression":"unlink.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"psf-hiy-3ji","attributes":{"version":1,"name":"scheduled_task_creation","description":"A scheduled task was created","expression":"exec.cmdline in [~\"*at.exe\",~\"*schtasks*\"] && exec.cmdline =~ \"*create*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6vb-fkj-cdc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ktg-ng9-izk","attributes":{"version":1,"name":"kernel_module_load_from_memory_container","description":"A kernel module was loaded from memory inside a container","expression":"load_module.loaded_from_memory == true && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0qf-cha-qci","attributes":{"version":1,"name":"java_shell_execution_parent","description":"A java process spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"])\n&& process.parent.file.name in [\"java\", \"jspawnhelper\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gz3-l4z-bzr","attributes":{"version":1,"name":"network_sniffing_tool","description":"Local account groups were enumerated after container start up","expression":"exec.file.name in [\"tcpdump\", \"tshark\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hob-7or-knu","attributes":{"version":1,"name":"python_cli_code","description":"Python code was provided on the command line","expression":"exec.file.name == ~\"python*\" && exec.args_flags in [\"c\"] && exec.args in [~\"*-c*SOCK_STREAM*\", ~\"*-c*subprocess*\", ~\"*-c*/bash*\", ~\"*-c*/bin/sh*\", ~\"*-c*pty.spawn*\"] && exec.args !~ \"*setuptools*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"buh-tbl-6k1","attributes":{"version":1,"name":"pci_11_5_critical_binaries_link","description":"Critical system binaries may have been modified","expression":"(\n    (link.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || link.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521243,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"}]}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 197.368917ms
    - id: 7
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"}}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 150.064042ms
    - id: 8
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"data":[{"id":"55r-kwq-jsc","attributes":{"version":1,"name":"ztfkbnhtzk","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295127867,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295127867,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"vg6-omq-vv4","attributes":{"version":1,"name":"wawhgdyumt","description":"im a rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747295102041,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747295102041,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"3yb-106-xrm","attributes":{"version":3,"name":"my_terraform_rule2","description":"my terraform rule","expression":"bind.addr.ip==1.6.1.9","category":"Kernel Activity","defaultRule":false,"enabled":false,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747140640989,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747141373736,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"rtp-dom-1am","attributes":{"version":1,"name":"agent_rule2","description":"My Agent rule","expression":"open.file.name == \"etc/shadow/password\"","category":"File Activity","defaultRule":false,"enabled":true,"creationAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","creationDate":1747062863277,"updateAuthorUuId":"a54eca49-cf2e-11ef-8941-5e02e132a7ae","updateDate":1747062863277,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"},"updater":{"name":"Quentin Guillard","handle":"quentin.guillard@datadoghq.com"}},"type":"agent_rule"},{"id":"1vs-h3p-spa","attributes":{"version":1,"name":"000000bangtestnumber","description":"should_work_with_number","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702433529,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":60000000,"append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g5c-vnp-xf2","attributes":{"version":1,"name":"000000bangtest","description":"should_work_with_string","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743702410743,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d4v-xci-tzk","attributes":{"version":1,"name":"000000second","description":"ahahaha","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"]  && open.file.name == \"token\"  && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"]  && process.file.path not in ${processes_accessing}","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1743701600763,"filters":[],"actions":[{"set":{"name":"processes_accessing","field":"process.file.path","ttl":"60s","append":true}}],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"by5-5gy-ajb","attributes":{"version":2,"name":"kernel_module_load","description":"A kernel module was loaded","expression":"load_module.loaded_from_memory == false && load_module.name not in [\"nf_tables\", \"iptable_filter\", \"ip6table_filter\", \"bpfilter\", \"ip6_tables\", \"ip6table_nat\", \"nf_reject_ipv4\", \"ipt_REJECT\", \"iptable_raw\", \"udp_diag\", \"inet_diag\"] && process.ancestors.file.name not in [~\"falcon*\", \"unattended-upgrade\", \"apt.systemd.daily\", \"xtables-legacy-multi\", \"ssm-agent-worker\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737734329380,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"c5x-fzi-cfu","attributes":{"version":2,"name":"known_dll_registry_key_modified","description":"Windows Known DLLs location registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1737044905726,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fcw-skn-8l6","attributes":{"version":1,"name":"shell_net_connection","description":"A shell made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && process.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"] && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980532395,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jwd-mhg-rzc","attributes":{"version":1,"name":"interpreter_outbound_connection","description":"An interpreter made an outbound network connection","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && process.file.name in [~\"python2*\", ~\"python3*\", \"node\", \"perl\", ~\"ruby*\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980527270,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7k7-mzh-fhj","attributes":{"version":1,"name":"irc_connection","description":"A process made an outbound IRC connection","expression":"connect.addr.port == 6667 && connect.addr.is_public == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980517121,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gff-p0p-hzz","attributes":{"version":1,"name":"p2pinfect_connection","description":"A process made a connection to a port associated with P2PInfect malware","expression":"connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.is_public == true && connect.addr.port >= 60100 && connect.addr.port <= 60150","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736980466118,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0yh-tmv-2ir","attributes":{"version":1,"name":"socat_shell","description":"Process arguments indicating possible socat shell detected","expression":"((exec.file.name == \"socat\") || (exec.comm == \"socat\")) && exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\", ~\"*exec*\", ~\"*pty*\", ~\"*setsid*\", ~\"*stderr*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536410363,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zwp-lhw-osb","attributes":{"version":1,"name":"udev_modification","description":"Device rule created","expression":"open.file.path in [~\"/etc/udev/rules.d/*\", ~\"/lib/udev/rules.d/*\", ~\"/usr/lib/udev/rules.d/*\", ~\"/usr/local/lib/udev/rules.d/*\", ~\"/run/udev/rules.d/*\"] && open.flags & O_CREAT > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405283,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"p4u-oh0-avq","attributes":{"version":1,"name":"devshm_execution","description":"A file executed from /dev/shm/ directory","expression":"exec.file.path == \"/dev/shm/**\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536405258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jdx-661-6he","attributes":{"version":1,"name":"ssh_nonstandard_connection","description":"SSH initiated a connection on a nonstandard port","expression":"connect.addr.port in [80, 8080, 88, 443, 8443, 4444] && process.file.name == \"ssh\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395054,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ozf-woz-u9t","attributes":{"version":2,"name":"libpam_ebpf_hook","description":"Library libpam.so hooked using eBPF","expression":"bpf.cmd == BPF_MAP_CREATE && process.args in [r\"libpam\\.so\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536395021,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k02-h52-5kl","attributes":{"version":1,"name":"overwrite_entrypoint","description":"A process attempted to overwrite the container entrypoint","expression":"open.file.path == \"/proc/self/fd/1\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0 && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389957,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qwh-aci-cax","attributes":{"version":2,"name":"cron_at_job_creation_open","description":"An unauthorized job was added to cron scheduling","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536389882,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cvg-paj-akm","attributes":{"version":2,"name":"cron_at_job_creation_chown","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chown.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536379705,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ecq-lqb-dko","attributes":{"version":1,"name":"find_credentials","description":"find command searching for sensitive files","expression":"exec.comm == \"find\" && exec.args in [~\"*credentials*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374661,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jig-hjw-dqq","attributes":{"version":1,"name":"webdriver_spawned_shell","description":"Browser WebDriver spawned shell","expression":"process.parent.file.name in [~\"chromedriver*\", \"geckodriver\"] && exec.file.name not in [\"chrome\", \"google-chrome\", \"chromium\", \"firefox\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374638,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cjg-f8o-kp3","attributes":{"version":2,"name":"tunnel_traffic","description":"Tunneling or port forwarding tool used","expression":"((exec.comm == \"pivotnacci\" || exec.comm == \"gost\") && process.args_flags in [\"L\", \"C\", \"R\"]) || (exec.comm in [\"ssh\", \"sshd\"] && process.args_flags in [\"R\", \"L\", \"D\", \"w\"] && process.args in [r\"((25[0-5]|(2[0-4]|1\\d|[1-9])\\d)\\.?\\b){4}\"] ) || (exec.comm == \"sshuttle\" && process.args_flags in [\"r\", \"remote\", \"l\", \"listen\"]) || (exec.comm == \"socat\" && process.args in [r\"(TCP4-LISTEN:|SOCKS)\"]) || (exec.comm in [\"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\", \"ssf\", \"3proxy\", \"ngrok\"] && process.parent.comm in [\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"])","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536374597,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-5ct-v09","attributes":{"version":1,"name":"netcat_shell","description":"Process arguments indicating possible netcat shell detected","expression":"exec.file.name in [\"netcat\", \"nc\", \"ncat\"] && ((exec.args_flags in [\"l\"] && exec.args_flags in [\"p\"]) || (exec.args_flags in [\"n\"] && exec.args_flags in [\"v\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536369507,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qyq-78u-ql6","attributes":{"version":1,"name":"cups_spawned_shell","description":"Shell process spawned from print server","expression":"exec.file.name != \"\" && process.parent.file.name == \"foomatic-rip\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364424,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdw-b2j-bpy","attributes":{"version":1,"name":"debugfs_in_container","description":"The debugfs was executed in a container","expression":"exec.comm == \"debugfs\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536364396,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dt3-f0b-e8d","attributes":{"version":1,"name":"webapp_imds_V1_request","description":"Web application requested IMDSv1 credentials","expression":"imds.aws.is_imds_v2 == false && imds.url =~ \"*/*/meta-data/iam/security-credentials/*\" && (process.ancestors.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.ancestors.file.name =~ \"php*\" || process.ancestors.file.name == \"java\")","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359279,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dat-hhr-7xk","attributes":{"version":2,"name":"cron_at_job_creation_link","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (link.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || link.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536359258,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-hyn-s1j","attributes":{"version":1,"name":"release_agent_escape","description":"Container escape attempted by overwriting release_agent","expression":"open.file.name == \"release_agent\" && open.file.path in [\"/tmp/**\", \"/home/**\", \"/root/**\", \"/*\"] && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354195,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vvo-iqz-sr2","attributes":{"version":1,"name":"file_sync_exfil","description":"The rclone utility was executed","expression":"exec.file.name in [\"rclone\", \"rsync\", \"sftp\", \"ftp\", \"scp\", \"dcp\", \"rcp\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536354189,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ctm-jbt-ag7","attributes":{"version":1,"name":"unshare_in_container","description":"The unshare utility was executed in a container","expression":"exec.comm == \"unshare\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349072,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rhn-60e-ocl","attributes":{"version":2,"name":"iptables_egress_allowed","description":"Egress traffic allowed using iptables","expression":"exec.comm == \"iptables\" && process.args in [r\"OUTPUT.*((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}.*ACCEPT\"] && process.args not in [r\"(127\\.)|(10\\.)|(172\\.1[6-9]\\.)|(172\\.2[0-9]\\.)|(^172\\.3[0-1]\\.)|(192\\.168\\.)|(169\\.254\\.)\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536349046,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ol8-rm4-6j5","attributes":{"version":1,"name":"aws_cli_usage","description":"The AWS CLI utility was executed","expression":"exec.file.name == \"aws\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343955,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"956-hlb-btg","attributes":{"version":1,"name":"php_shell","description":"Process arguments indicating possible php shell detected","expression":"exec.file.name == \"php\" && exec.args_flags in [\"r\"] && ((exec.args in [~\"*socket_bind*\", ~\"*socket_listen*\", ~\"*socket_accept*\", ~\"*socket_create*\", ~\"*socket_write*\", ~\"*socket_read*\"]) || (exec.args in [~\"*/bin/bash*\", ~\"*/bin/sh*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343942,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gu9-82k-92p","attributes":{"version":2,"name":"cron_at_job_creation_chmod","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (chmod.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n) && chmod.file.destination.mode != chmod.file.mode\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536343900,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oad-qwd-via","attributes":{"version":2,"name":"compile_after_delivery","description":"A compiler wrote a suspicious file in a container","expression":"open.flags & O_CREAT > 0\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.ko\", ~\".*\"])\n  || open.file.path in [~\"/var/tmp/**\", ~\"/root/**\", ~\"*/bin/*\", ~\"/usr/local/lib/**\"]\n)\n&& (process.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || process.ancestors.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"])\n&& process.file.name not in [\"pip\", ~\"python*\"]\n&& container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536323502,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vx6-cyx-ksx","attributes":{"version":1,"name":"openssl_backdoor","description":"openssl used to establish backdoor","expression":"exec.comm == \"openssl\" && exec.args =~ \"*s_client*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318450,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4p-qiy-v1g","attributes":{"version":2,"name":"compiler_in_container","description":"A compiler was executed inside of a container","expression":"(exec.comm in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || exec.file.name in [\"javac\", \"clang\", \"gcc\", \"bcc\"] || (exec.file.name == \"go\" && exec.args in [~\"*build*\", ~\"*run*\"])) && container.id !=\"\" && process.ancestors.file.path != \"/usr/bin/cilium-agent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536318401,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n17-fnl-a6b","attributes":{"version":1,"name":"mount_in_container","description":"The mount utility was executed in a container","expression":"exec.comm == \"mount\" && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313319,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ylt-39s-jwc","attributes":{"version":2,"name":"cron_at_job_creation_unlink","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (unlink.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536313305,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyp-ktn-4kd","attributes":{"version":1,"name":"nsenter_in_container","description":"nsenter used to breakout of container","expression":"exec.file.name == \"nsenter\" && exec.args_options in [\"target=1\", \"t=1\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308211,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mp4-mte-fr7","attributes":{"version":1,"name":"ssh_outbound_connection","description":"A process connected to an SSH server","expression":"connect.addr.port == 22 && connect.addr.family & (AF_INET|AF_INET6) > 0 && connect.addr.ip not in [127.0.0.0/8]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308194,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jix-kop-8dg","attributes":{"version":2,"name":"ransomware_note","description":"Possible ransomware note created under common user directories","expression":"open.flags & O_CREAT > 0\n&& open.file.path in [~\"/home/**\", ~\"/root/**\", ~\"/bin/**\", ~\"/usr/bin/**\", ~\"/opt/**\", ~\"/etc/**\", ~\"/var/log/**\", ~\"/var/lib/log/**\", ~\"/var/backup/**\", ~\"/var/www/**\"]\n&& open.file.name in [r\"(?i)(restore|recover|read|instruction|how_to|ransom|lock).*(your_|crypt|lock|file|ransom)\"] && open.file.name not in [r\"\\.lock$\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536308136,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x0q-bqb-eo1","attributes":{"version":2,"name":"windows_cryptominer_process","description":"A cryptominer was potentially executed","expression":"exec.cmdline in [~\"*cpu-priority*\", ~\"*donate-level*\", ~\"*randomx-1gb-pages*\", ~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536303070,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"txo-xll-se0","attributes":{"version":2,"name":"suspicious_dll_write","description":"Dll written to a suspicious directory","expression":"create.file.name =~ \"*.dll\" && create.file.device_path not in [~\"\\Device\\*\\Windows\\System32\\**\", ~\"\\Device\\*\\ProgramData\\docker\\**\"] && process.file.name != \"dockerd.exe\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536297939,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zig-zjk-wem","attributes":{"version":1,"name":"perl_shell","description":"Process arguments indicating possible perl bind shell detected","expression":"exec.file.name == ~\"perl*\" && exec.args_flags in [\"e\"] && ((exec.args in [~\"*socket*\", ~\"*bind*\", ~\"*sockaddr*\", ~\"*listen*\", ~\"*accept\", ~\"*stdin*\", ~\"*stdout\"]) || (exec.args in [~\"*/bin/sh*\", ~\"*/bin/bash*\"]))","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292914,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qfj-nw1-1zg","attributes":{"version":1,"name":"modified_file_requesting_imds_creds","description":"Recently modified file requested credentials from IMDS","expression":"imds.url =~ \"/*/meta-data/iam/security-credentials/*\" && (process.parent.file.modification_time < 120s || process.file.modification_time < 30s)","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536292897,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yhp-mh7-pgn","attributes":{"version":2,"name":"cron_at_job_creation_rename","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (rename.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"]\n    || rename.file.destination.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\" ])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287823,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ers-kyx-kaq","attributes":{"version":2,"name":"cron_at_job_creation_utimes","description":"An unauthorized job was added to cron scheduling","expression":"(\n    (utimes.file.path in [ ~\"/var/spool/cron/**\", ~\"/etc/cron.*/**\", ~\"/etc/crontab\", ~\"/etc/crontabs/**\"])\n    && process.file.path not in [ \"/usr/bin/at\", \"/usr/bin/crontab\" ]\n)\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1736536287800,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sjm-2is-v4s","attributes":{"version":1,"name":"tar_execution","description":"Tar archive created","expression":"exec.file.path == \"/usr/bin/tar\" && exec.args_flags in [\"create\",\"c\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xhr-7kq-dpo","attributes":{"version":1,"name":"user_deleted_tty","description":"A user was deleted via an interactive session","expression":"exec.file.name in [\"userdel\", \"deluser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"d0z-hzd-y7v","attributes":{"version":1,"name":"cryptominer_envs","description":"Process environment variables match cryptocurrency miner","expression":"exec.envs in [\"POOL_USER\", \"POOL_URL\", \"POOL_PASS\", \"DONATE_LEVEL\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eav-mud-yh0","attributes":{"version":1,"name":"credential_modified_utimes","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (utimes.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"g2j-1lc-iub","attributes":{"version":1,"name":"kernel_module_chown","description":"A new kernel module was added","expression":"(\n    (chown.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5x8-617-k9v","attributes":{"version":1,"name":"chaussette","description":"Execution of a java process","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cdy-4sl-0vh","attributes":{"version":1,"name":"dirty_pipe_exploitation","description":"Potential Dirty pipe exploitation","expression":"(splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) > 0  && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8fk-hlc-jgx","attributes":{"version":1,"name":"registry_hives_file_path_key_modified","description":"Windows registry hives file location key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\hivelist*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ggj-tkx-3i5","attributes":{"version":1,"name":"windows_hosts_file_modified","description":"the windows hosts file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\Drivers\\etc\\hosts\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hmg-jnt-cra","attributes":{"version":1,"name":"kernel_module_link","description":"A new kernel module was added","expression":"(\n    (link.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || link.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"b7q-33d-ehp","attributes":{"version":1,"name":"inveigh_tool_usage","description":"Process executed with arguments common with Inveigh tool usage","expression":"exec.cmdline in [~\"*SpooferIP*\", ~\"*ReplyToIPs*\", ~\"*ReplyToDomains*\", ~\"*ReplyToMACs*\", ~\"*SnifferIP*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdj-3ys-gul","attributes":{"version":1,"name":"redis_sandbox_escape","description":"Detects CVE-2022-0543","expression":"(open.file.path =~ \"/usr/lib/x86_64-linux-gnu/*\" && open.file.name in [\"libc-2.29.so\", \"libc-2.30.so\", \"libc-2.31.so\", \"libc-2.32.so\", \"libc-2.33.so\", \"libc-2.34.so\", \"libc-2.35.so\", \"libc-2.36.so\", \"libc-2.37.so\"]) && process.ancestors.comm in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kof-qfg-4z7","attributes":{"version":1,"name":"certutil_usage","description":"Certutil was executed to transmit or decode a potentially malicious file","expression":"exec.file.name == \"certutil.exe\" && ((exec.cmdline =~ \"*urlcache*\" && exec.cmdline =~ \"*split*\") || exec.cmdline =~ \"*decode*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521303,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"u0y-4yq-w99","attributes":{"version":1,"name":"pwnkit_privilege_escalation","description":"A process was spawned with indicators of exploitation of CVE-2021-4034","expression":"(exec.file.path == \"/usr/bin/pkexec\" && exec.envs in [~\"*SHELL*\", ~\"*PATH*\"] && exec.envs not in [~\"*DISPLAY*\", ~\"*DESKTOP_SESSION*\"] && exec.uid != 0)","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yyp-3qo-77g","attributes":{"version":1,"name":"pci_11_5_critical_binaries_utimes","description":"Critical system binaries may have been modified","expression":"(\n    (utimes.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ijj-sdz-ghy","attributes":{"version":1,"name":"nick_new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjg-ztr-xts","attributes":{"version":1,"name":"suspicious_ntdsutil_usage","description":"Suspicious usage of ntdsutil","expression":"exec.file.name == \"ntdsutil.exe\" && exec.cmdline in [~\"*ntds*\", ~\"*create*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fqj-dnw-hmo","attributes":{"version":1,"name":"kernel_module_unlink","description":"A new kernel module was added","expression":"(\n    (unlink.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4nd-g5m-1xh","attributes":{"version":1,"name":"mount_proc_hide","description":"Process hidden using mount","expression":"mount.mountpoint.path in [~\"/proc/1*\", ~\"/proc/2*\", ~\"/proc/3*\", ~\"/proc/4*\", ~\"/proc/5*\", ~\"/proc/6*\", ~\"/proc/7*\", ~\"/proc/8*\", ~\"/proc/9*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wui-ktw-zwv","attributes":{"version":1,"name":"pam_modification_utimes","description":"PAM may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yrc-jyx-l5i","attributes":{"version":1,"name":"tty_shell_in_container","description":"A shell with a TTY was executed in a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && process.tty_name != \"\" && process.container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vqh-8ry-vsb","attributes":{"version":1,"name":"pam_modification_link","description":"PAM may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || link.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n4m-q5y-yhu","attributes":{"version":1,"name":"ssl_certificate_tampering_unlink","description":"SSL certificates may have been tampered with","expression":"(\n    (unlink.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8i4-ehq-i3p","attributes":{"version":1,"name":"gcp_imds","description":"An GCP IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token\", ~\"*169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fje-48p-1n8","attributes":{"version":1,"name":"ssh_authorized_keys_unlink","description":"SSH modified keys may have been modified","expression":"(\n    unlink.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (unlink.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"luu-gor-cgb","attributes":{"version":1,"name":"sudoers_policy_modified_utimes","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (utimes.file.path == \"/etc/sudoers\")\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"89r-spf-prk","attributes":{"version":1,"name":"credential_modified_open_v2","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    open.flags & ((O_CREAT|O_RDWR|O_WRONLY|O_TRUNC)) > 0 &&\n    (open.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"490-ewn-i16","attributes":{"version":1,"name":"chatroom_request","description":"A DNS request was made for a chatroom domain","expression":"dns.question.name in [\"discord.com\", \"api.telegram.org\", \"cdn.discordapp.com\"]","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vzm-iv2-vhs","attributes":{"version":1,"name":"windows_test_default_rule","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pyu-xzd-leo","attributes":{"version":1,"name":"user_created_tty","description":"A user was created via an interactive session","expression":"exec.file.name in [\"useradd\", \"newusers\", \"adduser\"] && exec.tty_name !=\"\" && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && exec.args_flags not in [\"D\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zdm-kv0-gca","attributes":{"version":1,"name":"net_file_download","description":"A suspicious file was written by a network utility","expression":"open.flags & O_CREAT > 0 && process.comm in [\"wget\", \"curl\", \"lwp-download\"]\n&& (\n  (open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.sh\", ~\"*.c\", ~\"*.so\", ~\"*.ko\"])\n  || open.file.path in [~\"/usr/**\", ~\"/lib/**\", ~\"/etc/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5ts-w6u-tfl","attributes":{"version":1,"name":"registry_runkey_modified","description":"A Registry runkey has been modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\Software\\Microsoft\\Windows\\CurrentVersion\\RunonceEx\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521302,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jgi-rfz-rlb","attributes":{"version":1,"name":"pam_modification_unlink","description":"PAM may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"coy-qpb-suv","attributes":{"version":1,"name":"credential_modified_unlink","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (unlink.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-9tn-irt","attributes":{"version":1,"name":"ssl_certificate_tampering_link","description":"SSL certificates may have been tampered with","expression":"(\n    (link.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || link.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.file.name !~ \"runc*\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dig-cav-hhc","attributes":{"version":1,"name":"kmod_list","description":"Kernel modules were listed using the kmod command","expression":"exec.comm == \"kmod\" && exec.args in [~\"*list*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jlg-roy-9zx","attributes":{"version":1,"name":"auditd_rule_file_modified","description":"The auditd rules file was modified without using auditctl","expression":"open.file.path in [\"/etc/audit/rules.d/audit.rules\", \"/etc/audit/audit.rules\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"v83-av9-xuy","attributes":{"version":1,"name":"ntds_in_commandline","description":"NTDS file referenced in commandline","expression":"exec.cmdline =~ \"*ntds.dit*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rnj-nwd-n5v","attributes":{"version":1,"name":"procdump_usage","description":"Testing a default windows agent rule","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pjn-4hr-bot","attributes":{"version":1,"name":"suspicious_suid_execution","description":"Recently written or modified suid file has been executed","expression":"((process.file.mode & S_ISUID > 0) && process.file.modification_time < 30s) && exec.file.name != \"\" && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bw8-ud8-qzq","attributes":{"version":1,"name":"net_util_exfiltration","description":"Exfiltration attempt via network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] &&\nexec.args_options in [ ~\"post-file=*\", ~\"post-data=*\", ~\"T=*\", ~\"d=@*\", ~\"upload-file=*\", ~\"F=file*\"] &&\nexec.args not in [~\"*localhost*\", ~\"*127.0.0.1*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4jd-zjb-ybo","attributes":{"version":1,"name":"shell_history_symlink","description":"A symbolic link for shell history was created targeting /dev/null","expression":"exec.comm == \"ln\" && exec.args in [~\"*.*history*\", \"/dev/null\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"can-pva-exd","attributes":{"version":1,"name":"suspicious_container_client","description":"A container management utility was executed in a container","expression":"exec.file.name in [\"docker\", \"kubectl\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bb8-sg5-ful","attributes":{"version":1,"name":"kernel_module_load_container","description":"A container loaded a new kernel module","expression":"load_module.name != \"\" && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yzz-sm2-0ff","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chmod","description":"Critical system binaries may have been modified","expression":"(\n    (chmod.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7nx-gb8-9t4","attributes":{"version":1,"name":"rc_scripts_modified","description":"RC scripts modified","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && (open.file.path in [\"/etc/rc.common\", \"/etc/rc.local\"])) && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"npo-tkf-eex","attributes":{"version":1,"name":"pam_modification_chmod","description":"PAM may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gw4-kqw-q1l","attributes":{"version":1,"name":"new_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"atm-kqf-qa2","attributes":{"version":1,"name":"systemd_modification_chmod","description":"A service may have been modified without authorization","expression":"(\n    (chmod.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521301,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"oqc-9gu-uq5","attributes":{"version":1,"name":"ssl_certificate_tampering_utimes","description":"SSL certificates may have been tampered with","expression":"(\n    (utimes.file.path in [ ~\"/etc/ssl/certs/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cfe-7qi-s5j","attributes":{"version":1,"name":"pci_11_5_critical_binaries_unlink","description":"Critical system binaries may have been modified","expression":"(\n    (unlink.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bqm-bp1-dpv","attributes":{"version":1,"name":"nsswitch_conf_mod_link","description":"nsswitch may have been modified without authorization","expression":"(\n    (link.file.path in [ \"/etc/nsswitch.conf\" ]\n    || link.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nah-p3m-dgh","attributes":{"version":1,"name":"database_shell_execution","description":"A database application spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\nprocess.parent.file.name in [\"mysqld\", \"mongod\", \"postgres\"] &&\n!(process.parent.file.name == \"initdb\" &&\nexec.args == \"-c locale -a\") &&\n!(process.parent.file.name == \"postgres\" &&\nexec.args == ~\"*pg_wal*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4mm-9uv-w3t","attributes":{"version":1,"name":"shell_profile_modification","description":"Shell profile was modified","expression":"open.file.path in [~\"/home/*/*profile\", ~\"/home/*/*rc\"] && open.flags & ((O_CREAT|O_TRUNC|O_RDWR|O_WRONLY)) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6q-hmw-lae","attributes":{"version":1,"name":"auditd_config_modified","description":"The auditd configuration file was modified without using auditctl","expression":"open.file.path == \"/etc/audit/auditd.conf\" && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.name != \"auditctl\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"brz-yda-nve","attributes":{"version":1,"name":"ssh_authorized_keys_link","description":"SSH modified keys may have been modified","expression":"(\n    link.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (link.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || link.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4be-qms-wyo","attributes":{"version":1,"name":"windows_update_registry_key_modified","description":"Windows update registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsUpdate*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ttl-6wn-1ke","attributes":{"version":1,"name":"ssh_it_tool_config_write","description":"The configuration directory for an ssh worm","expression":"open.file.path in [~\"/root/.prng/*\", ~\"/home/*/.prng/*\", ~\"/root/.config/prng/*\", ~\"/home/*/.config/prng/*\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n0c-0if-hne","attributes":{"version":1,"name":"nsswitch_conf_mod_chmod","description":"nsswitch may have been modified without authorization","expression":"(\n    (chmod.file.path in [ \"/etc/nsswitch.conf\" ])\n) && chmod.file.destination.mode != chmod.file.mode && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ryr-yxl-ilk","attributes":{"version":1,"name":"nsswitch_conf_mod_utimes","description":"nsswitch may have been modified without authorization","expression":"(\n    (utimes.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"61g-xow-oup","attributes":{"version":1,"name":"nsswitch_conf_mod_chown","description":"nsswitch may have been modified without authorization","expression":"(\n    (chown.file.path in [ \"/etc/nsswitch.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"es9-b6s-upq","attributes":{"version":1,"name":"ssl_certificate_tampering_open_v2","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"\n&& container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x79-zfs-0ix","attributes":{"version":1,"name":"omigod","description":"Omiagent spawns a privileged child process","expression":"exec.uid >= 0 && process.ancestors.file.name == \"omiagent\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8ks-vsd-y6y","attributes":{"version":1,"name":"ssl_certificate_tampering_open","description":"SSL certificates may have been tampered with","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521300,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zb2-wpx-aff","attributes":{"version":1,"name":"new_binary_execution_in_container","description":"A container executed a new binary not found in the container image","expression":"container.id != \"\" && process.file.in_upper_layer && process.file.modification_time < 30s && exec.file.name != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"k6c-tqa-hjv","attributes":{"version":1,"name":"ssh_authorized_keys_open_v2","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uwk-qfs-oqe","attributes":{"version":1,"name":"kernel_module_chmod","description":"A new kernel module was added","expression":"(\n    (chmod.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"czs-lbr-7k2","attributes":{"version":1,"name":"ptrace_antidebug","description":"A process uses an anti-debugging technique to block debuggers","expression":"ptrace.request == PTRACE_TRACEME && process.file.name != \"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bpu-wji-3ed","attributes":{"version":1,"name":"exec_lsmod","description":"Kernel modules were listed using the lsmod command","expression":"exec.comm == \"lsmod\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jch-xfg-uak","attributes":{"version":1,"name":"nsswitch_conf_mod_unlink","description":"nsswitch may have been modified without authorization","expression":"(\n    (unlink.file.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yue-sj6-ucc","attributes":{"version":1,"name":"ssl_certificate_tampering_rename","description":"SSL certificates may have been tampered with","expression":"(\n    (rename.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ]\n    || rename.file.destination.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rp7-w2i-wnj","attributes":{"version":1,"name":"credential_modified_link","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (link.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || link.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mcj-rg7-foe","attributes":{"version":1,"name":"credential_modified_rename","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (rename.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ]\n    || rename.file.destination.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yu3-bwu-ji4","attributes":{"version":1,"name":"nick_new_java_detect_with_real_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":[],"actions":[],"agentConstraint":">= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jcr-yly-myj","attributes":{"version":1,"name":"ssl_certificate_tampering_chown","description":"SSL certificates may have been tampered with","expression":"(\n    (chown.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"llc-wxw-5uh","attributes":{"version":1,"name":"dirty_pipe_attempt","description":"Potential Dirty pipe exploitation attempt","expression":"(splice.pipe_entry_flag & PIPE_BUF_FLAG_CAN_MERGE) != 0 && (splice.pipe_exit_flag & PIPE_BUF_FLAG_CAN_MERGE) == 0 && (process.uid != 0 && process.gid != 0)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x7k-bop-jcu","attributes":{"version":1,"name":"windows_com_rpc_debugging_registry_key_modified","description":"Windows RPC COM debugging registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ypb-aen-wts","attributes":{"version":1,"name":"mount_host_fs","description":"The host file system was mounted in a container","expression":"mount.source.path == \"/\" && mount.fs_type != \"overlay\" && container.id != \"\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521299,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zjd-e62-fkk","attributes":{"version":1,"name":"release_agent_container_breakout","description":"A process attempted to write to the release_agent file of a cgroup, indicating a potential container breakout attempt","expression":"container.id != \"\" && open.file.name == \"release_agent\" && open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":1646684459816,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgc-7yd-gpm","attributes":{"version":1,"name":"pci_11_5_critical_binaries_rename","description":"Critical system binaries may have been modified","expression":"(\n    (rename.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || rename.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bue-96a-bwo","attributes":{"version":1,"name":"pam_modification_rename","description":"PAM may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ]\n    || rename.file.destination.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nue-ulh-gxb","attributes":{"version":1,"name":"aws_imds","description":"An AWS IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/latest/meta-data/iam/security-credentials/*\", ~\"*169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\", ~\"*169.254.170.2/*/credentials?id=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"55u-gp9-m0k","attributes":{"version":1,"name":"invalid_agent_constraint","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":[],"actions":[],"agentConstraint":"0.0.0 >= 7.0.0","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"8og-5of-lw8","attributes":{"version":1,"name":"offensive_k8s_tool","description":"A known kubernetes pentesting tool has been executed","expression":"(exec.file.name in [ ~\"python*\" ] && (\"KubiScan.py\" in exec.argv || \"kubestriker\" in exec.argv ) ) || exec.file.name in [ \"kubiscan\",\"kdigger\",\"kube-hunter\",\"rakkess\",\"peirates\",\"kubescape\",\"kubeaudit\",\"kube-linter\",\"stratus\",~\"botb-*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fdj-qws-x9g","attributes":{"version":1,"name":"sudoers_policy_modified_chmod","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chmod.file.path == \"/etc/sudoers\")\n) && chmod.file.destination.mode != chmod.file.mode && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqf-gv4-huh","attributes":{"version":1,"name":"windows_test_default_rule_b","description":"Execution of a java process on windows","expression":"exec.file.name == \"java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"jji-uaq-xqi","attributes":{"version":1,"name":"net_util_in_container","description":"A network utility was executed in a container","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id != \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tj0-f4s-grz","attributes":{"version":1,"name":"pam_modification_chown","description":"PAM may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mmg-bkt-mx4","attributes":{"version":1,"name":"exec_whoami","description":"The whoami command was executed","expression":"exec.comm == \"whoami\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ao4-966-ahr","attributes":{"version":1,"name":"sensitive_tracing","description":"A process is tracing privileged processes or sshd for possible credential dumping","expression":"(ptrace.request == PTRACE_PEEKTEXT || ptrace.request == PTRACE_PEEKDATA || ptrace.request == PTRACE_PEEKUSR) && ptrace.tracee.euid == 0 && process.comm not in [\"dlv\", \"dlv-linux-amd64\", \"strace\", \"gdb\", \"lldb-server\"]","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mrk-tku-sbc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_chown","description":"Critical system binaries may have been modified","expression":"(\n    (chown.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nk2-hcg-hf5","attributes":{"version":1,"name":"kernel_module_load_from_memory","description":"A kernel module was loaded from memory","expression":"load_module.loaded_from_memory == true","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hau-g4f-zzo","attributes":{"version":1,"name":"apparmor_modified_tty","description":"An AppArmor profile was modified in an interactive session","expression":"exec.file.name in [\"aa-disable\", \"aa-complain\", \"aa-audit\"] && exec.tty_name !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0gp-zoy-gyb","attributes":{"version":1,"name":"runc_leaky_fd","description":"The container breakout CVE-2024-21626 was successful","expression":"chdir.syscall.path =~ \"/proc/self/fd/*\" && chdir.file.path == \"/sys/fs/cgroup\" && process.file.name =~ \"runc.*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wqb-yxc-mtb","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open_v2","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && container.created_at > 90s","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vpa-xoh-cia","attributes":{"version":1,"name":"procdump_execution","description":"A tool used to dump process memory has been executed","expression":"exec.file.name in [\"procmon.exe\",\"procdump.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vlv-1qs-cjz","attributes":{"version":1,"name":"sudoers_policy_modified_rename","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (rename.file.path == \"/etc/sudoers\"\n    || rename.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"itl-shq-qre","attributes":{"version":1,"name":"nsswitch_conf_mod_open_v2","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && container.created_at > 90s && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521298,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fpl-fno-4u3","attributes":{"version":1,"name":"aws_eks_service_account_token_accessed","description":"The AWS EKS service account token was accessed","expression":"open.file.path =~ \"/var/run/secrets/eks.amazonaws.com/serviceaccount/**\" && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"3vq-bya-qsj","attributes":{"version":1,"name":"windows_security_essentials_executable_modified","description":"microsoft security essentials executable modified","expression":"write.file.device_path in [~\"\\Device\\*\\Program Files\\Microsoft Security Client\\msseces.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"08i-pvz-95h","attributes":{"version":1,"name":"crackmap_exec_executed","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme.exe*\", ~\"*cme.py*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpx-hnf-bc6","attributes":{"version":1,"name":"critical_registry_export","description":"regedit used to export critical registry hive","expression":"exec.file.name in [\"reg.exe\", \"regedit.exe\"] && exec.cmdline in [~\"*hklm*\", ~\"*hkey_local_machine*\", ~\"*system*\", ~\"*sam*\", ~\"*security*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aoh-97n-qus","attributes":{"version":1,"name":"redis_save_module","description":"Redis module has been created","expression":"(open.flags & (O_CREAT|O_TRUNC|O_RDWR|O_WRONLY) > 0 && open.file.path =~ \"/tmp/**\" && open.file.name in [~\"*.rdb\", ~\"*.aof\", ~\"*.so\"]) && process.file.name in [\"redis-check-rdb\", \"redis-server\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tqg-9ps-mhw","attributes":{"version":1,"name":"passwd_execution","description":"The passwd or chpasswd utility was used to modify an account password","expression":"exec.file.path in [\"/usr/bin/passwd\", \"/usr/sbin/chpasswd\"] && exec.args_flags not in [\"S\", \"status\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"j4r-2xn-ha0","attributes":{"version":1,"name":"sudoers_policy_modified_open","description":"Sudoers policy file may have been modified without authorization","expression":"(open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n(open.file.path == \"/etc/sudoers\")) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"azw-x88-p7j","attributes":{"version":1,"name":"kubernetes_dns_enumeration","description":"Kubernetes DNS enumeration","expression":"dns.question.name == \"any.any.svc.cluster.local\" && dns.question.type == SRV && container.id != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vma-bsh-4d1","attributes":{"version":1,"name":"kernel_msr_write","description":"A process attempted to enable writing to model-specific registers","expression":"exec.comm == \"modprobe\" && process.args =~ \"*msr*allow_writes*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"aed-rue-lpr","attributes":{"version":1,"name":"ip_check_domain","description":"A DNS lookup was done for a IP check service","expression":"dns.question.name in [\"icanhazip.com\", \"ip-api.com\", \"myip.opendns.com\", \"checkip.amazonaws.com\", \"whatismyip.akamai.com\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"stp-dwk-4j7","attributes":{"version":1,"name":"delete_system_log","description":"A process deleted common system log files","expression":"unlink.file.path in [\"/var/run/utmp\", \"/var/log/wtmp\", \"/var/log/btmp\", \"/var/log/lastlog\", \"/var/log/faillog\", \"/var/log/syslog\", \"/var/log/messages\", \"/var/log/secure\", \"/var/log/auth.log\", \"/var/log/boot.log\", \"/var/log/kern.log\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4s4-ezo-w7q","attributes":{"version":1,"name":"dynamic_linker_config_write","description":"A process wrote to a dynamic linker config file","expression":"open.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gdc-uhk-mtc","attributes":{"version":1,"name":"ssh_authorized_keys_open","description":"SSH modified keys may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (open.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rgq-fea-q99","attributes":{"version":1,"name":"windows_system_enviroment_variable_registry_key_modified","description":"Windows environment variable registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Environment*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"n9y-2nc-no0","attributes":{"version":1,"name":"dotnet_dump_execution","description":"Dotnet_dump was used to dump a process memory","expression":"exec.cmdline =~ \"*dotnet-dump*\" && exec.cmdline =~ \"*collect*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"r3m-72r-y8g","attributes":{"version":1,"name":"shell_history_truncated","description":"Shell History was Deleted","expression":"open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 && open.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && open.file.path in [~\"/root/*\", ~\"/home/**\"] && process.file.name == \"truncate\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zqc-vts-wok","attributes":{"version":1,"name":"nsswitch_conf_mod_open","description":"nsswitch may have been modified without authorization","expression":"(\n    open.flags & ((O_RDWR|O_WRONLY|O_CREAT)) > 0 &&\n    (open.file.path in [ \"/etc/nsswitch.conf\" ])\n) && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"usg-zrs-ckt","attributes":{"version":1,"name":"winlogon_registry_key_modified","description":"Windows winlogon registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"x4t-j4v-l4r","attributes":{"version":1,"name":"windows_explorer_executable_modified","description":"windows explorer file has been modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\explorer.exe\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"9mk-a4g-rb5","attributes":{"version":1,"name":"crackmap_exec_usage","description":"Known offensive tool crackmap exec executed","expression":"exec.cmdline in [~\"*crackmapexec*\", ~\"*cme*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cqr-wm9-cjl","attributes":{"version":1,"name":"systemd_modification_open","description":"A service may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cxw-5gm-pid","attributes":{"version":1,"name":"curl_docker_socket","description":"The Docker socket was referenced in a cURL command","expression":"exec.file.name == \"curl\" && exec.args_flags in [\"unix-socket\"] && exec.args in [~\"*docker.sock*\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gpf-aeq-icx","attributes":{"version":1,"name":"ssh_authorized_keys_chown","description":"SSH modified keys may have been modified","expression":"(\n    chown.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chown.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521297,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iqk-ui0-v8c","attributes":{"version":1,"name":"hidden_file_executed","description":"A hidden file was executed in a suspicious folder","expression":"exec.file.name =~ \".*\" && exec.file.path in [~\"/home/**\", ~\"/tmp/**\", ~\"/var/tmp/**\", ~\"/dev/shm/**\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"s1j-kv4-llt","attributes":{"version":1,"name":"selinux_disable_enforcement","description":"SELinux enforcement status was disabled","expression":"selinux.enforce.status in [\"permissive\", \"disabled\"] && process.ancestors.args != ~\"*BECOME-SUCCESS*\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a9j-6xn-afo","attributes":{"version":1,"name":"sliver_c2_implant_execution","description":"process arguments match sliver c2 implant","expression":"exec.cmdline =~ \"*NoExit *\" && exec.cmdline =~ \"*Command *\" && exec.cmdline =~ \"*[Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vb1-l7o-skr","attributes":{"version":1,"name":"ssl_certificate_tampering_chmod","description":"SSL certificates may have been tampered with","expression":"(\n    (chmod.file.path in [ ~\"/etc/ssl/certs/**\", ~\"/etc/pki/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.mode != chmod.file.destination.mode\n&& process.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path != \"/usr/sbin/update-ca-certificates\"\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n&& process.file.name !~ \"runc*\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1or-3oo-rag","attributes":{"version":1,"name":"new_java_detect","description":"Execution of a new java process","expression":"exec.file.name == \"new_java\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qme-vau-bk4","attributes":{"version":1,"name":"potential_web_shell_parent","description":"A web application spawned a shell or shell utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] || exec.comm in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"]) &&\n(process.parent.file.name in [\"apache2\", \"nginx\", ~\"tomcat*\", \"httpd\"] || process.parent.file.name =~ \"php*\")","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"7ft-hzb-mpc","attributes":{"version":1,"name":"critical_windows_files_modified","description":"a critical windows file was modified","expression":"write.file.device_path in [~\"\\Device\\*\\windows\\system32\\**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hbd-kty-ixx","attributes":{"version":1,"name":"kernel_module_utimes","description":"A new kernel module was added","expression":"(\n    (utimes.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rly-bqo-sg1","attributes":{"version":1,"name":"systemd_modification_utimes","description":"A service may have been modified without authorization","expression":"(\n    (utimes.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"eda-l1r-hrq","attributes":{"version":1,"name":"relay_attack_tool_execution","description":"Process matches known relay attack tool","expression":"exec.file.name in [~\"*PetitPotam*\", ~\"*RottenPotato*\", ~\"*HotPotato*\", ~\"*JuicyPotato*\", ~\"*just_dce_*\", ~\"*Juicy Potato*\", \"rot.exe\", \"Potato.exe\", \"SpoolSample.exe\", \"Responder.exe\", ~\"*smbrelayx*\", ~\"*smbrelayx*\", ~\"*ntlmrelayx*\", ~\"*LocalPotato*\"] || exec.cmdline in [~\"*Invoke-Tater*\", ~\"*smbrelay*\", ~\"*ntlmrelay*\", ~\"*cme smb*\", ~\"*ntlm:NTLMhash*\", ~\"*Invoke-PetitPotam*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"rbo-40l-grx","attributes":{"version":1,"name":"net_unusual_request","description":"Network utility executed with suspicious URI","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*.php*\", ~\"*.jpg*\"] ","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gci-o39-u6v","attributes":{"version":1,"name":"read_kubeconfig","description":"The kubeconfig file was accessed","expression":"open.file.path in [~\"/home/*/.kube/config\", \"/root/.kube/config\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"1uw-i6q-m5n","attributes":{"version":1,"name":"nsswitch_conf_mod_rename","description":"nsswitch may have been modified without authorization","expression":"(\n    (rename.file.path in [ \"/etc/nsswitch.conf\" ]\n    || rename.file.destination.path in [ \"/etc/nsswitch.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ynr-dvw-x2x","attributes":{"version":1,"name":"ssh_authorized_keys_rename","description":"SSH modified keys may have been modified","expression":"(\n    rename.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (rename.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ]\n    || rename.file.destination.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521296,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fme-ym2-lwi","attributes":{"version":1,"name":"systemd_modification_link","description":"A service may have been modified without authorization","expression":"(\n    (link.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || link.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tht-nwe-guf","attributes":{"version":1,"name":"k8s_pod_service_account_token_accessed","description":"The Kubernetes pod service account token was accessed","expression":"open.file.path in [~\"/var/run/secrets/kubernetes.io/serviceaccount/**\", ~\"/run/secrets/kubernetes.io/serviceaccount/**\"] && open.file.name == \"token\" && process.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"] && process.file.path not in  [\"/usr/bin/cilium-agent\", \"/coredns\", \"/usr/bin/cilium-operator\", \"/manager\", \"/fluent-bit/bin/fluent-bit\", \"/usr/local/bin/cloud-node-manager\", \"/secrets-store-csi\", \"/bin/secrets-store-csi-driver-provider-aws\", \"/usr/bin/calico-node\", \"/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent\", \"/nginx-ingress-controller\", \"/cluster-autoscaler\", \"/cluster-proportional-autoscaler\", \"/haproxy-ingress-controller\", \"/kube-state-metrics\", \"/fluent-bit-gke-exporter\", \"/bin/external-secrets\", \"/node-termination-handler\", \"/fluent-bit-gke-exporter\", \"/bin/vault\", \"/usr/local/bin/kubectl\", \"/local-provisioner\", \"/usr/bin/gitlab-runner\", \"/usr/local/bin/vaultd\", \"/usr/local/bin/trace-driveline-writer\", \"/usr/local/bin/registration-controller\", \"/usr/local/bin/cluster-autoscaler\"] && process.ancestors.file.path not in [\"/opt/datadog-agent/embedded/bin/agent\", \"/opt/datadog-agent/embedded/bin/system-probe\", \"/opt/datadog-agent/embedded/bin/security-agent\", \"/opt/datadog-agent/embedded/bin/process-agent\", \"/opt/datadog-agent/embedded/bin/trace-agent\", \"/opt/datadog-agent/bin/agent/agent\", \"/opt/datadog/apm/inject/auto_inject_runc\", \"/usr/bin/dd-host-install\", \"/usr/bin/dd-host-container-install\", \"/usr/bin/dd-container-install\", \"/opt/datadog-agent/bin/datadog-cluster-agent\", ~\"/opt/datadog-packages/**\", ~\"/opt/datadog-installer/**\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"a6d-gre-qls","attributes":{"version":1,"name":"service_stop","description":"systemctl used to stop a service","expression":"exec.file.name == \"systemctl\" && exec.args in [~\"*stop*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ljs-qkf-c4r","attributes":{"version":1,"name":"pam_modification_open","description":"PAM may have been modified without authorization","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/etc/pam.d/**\", \"/etc/pam.conf\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"vhj-z63-abi","attributes":{"version":1,"name":"systemd_modification_chown","description":"A service may have been modified without authorization","expression":"(\n    (chown.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pho-wta-zir","attributes":{"version":1,"name":"net_util","description":"A network utility was executed","expression":"(exec.comm in [\"socat\", \"dig\", \"nslookup\", \"host\", ~\"netcat*\", ~\"nc*\", \"ncat\"] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"]) &&\ncontainer.id == \"\" && exec.args not in [ ~\"*localhost*\", ~\"*127.0.0.1*\", ~\"*motd.ubuntu.com*\" ]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"m36-fmz-1bi","attributes":{"version":1,"name":"executable_bit_added","description":"The executable bit was added to a newly created file","expression":"chmod.file.in_upper_layer &&\nchmod.file.change_time < 30s &&\ncontainer.id != \"\" &&\nchmod.file.destination.mode != chmod.file.mode &&\nchmod.file.destination.mode & S_IXUSR|S_IXGRP|S_IXOTH > 0 &&\nprocess.argv in [\"+x\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"5j0-kon-1hn","attributes":{"version":1,"name":"sudoers_policy_modified_link","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (link.file.path == \"/etc/sudoers\"\n    || link.file.destination.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hsw-h1t-p9n","attributes":{"version":1,"name":"suid_file_execution","description":"a SUID file was executed","expression":"(setuid.euid == 0 || setuid.uid  == 0)  && process.file.mode & S_ISUID > 0  && process.file.uid == 0  && process.uid != 0  && process.file.path != \"/usr/bin/sudo\"","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"da1-a9j-tw9","attributes":{"version":1,"name":"sudoers_policy_modified_unlink","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (unlink.file.path == \"/etc/sudoers\")\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"4tw-oex-wnc","attributes":{"version":1,"name":"cryptominer_args","description":"A process launched with arguments associated with cryptominers","expression":"exec.args_options in [~\"cpu-priority*\", ~\"donate-level*\"] || exec.args_flags == \"randomx-1gb-pages\" || exec.args in [~\"*stratum+tcp*\", ~\"*stratum+ssl*\", ~\"*stratum1+tcp*\", ~\"*stratum1+ssl*\", ~\"*stratum2+tcp*\", ~\"*stratum2+ssl*\", ~\"*nicehash*\", ~\"*yespower*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uga-lal-zqb","attributes":{"version":1,"name":"php_spawning_shell","description":"PHP web application spawning shell","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name in [\"php.exe\",\"php-cgi.exe\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"alv-iwj-sbs","attributes":{"version":1,"name":"systemd_modification_unlink","description":"A service may have been modified without authorization","expression":"(\n    (unlink.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"nsy-20w-pj6","attributes":{"version":1,"name":"sharpup_tool_usage","description":"sharpup tool used for local privilege escalation","expression":"exec.file.name == \"sharpup.exe\" && exec.cmdline in [~\"*HijackablePaths*\", ~\"*UnquotedServicePath*\", ~\"*ProcessDLLHijack*\", ~\"*ModifiableServiceBinaries*\", ~\"*ModifiableScheduledTask*\", ~\"*DomainGPPPassword*\", ~\"*CachedGPPPassword*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mam-ir1-532","attributes":{"version":1,"name":"windows_cryptographic_blocking_policy_registry_key_modified","description":"Windows cryptographic blocking policy modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CryptSIPDllRemoveSignedDataMsg*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"tn9-vck-we9","attributes":{"version":1,"name":"shell_history_deleted","description":"Shell History was Deleted","expression":"unlink.file.name in [\".bash_history\", \".zsh_history\", \".fish_history\", \"fish_history\", \".dash_history\", \".sh_history\"] && unlink.file.path in [~\"/root/**\", ~\"/home/**\"] && process.comm not in [\"dockerd\", \"containerd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ows-d9p-s2b","attributes":{"version":1,"name":"runc_modification","description":"The runc binary was modified in a non-standard way","expression":"open.file.path in [\"/usr/bin/runc\", \"/usr/sbin/runc\", \"/usr/bin/docker-runc\"]\n&& open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0\n&& process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n&& process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"on3-qxk-zeh","attributes":{"version":1,"name":"paste_site","description":"A DNS lookup was done for a pastebin-like site","expression":"dns.question.name in [\"pastebin.com\", \"ghostbin.com\", \"termbin.com\", \"klgrth.io\", \"rentry.co\", \"transfer.sh\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bdi-lzv-pki","attributes":{"version":1,"name":"azure_imds","description":"An Azure IMDS was called via a network utility","expression":"exec.comm in [\"wget\", \"curl\", \"lwp-download\"] && exec.args in [~\"*169.254.169.254/metadata/identity/oauth2/token?api-version=*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qay-zpa-akb","attributes":{"version":1,"name":"rubeus_execution","description":"process arguments match rubeus credential theft tool","expression":"exec.cmdline in [~\"*asreproast*\", ~\"*/service:krbtgt*\", ~\"*dump /luid:0x*\", ~\"*kerberoast*\", ~\"*createonly /program*\", ~\"*ptt /ticket*\", ~\"*impersonateuser*\", ~\"*renew /ticket*\", ~\"*asktgt /user*\", ~\"*harvest /interval*\", ~\"*s4u /user*\", ~\"*hash /password*\", ~\"*golden /aes256*\", ~\"*silver /user*\", \"*rubeus*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521295,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"uty-ayo-tpv","attributes":{"version":1,"name":"wmi_spawning_shell","description":"Command executed via WMI","expression":"exec.file.name in [~\"powershell*\",\"cmd.exe\"] && process.parent.file.name == \"WmiPrvSE.exe\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"icy-i3s-bvd","attributes":{"version":1,"name":"deploy_priv_container","description":"A privileged container was created","expression":"exec.file.name != \"\" && container.created_at < 1s && process.cap_permitted & CAP_SYS_ADMIN > 0","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6du-s2a-foz","attributes":{"version":1,"name":"suspicious_bitsadmin_usage","description":"A suspicious bitsadmin command has been executed","expression":"exec.file.name == \"bitsadmin.exe\" && exec.cmdline in [~\"*addfile*\", ~\"*create*\", ~\"*resume*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dco-vsp-sto","attributes":{"version":1,"name":"ssh_authorized_keys_chmod","description":"SSH modified keys may have been modified","expression":"(\n    chmod.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (chmod.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"fyc-tp1-xr1","attributes":{"version":1,"name":"windows_boot_registry_key_modified","description":"Windows boot registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\IniFileMapping\\SYSTEM.ini\\boot*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"pxm-cg7-96w","attributes":{"version":1,"name":"sudoers_policy_modified_chown","description":"Sudoers policy file may have been modified without authorization","expression":"(\n    (chown.file.path == \"/etc/sudoers\")\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"bft-ikt-sfa","attributes":{"version":1,"name":"registry_service_runkey_modified","description":"Service registry runkey modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\", ~\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\CurrentVersion\\RunServices\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ydm-yqo-f9t","attributes":{"version":1,"name":"looney_tunables_exploit","description":"Looney Tunables (CVE-2023-4911) exploit attempted","expression":"exec.file.mode & S_ISUID > 0 && exec.file.uid == 0 && exec.uid != 0 && exec.envs in [~\"*GLIBC_TUNABLES*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wpy-igs-bcp","attributes":{"version":1,"name":"windows_shell_folders_registry_key_modified","description":"Windows shell folders registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders*\", ~\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gyj-yid-n02","attributes":{"version":1,"name":"ptrace_injection","description":"A process attempted to inject code into another process","expression":"ptrace.request == PTRACE_POKETEXT || ptrace.request == PTRACE_POKEDATA || ptrace.request == PTRACE_POKEUSR","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"kxe-vss-47x","attributes":{"version":1,"name":"windows_firewall_configuration_registry_key_modified","description":"Windows firewall configuration registry key modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\*\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"zxv-eui-tgr","attributes":{"version":1,"name":"auditctl_usage","description":"The auditctl command was used to modify auditd","expression":"exec.file.name == \"auditctl\" && exec.args_flags not in [\"s\", \"l\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ccs-c0e-kx6","attributes":{"version":1,"name":"minidump_usage","description":"Process memory was dumped using the minidump function from comsvcs.dll","expression":"exec.cmdline =~ \"*MiniDump*\" && exec.cmdline =~ \"*comsvcs*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"we1-nic-zhp","attributes":{"version":1,"name":"base64_decode","description":"The base64 command was used to decode information","expression":"exec.file.name == \"base64\" && exec.args_flags in [\"d\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mjs-qml-f6e","attributes":{"version":1,"name":"systemd_modification_rename","description":"A service may have been modified without authorization","expression":"(\n    (rename.file.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/systemd/system/**\", ~\"/usr/lib/systemd/system/**\", ~\"/etc/systemd/system/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"elg-0ho-jjb","attributes":{"version":1,"name":"powershell_empire_uac_bypass","description":"A process was executed matching arguments for a UAC bypass technique common in powershell empire","expression":"exec.cmdline in [~\"*-NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*\", ~\"*-NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dzi-svp-ub2","attributes":{"version":1,"name":"memfd_create","description":"memfd object created","expression":"exec.file.name =~ \"memfd*\" && exec.file.path == \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"iv0-azx-iwi","attributes":{"version":1,"name":"interactive_shell_in_container","description":"An interactive shell was started inside of a container","expression":"exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] && exec.args_flags in [\"i\"] && container.id !=\"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"mgb-ejl-c5b","attributes":{"version":1,"name":"kernel_module_rename","description":"A new kernel module was added","expression":"(\n    (rename.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ]\n    || rename.file.destination.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521294,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"dug-aqp-7zn","attributes":{"version":1,"name":"exec_wrmsr","description":"The wrmsr program executed","expression":"exec.comm == \"wrmsr\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"wrz-nq9-pi8","attributes":{"version":1,"name":"mining_pool_lookup","description":"A process resolved a DNS name associated with cryptomining activity","expression":"dns.question.name in [~\"*.minexmr.com\", \"minexmr.com\", ~\"*.nanopool.org\", \"nanopool.org\", ~\"*.supportxmr.com\", \"supportxmr.com\", ~\"*.c3pool.com\", \"c3pool.com\", ~\"*.p2pool.io\", \"p2pool.io\", ~\"*.ethermine.org\", \"ethermine.org\", ~\"*.f2pool.com\", \"f2pool.com\", ~\"*.poolin.me\", \"poolin.me\", ~\"*.rplant.xyz\", \"rplant.xyz\", ~\"*.miningocean.org\", \"miningocean.org\"] && process.file.name != \"\"","category":"Network Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"01c-hgk-8x3","attributes":{"version":1,"name":"credential_modified_chmod","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chmod.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && chmod.file.destination.mode != chmod.file.mode","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ld1-hxu-zdf","attributes":{"version":1,"name":"nick_new_java_detect_with_agent_version","description":"Execution of a new java process","expression":"exec.file.name == \"foogazi\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":[],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"z0y-kio-bf4","attributes":{"version":1,"name":"kernel_module_open","description":"A new kernel module was added","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    (open.file.path in [ ~\"/lib/modules/**\", ~\"/usr/lib/modules/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && process.ancestors.file.path != \"/usr/bin/kmod\"\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"xtf-uqt-mh0","attributes":{"version":1,"name":"common_net_intrusion_util","description":"A network utility (nmap) commonly used in intrusion attacks was executed","expression":"exec.file.name in [\"nmap\", \"masscan\", \"fping\", \"zgrab\", \"zgrab2\", \"rustscan\", \"pnscan\"] && exec.args_flags not in [\"V\", \"version\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"l5b-qmr-hi6","attributes":{"version":1,"name":"ssh_authorized_keys_utimes","description":"SSH modified keys may have been modified","expression":"(\n    utimes.file.name in [ \"authorized_keys\", \"authorized_keys2\" ] && (utimes.file.path in [ ~\"/root/.ssh/*\", ~\"/home/*/.ssh/*\", ~\"/var/lib/*/.ssh/*\" ])\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"qa1-stp-xpl","attributes":{"version":1,"name":"open_msr_writes","description":"A process opened a model-specific register (MSR) configuration file","expression":"open.file.path == \"/sys/module/msr/parameters/allow_writes\" && open.flags & O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY > 0","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"cwr-kgl-5xs","attributes":{"version":1,"name":"credential_modified_chown","description":"Sensitive credential files were modified using a non-standard tool","expression":"(\n    (chown.file.path in [ \"/etc/shadow\", \"/etc/gshadow\" ])\n    && process.file.path not in [ \"/sbin/vipw\", \"/usr/sbin/vipw\", \"/sbin/vigr\", \"/usr/sbin/vigr\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/groupadd\", \"/usr/sbin/useradd\", \"/usr/sbin/usermod\", \"/usr/sbin/userdel\", \"/usr/bin/gpasswd\", \"/usr/bin/chage\", \"/usr/sbin/chpasswd\", \"/usr/bin/passwd\" ]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n) && (chown.file.destination.uid != chown.file.uid || chown.file.destination.gid != chown.file.gid)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"am6-icr-cgg","attributes":{"version":1,"name":"package_management_in_container","description":"Package management was detected in a container","expression":"exec.file.path in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"] && container.id != \"\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"esx-z8e-qcs","attributes":{"version":1,"name":"safeboot_modification","description":"Safeboot registry modified","expression":"set.registry.key_path in [~\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\SafeBoot\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"sdk-dp7-vt0","attributes":{"version":1,"name":"jupyter_shell_execution","description":"A Jupyter notebook executed a shell","expression":"(exec.file.name in [\"cat\",\"chgrp\",\"chmod\",\"chown\",\"cp\",\"date\",\"dd\",\"df\",\"dir\",\"echo\",\"ln\",\"ls\",\"mkdir\",\"mknod\",\"mktemp\",\"mv\",\"pwd\",\"readlink\",\"rm\",\"rmdir\",\"sleep\",\"stty\",\"sync\",\"touch\",\"uname\",\"vdir\",\"arch\",\"b2sum\",\"base32\",\"base64\",\"basename\",\"chcon\",\"cksum\",\"comm\",\"csplit\",\"cut\",\"dircolors\",\"dirname\",\"du\",\"env\",\"expand\",\"expr\",\"factor\",\"fmt\",\"fold\",\"groups\",\"head\",\"hostid\",\"id\",\"install\",\"join\",\"link\",\"logname\",\"md5sum\",\"textutils\",\"mkfifo\",\"nice\",\"nl\",\"nohup\",\"nproc\",\"numfmt\",\"od\",\"paste\",\"pathchk\",\"pinky\",\"pr\",\"printenv\",\"printf\",\"ptx\",\"realpath\",\"runcon\",\"seq\",\"sha1sum\",\"sha224sum\",\"sha256sum\",\"sha384sum\",\"sha512sum\",\"shred\",\"shuf\",\"sort\",\"split\",\"stat\",\"stdbuf\",\"sum\",\"tac\",\"tail\",\"tee\",\"test\",\"timeout\",\"tr\",\"truncate\",\"tsort\",\"tty\",\"unexpand\",\"uniq\",\"unlink\",\"users\",\"wc\",\"who\",\"whoami\",\"chroot\"] || exec.file.name in [\"wget\", \"curl\", \"lwp-download\"] || exec.file.name in [\"dash\",\"sh\",\"static-sh\",\"sh\",\"bash\",\"bash\",\"bash-static\",\"zsh\",\"ash\",\"csh\",\"ksh\",\"tcsh\",\"busybox\",\"busybox\",\"fish\",\"ksh93\",\"rksh\",\"rksh93\",\"lksh\",\"mksh\",\"mksh-static\",\"csharp\",\"posh\",\"rc\",\"sash\",\"yash\",\"zsh5\",\"zsh5-static\"]) && process.ancestors.comm in [\"jupyter-noteboo\", \"jupyter-lab\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hnz-ezh-lyu","attributes":{"version":1,"name":"ld_preload_unusual_library_path","description":"The LD_PRELOAD variable is populated by a link to a suspicious file directory","expression":"exec.envs in [~\"LD_PRELOAD=*/tmp/*\", ~\"LD_PRELOAD=/dev/shm/*\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"yjo-mdq-mi1","attributes":{"version":1,"name":"dynamic_linker_config_unlink","description":"A process unlinked a dynamic linker config file","expression":"unlink.file.path in [\"/etc/ld.so.preload\", \"/etc/ld.so.conf\", ~\"/etc/ld.so.conf.d/*.conf\"] && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"psf-hiy-3ji","attributes":{"version":1,"name":"scheduled_task_creation","description":"A scheduled task was created","expression":"exec.cmdline in [~\"*at.exe\",~\"*schtasks*\"] && exec.cmdline =~ \"*create*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"windows\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"6vb-fkj-cdc","attributes":{"version":1,"name":"pci_11_5_critical_binaries_open","description":"Critical system binaries may have been modified","expression":"(\n    open.flags & (O_CREAT|O_TRUNC|O_APPEND|O_RDWR|O_WRONLY) > 0 &&\n    open.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521293,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"ktg-ng9-izk","attributes":{"version":1,"name":"kernel_module_load_from_memory_container","description":"A kernel module was loaded from memory inside a container","expression":"load_module.loaded_from_memory == true && container.id !=\"\"","category":"Kernel Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"0qf-cha-qci","attributes":{"version":1,"name":"java_shell_execution_parent","description":"A java process spawned a shell, shell utility, or HTTP utility","expression":"(exec.file.path in [ \"/bin/dash\",\n  \"/usr/bin/dash\",\n  \"/bin/sh\",\n  \"/bin/static-sh\",\n  \"/usr/bin/sh\",\n  \"/bin/bash\",\n  \"/usr/bin/bash\",\n  \"/bin/bash-static\",\n  \"/usr/bin/zsh\",\n  \"/usr/bin/ash\",\n  \"/usr/bin/csh\",\n  \"/usr/bin/ksh\",\n  \"/usr/bin/tcsh\",\n  \"/usr/lib/initramfs-tools/bin/busybox\",\n  \"/bin/busybox\",\n  \"/usr/bin/fish\",\n  \"/bin/ksh93\",\n  \"/bin/rksh\",\n  \"/bin/rksh93\",\n  \"/bin/lksh\",\n  \"/bin/mksh\",\n  \"/bin/mksh-static\",\n  \"/usr/bin/csharp\",\n  \"/bin/posh\",\n  \"/usr/bin/rc\",\n  \"/bin/sash\",\n  \"/usr/bin/yash\",\n  \"/bin/zsh5\",\n  \"/bin/zsh5-static\" ] ||\n exec.comm in [\"wget\", \"curl\", \"lwp-download\"] ||\n exec.file.path in [\"/bin/cat\",\"/bin/chgrp\",\"/bin/chmod\",\"/bin/chown\",\"/bin/cp\",\"/bin/date\",\"/bin/dd\",\"/bin/df\",\"/bin/dir\",\"/bin/echo\",\"/bin/ln\",\"/bin/ls\",\"/bin/mkdir\",\"/bin/mknod\",\"/bin/mktemp\",\"/bin/mv\",\"/bin/pwd\",\"/bin/readlink\",\"/bin/rm\",\"/bin/rmdir\",\"/bin/sleep\",\"/bin/stty\",\"/bin/sync\",\"/bin/touch\",\"/bin/uname\",\"/bin/vdir\",\"/usr/bin/arch\",\"/usr/bin/b2sum\",\"/usr/bin/base32\",\"/usr/bin/base64\",\"/usr/bin/basename\",\"/usr/bin/chcon\",\"/usr/bin/cksum\",\"/usr/bin/comm\",\"/usr/bin/csplit\",\"/usr/bin/cut\",\"/usr/bin/dircolors\",\"/usr/bin/dirname\",\"/usr/bin/du\",\"/usr/bin/env\",\"/usr/bin/expand\",\"/usr/bin/expr\",\"/usr/bin/factor\",\"/usr/bin/fmt\",\"/usr/bin/fold\",\"/usr/bin/groups\",\"/usr/bin/head\",\"/usr/bin/hostid\",\"/usr/bin/id\",\"/usr/bin/install\",\"/usr/bin/join\",\"/usr/bin/link\",\"/usr/bin/logname\",\"/usr/bin/md5sum\",\"/usr/bin/md5sum.textutils\",\"/usr/bin/mkfifo\",\"/usr/bin/nice\",\"/usr/bin/nl\",\"/usr/bin/nohup\",\"/usr/bin/nproc\",\"/usr/bin/numfmt\",\"/usr/bin/od\",\"/usr/bin/paste\",\"/usr/bin/pathchk\",\"/usr/bin/pinky\",\"/usr/bin/pr\",\"/usr/bin/printenv\",\"/usr/bin/printf\",\"/usr/bin/ptx\",\"/usr/bin/realpath\",\"/usr/bin/runcon\",\"/usr/bin/seq\",\"/usr/bin/sha1sum\",\"/usr/bin/sha224sum\",\"/usr/bin/sha256sum\",\"/usr/bin/sha384sum\",\"/usr/bin/sha512sum\",\"/usr/bin/shred\",\"/usr/bin/shuf\",\"/usr/bin/sort\",\"/usr/bin/split\",\"/usr/bin/stat\",\"/usr/bin/stdbuf\",\"/usr/bin/sum\",\"/usr/bin/tac\",\"/usr/bin/tail\",\"/usr/bin/tee\",\"/usr/bin/test\",\"/usr/bin/timeout\",\"/usr/bin/tr\",\"/usr/bin/truncate\",\"/usr/bin/tsort\",\"/usr/bin/tty\",\"/usr/bin/unexpand\",\"/usr/bin/uniq\",\"/usr/bin/unlink\",\"/usr/bin/users\",\"/usr/bin/wc\",\"/usr/bin/who\",\"/usr/bin/whoami\",\"/usr/sbin/chroot\",\"/bin/busybox\"])\n&& process.parent.file.name in [\"java\", \"jspawnhelper\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"gz3-l4z-bzr","attributes":{"version":1,"name":"network_sniffing_tool","description":"Local account groups were enumerated after container start up","expression":"exec.file.name in [\"tcpdump\", \"tshark\"]","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"hob-7or-knu","attributes":{"version":1,"name":"python_cli_code","description":"Python code was provided on the command line","expression":"exec.file.name == ~\"python*\" && exec.args_flags in [\"c\"] && exec.args in [~\"*-c*SOCK_STREAM*\", ~\"*-c*subprocess*\", ~\"*-c*/bash*\", ~\"*-c*/bin/sh*\", ~\"*-c*pty.spawn*\"] && exec.args !~ \"*setuptools*\"","category":"Process Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521292,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"},{"id":"buh-tbl-6k1","attributes":{"version":1,"name":"pci_11_5_critical_binaries_link","description":"Critical system binaries may have been modified","expression":"(\n    (link.file.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ]\n    || link.file.destination.path in [ ~\"/bin/*\", ~\"/sbin/*\", ~\"/usr/bin/*\", ~\"/usr/sbin/*\", ~\"/usr/local/bin/*\", ~\"/usr/local/sbin/*\", ~\"/boot/**\" ])\n    && process.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/containerd\", \"/usr/local/bin/containerd\", \"/usr/bin/dockerd\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\"]\n    && process.ancestors.file.path not in [~\"/usr/bin/apt*\", \"/usr/bin/dpkg\", \"/usr/bin/rpm\", \"/usr/bin/unattended-upgrade\", \"/usr/bin/npm\", ~\"/usr/bin/pip*\", ~\"/usr/local/bin/pip*\", \"/usr/bin/yum\", \"/sbin/apk\", \"/usr/lib/snapd/snapd\"]\n)","category":"File Activity","defaultRule":true,"enabled":true,"creationDate":0,"updateDate":1723206521243,"filters":["os == \"linux\""],"actions":[],"agentConstraint":"","creator":{"name":"","handle":""},"updater":{"name":"","handle":""}},"type":"agent_rule"}]}
        headers:
            Content-Type:
                - application/json
        status: 200 OK
        code: 200
        duration: 172.904584ms
    - id: 9
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - '*/*'
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: DELETE
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: 0
        uncompressed: false
        body: ""
        headers: {}
        status: 204 No Content
        code: 204
        duration: 141.437458ms
    - id: 10
      request:
        proto: HTTP/1.1
        proto_major: 1
        proto_minor: 1
        content_length: 0
        transfer_encoding: []
        trailer: {}
        host: api.datadoghq.com
        remote_addr: ""
        request_uri: ""
        body: ""
        form: {}
        headers:
            Accept:
                - application/json
        url: https://api.datadoghq.com/api/v2/security_monitoring/cloud_workload_security/agent_rules/55r-kwq-jsc
        method: GET
      response:
        proto: HTTP/2.0
        proto_major: 2
        proto_minor: 0
        transfer_encoding: []
        trailer: {}
        content_length: -1
        uncompressed: true
        body: |
            {"errors":["not_found(Agent rule not found: agentRuleId=55r-kwq-jsc)"]}
        headers:
            Content-Type:
                - application/json
        status: 404 Not Found
        code: 404
        duration: 139.559459ms
