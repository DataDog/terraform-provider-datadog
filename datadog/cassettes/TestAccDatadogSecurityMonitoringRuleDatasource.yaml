---
version: 1
interactions:
- request:
    body: |
      {"cases":[{"condition":"first \u003e 3 || second \u003e 10","name":"high case","notifications":["@user"],"status":"high"},{"condition":"first \u003e 0 || second \u003e 0","name":"warning case","notifications":[],"status":"medium"}],"isEnabled":false,"message":"acceptance rule triggered","name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259","options":{"evaluationWindow":300,"keepAlive":600,"maxSignalDuration":900},"queries":[{"aggregation":"count","distinctFields":[],"groupByFields":["host"],"metric":"","name":"first","query":"does not really match much"},{"aggregation":"cardinality","distinctFields":["@orgId"],"groupByFields":["host"],"metric":"@network.bytes_read","name":"second","query":"does not really match much either"}],"tags":["i:tomato","u:tomato"]}
    form: {}
    headers:
      Accept:
      - application/json
      Content-Type:
      - application/json
      Dd-Operation-Id:
      - CreateSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "3709755554855171682"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules
    method: POST
  response:
    body: '{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:50:59 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:50:59 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - GetSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "8553653898119630295"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/fwi-5hv-ggm
    method: GET
  response:
    body: '{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:50:59 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:50:59 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - GetSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "8191267280912508495"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/fwi-5hv-ggm
    method: GET
  response:
    body: '{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:50:59 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:50:59 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - GetSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "7764036370528875520"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/fwi-5hv-ggm
    method: GET
  response:
    body: '{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:00 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:00 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "6632870069288074049"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":96,"total_count":96}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:00 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:00 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - GetSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "1322421822352108445"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/fwi-5hv-ggm
    method: GET
  response:
    body: '{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":false,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606384259585,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"fwi-5hv-ggm","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606384259"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:00 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:00 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - DeleteSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "1091346262843892739"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/fwi-5hv-ggm
    method: DELETE
  response:
    body: ""
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Date:
      - Thu, 26 Nov 2020 09:51:00 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:00 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 204 No Content
    code: 204
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "6897228150263921102"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:00 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:00 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "2119954708888382361"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:01 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:01 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "3655514554213806607"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:01 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:01 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "1629731263241335189"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:01 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:01 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "2473241818866488044"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:02 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:01 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "7194281220059910631"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:02 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:02 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "5059676750897690412"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:02 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:02 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "7636339330399180480"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:03 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:02 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "4600634819029680218"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:03 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:03 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "6583768731089662447"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:03 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:03 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - GetSecurityMonitoringRule
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "7350233159271479696"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules/3149e98ae856a790c091bc8787dc92640f97c86a06b9a2f0a687b3966372e258
    method: GET
  response:
    body: '{"message": "The resource could not be found.<br /><br />\n\n\n", "code":
      "404 Not Found", "title": "Not Found"}'
    headers:
      Cache-Control:
      - no-cache
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json
      Date:
      - Thu, 26 Nov 2020 09:51:03 GMT
      Pragma:
      - no-cache
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 404 Not Found
    code: 404
    duration: ""
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/json
      Dd-Operation-Id:
      - ListSecurityMonitoringRules
      User-Agent:
      - terraform-provider-datadog/dev (terraform 1.15.0; terraform-cli 0.12.7-sdk)
        datadog-api-client-go/1.0.0-beta.11 (go go1.15.4; os darwin; arch amd64)
      X-Datadog-Parent-Id:
      - "5678002524103029091"
      X-Datadog-Sampling-Priority:
      - "1"
      X-Datadog-Trace-Id:
      - "7053671844833861908"
    url: https://dd.datad0g.com/api/v2/security_monitoring/rules?page%5Bnumber%5D=0&page%5Bsize%5D=100
    method: GET
  response:
    body: '{"meta":{"page":{"total_filtered_count":95,"total_count":95}},"data":[{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.5","source:cloudtrail","scope:cloudtrail"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling or modifying
      CloudTrail.\n\n### Strategy\nThis rule lets you monitor these CloudTrail API
      calls to detect if an attacker is modifying or disabling CloudTrail:\n\n* [DeleteTrail][1]\n*
      [UpdateTrail][2]\n* [StopLogging][3]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html\n[2]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html\n[3]:
      https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058906229,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging OR CreateTrail OR StartLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xiu-vic-6zm","isDefault":true,"name":"AWS CloudTrail
      configuration modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1069-permission-groups-discovery","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is enumerating IAM principals.\n\n### Strategy\nThis
      rule lets you leverage GuardDuty to detect when an attacker is enumerating IAM
      principals. The GuardDuty Findings which trigger this signal:\n\n* [Recon:IAMUser/NetworkPermissions][1]\n*
      [Recon:IAMUser/ResourcePermissions][2]\n* [Recon:IAMUser/UserPermissions][3]
      \n\n\n### Triage & Response\n1. Determine which user in your organization owns
      the API key that made this API call.\n2. Contact the user to see if they intended
      to make this API call.\n3. If the user did not make the API call:\n * Rotate
      the credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon7\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon9","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994647235,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/NetworkPermissions OR Recon\\:IAMUser\\/ResourcePermissions
      OR Recon\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"b1b-0ia-wgt","isDefault":true,"name":"AWS IAM
      principal enumeration"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a cryptocurrency server\n\n###
      Strategy\nThis rule lets you leverage GuardDuty to detect when an EC2 instance
      has made a DNS request or is communicating with an IP that is associated with
      cryptocurrency operations. The following GuardDuty Findings trigger this signal:\n\n*
      [CryptoCurrency:EC2/BitcoinTool.B!DNS][1]\n* [CryptoCurrency:EC2/BitcoinTool.B][2]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples. \n2. If the domain or IP address should
      not have been requested, open a security investigation, and determine which
      process requested the domain name or IP address.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto3\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_crypto.html#crypto4","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648047,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(CryptoCurrency\\:EC2\\/BitcoinTool.B\\!DNS OR CryptoCurrency\\:EC2\\/BitcoinTool.B)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"pgg-axc-j1o","isDefault":true,"name":"AWS EC2
      instance communicating with a cryptocurrency server"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Account Take Over (ATO) through brute force attempts\n\n### Strategy\nTo
      determine a successful attempt: Detect a high amount of failed logins and at
      least one successful login for a given user. This will generate a `HIGH` severity
      signal.\nTo determine an attempt: Detect a high amount of failed logins. This
      will generate an `INFO` severity signal.\n\n### Triage & Response\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated.\n3.
      If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058893314,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure @usr.name:*","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success @usr.name:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"failed_login
      > 50 && successful_login > 0"},{"status":"info","notifications":["@slack-secops"],"name":"Attempt","condition":"failed_login
      > 5"}],"type":"threshold","id":"wwr-wvh-thk","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By User"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:eventbridge"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting or disabling
      EventBridge rules.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is modifying or disabling EventBridge rules:\n\n*
      [DeleteRule][1]\n* [DisableRule][2]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html\n[2]:
      https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058894158,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteRule OR DisableRule)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"y1o-jar-ggn","isDefault":true,"name":"AWS EventBridge
      rule disabled or deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1066-indicator-removal-from-tools","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is removing FlowLogs to cover their tracks.\n\n###
      Strategy\nThis rule lets you monitor this CloudTrail API call to detect if an
      attacker is deleting FlowLogs:\n\n* [DeleteFlowLogs][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user to see if they intended to make this API call.\n3.
      If the user did not make the API call:\n * Rotate the credentials.\n * Investigate
      if the same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896109,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteFlowLogs","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hvo-2q8-ph8","isDefault":true,"name":"AWS FlowLogs
      removed"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ecs"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an ECS Cluster\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an ECS cluster is
      deleted:\n\n* [DeleteCluster][1]\n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_DeleteCluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058898709,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gum-7e6-atn","isDefault":true,"name":"AWS ECS
      cluster deleted"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the S3 Public Access Block configuration has been removed
      \n\n### Strategy\nThis rule lets you monitor this CloudTrail API call to detect
      if an attacker is deleting the S3 Public Access Block configuration:\n\n* [DeleteAccountPublicAccessBlock][1]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices of enabling Public Access
      Block on S3 buckets.\n3. Re-enable Public Access Block on the S3 bucket.\n\nMore
      details on S3 Public Block Public Access can be found [here][2].\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/s3api/delete-public-access-block.html\n[2]:
      https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058899365,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteAccountPublicAccessBlock","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xf9-dqq-un5","isDefault":true,"name":"AWS S3
      Public Access Block removed"},{"creationAuthorId":0,"tags":["security:threat-intel","source:gsuite","scope:gsuite"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user attempts to log in with a password which is known to
      be compromised.\n\n### Strategy\nThis rule allows you to monitor this Google
      Activity API call to detect if an attacker is trying to login with a leaked
      password: \n\n* [Leaked password][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the compromised password.\n2. Contact the
      user and ensure they rotate the password on Google and any other accounts where
      they may have reused this password. Ensure the user is aware of strong password
      guidelines.\n\n[1]: https://developers.google.com/admin-sdk/reports/v1/appendix/activity/login#account_disabled_password_leak","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900004,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@actor.email"],"query":"source:gsuite
      @event.type:account_warning @event.name:account_disabled_password_leak","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tyw-prf-p87","isDefault":true,"name":"User attempted
      login with leaked password"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.14","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a VPC.\n\n### Strategy\nThis rule
      lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a VPC:\n\n* [DeleteVpc][1]\n\n### Triage & Response\n1. Determine which user
      in your organization owns the API key that made this API call.\n2. Contact the
      user to see if they intended to make this API call.\n3. If the user did not
      make the API call:\n * Rotate the credentials.\n * Investigate if the same credentials
      made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058900634,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteVpc OR CreateVpc OR ModifyVpcAttribute OR AcceptVpcPeeringConnection
      OR CreateVpcPeeringConnection OR DeleteVpcPeeringConnection OR RejectVpcPeeringConnection
      OR  AttachClassicLinkVpc OR  DetachClassicLinkVpc OR DisableVpcClassicLink OR
      EnableVpcClassicLink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"plc-vtt-tgx","isDefault":true,"name":"AWS VPC
      created or modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an API call to AWS to list all of the
      S3 Buckets.\n\n### Strategy\nThis rule lets you monitor CloudTrail to detect
      a [ListBuckets][1] API call with the session name prefixed with `i-`. A session
      name prefixed with `i-` typically indicates that it is an EC2 instance using
      an [Instance Profile][2] to communicate with other AWS services, which is a
      common attacker technique to see the full list of S3 buckets in your AWS account.\n
      Determine if the EC2 instance should be making this API call. \n* If not, rotate
      the credentials, verify what else may have been accessed and open an investigation
      into how this instance was compromised.\n   * If the application or legitimate
      user on the EC2 instance is making the `ListBuckets` API call, consider whether
      this API call is really needed.  \n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901276,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @userIdentity.session_name:i-* @evt.name:ListBuckets","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zie-rjq-ybu","isDefault":true,"name":"AWS S3
      Buckets enumerated"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect AWS root user activity. \n\n### Strategy\nMonitor CloudTrail and
      detect when any `@userIdentity.type` has a value of `Root`, but is not invoked
      by an AWS service.\n\n### Triage & Response\n1. Reach out to the user to determine
      if the login was legitimate. \n2. If the login wasn''t legitimate, rotate the
      credentials, enable 2FA, and open an investigation. \n\nFor best practices,
      check out the [AWS Root Account Best Practices][1] documentation.\n\n[1]: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058902527,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:cloudtrail
      @userIdentity.type:Root  -@userIdentity.invokedBy:*  -@eventType:AwsServiceEvent","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xpb-09x-hhd","isDefault":true,"name":"AWS root
      account activity"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying an EC2 subnet.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      an EC2 subnet.\n\n* [DeleteSubnet][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-subnet.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903161,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteSubnet","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"i1m-xwg-zc5","isDefault":true,"name":"AWS EC2
      subnet deleted"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.9","source:cloudtrail","scope:amazon-config"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by disabling an AWS
      configuration.\n\n### Strategy\nThis rule lets you monitor these CloudTrail
      API calls to detect if an attacker is trying to stop recording configurations
      of your AWS resources or trying to delete a delivery channel:\n\n* [StopConfigurationRecorder][1]
      \n* [DeleteDeliveryChannel][2] \n\n### Triage & Response\n1. Determine which
      user in your organization owns the API key that made this API call.\n2. Contact
      the user to see if they intended to make this API call.\n3. If the user did
      not make the API call:\n * Rotate the credentials.\n * Investigate if the same
      credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html\n[2]:
      https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058903800,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel OR PutDeliveryChannel
      OR PutConfigurationRecorder)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"usf-ao1-oym","isDefault":true,"name":"AWS config
      modified"},{"creationAuthorId":0,"tags":["security:threat-intel","scope:template"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a stolen laptop has been connected to the network.\n\n###
      Strategy\nUsing the Datadog [Lookup Processor](https://docs.datadoghq.com/logs/processing/processors/?tab=ui#lookup-processor)
      you can maintain a blocklist of MAC addresses.\nWhen a MAC address connects
      to the network, the @threat.stolen_laptop attribute is set to `true`.\nThis
      threat detection rule queries for `@threat.stolen_laptop:true` and generates
      a security signal. \n\n### Triage & Response\nEnter your triage and response
      process for when a stolen laptop has connected to your network to help users
      responding to the security signal quickly triage and respond to the signal.
      \n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1585058904417,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.mac"],"query":"@threat.stolen_laptop:true
      @network.client.mac:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8b3-bw1-rnc","isDefault":true,"name":"TEMPLATE
      - Stolen Laptop Connected to Network"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect an account take over (ATO) through brute force attempts.\n\n###
      Strategy\nTo determine a successful attempt: Detect a high amount of failed
      logins and at least one successful login for a given IP address. This will generate
      a `HIGH` severity signal.\nTo determine an attempt: Detect a high amount of
      failed logins for a given IP address. This will generate an `INFO severity signal.\n\n###
      Triage & Response\n1. Inspect the logs to see if this was a valid login attempt.\n2.
      See if 2FA was authenticated.\n3. If the user was compromised, rotate user credentials.","options":{"evaluationWindow":300,"maxSignalDuration":7200,"keepAlive":3600},"version":3,"createdAt":1585058905610,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:failure","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.name"],"query":"@evt.name:authentication
      @evt.outcome:success","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@slack-secops"],"name":"Successful","condition":"a>5
      && b>0"},{"status":"info","notifications":[],"name":"Attempted","condition":"a>5"}],"type":"threshold","id":"deq-dom-scp","isDefault":true,"name":"TEMPLATE
      - Brute Force Attack Grouped By IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force","source:guardduty","scope:ec2"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect Brute Force Attacks\n\n### Strategy\nLeverage GuardDuty and detect
      when an attacker is performing a brute force attack. The following are GuardDuty
      findings trigger this signal:\n\n* [UnauthorizedAccess:EC2/SSHBruteForce][1]\n*
      [UnauthorizedAccess:EC2/RDPBruteForce][2]\n\n\n### Triage & Response\n1. Inspect
      the role of the EC2 instance in the attack. Find the role in the signal name
      - either `ACTOR` or `TARGET`.\n   * If you are the `TARGET` and the instance
      is available on the internet, expect to see IPs scanning your systems.\n   *
      If you are the `TARGET` and the instance is **not** available on the internet,
      this means a host on your internal network is scanning your EC2 instance. Open
      an investigation.\n   * If you are the `ACTOR`, this means that your instance
      is performing brute force attacks on other systems. Open an investigation.\n\n[1]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized9\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized10","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":17,"createdAt":1585058906864,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:ACTOR","trackType":"logs"},{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/SSHBruteForce OR UnauthorizedAccess\\:EC2\\/RDPBruteForce)
      @detail.service.resourceRole:TARGET","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"ACTOR","condition":"a
      > 0"},{"status":"info","notifications":[],"name":"TARGET","condition":"b > 0"}],"type":"threshold","id":"evn-apc-7xy","isDefault":true,"name":"AWS
      EC2 instance involved in brute force attack"},{"creationAuthorId":0,"tags":["security:compliance","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EBS encryption is disabled by default. \n\n### Strategy\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n\n* [DisableEbsEncryptionByDefault][1]\n\n### Triage & Response\n1.
      Determine which user in your organization owns the API key that made this API
      call.\n2. Contact the user and let them know that it is best practice to enable
      EBS encryption by default.\n3. Re-enable EBS encryption by default.\n\nFor more
      information about Amazon EBS Encryption, check out the [Amazon EBS Encryption][2]
      documentation.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058907473,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bml-muv-u0w","isDefault":true,"name":"AWS EBS
      default encryption disabled"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1485-data-destruction","source:cloudtrail","scope:rds"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is destroying a RDS Cluster.\n\n### Strategy\nThis
      rule lets you monitor this CloudTrail API call to detect if an attacker is deleting
      a RDS cluster:\n\n* [DeleteDBCluster][1]\n\n### Triage & Response\n1. Determine
      which user in your organization owns the API key that made this API call.\n2.
      Contact the user to see if they intended to make this API call.\n3. If the user
      did not make the API call:\n * Rotate the credentials.\n * Investigate if the
      same credentials made other unauthorized API calls.\n\n[1]: https://docs.aws.amazon.com/cli/latest/reference/rds/delete-db-cluster.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1584994648708,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDBCluster","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nim-dxo-pqh","isDefault":true,"name":"AWS RDS
      Cluster deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:cloudtrail","scope:guardduty"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an attacker is trying to evade defenses by deleting a GuardDuty
      detector.\n\n### Strategy\nThis rule lets you monitor this CloudTrail API call
      to detect if an attacker is deleting a GuardDuty Detector:\n\n* [DeleteDetector][1]\n\n###
      Triage & Response\n1. Determine which user in your organization owns the API
      key that made this API call.\n2. Contact the user to see if they intended to
      make this API call.\n3. If the user did not make the API call:\n * Rotate the
      credentials.\n * Investigate if the same credentials made other unauthorized
      API calls.\n\n[1]: https://docs.aws.amazon.com/guardduty/latest/ug/delete-detector.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585219239135,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DeleteDetector","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"3on-woc-kdq","isDefault":true,"name":"AWS GuardDuty
      detector deleted"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when an attacker is trying to evade defenses by disabling
      AWS Config.\\n\\n## **Strategy:**\\nMonitor CloudTrail and detect when AWS config
      is being disabled via the following API calls:\\n* [StopConfigurationRecorder](https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html)
      \\n* [DeleteDeliveryChannel](https://docs.aws.amazon.com/config/latest/APIReference/API_DeleteDeliveryChannel.html)
      \\n\\n## **Triage & Response:**\\n1. Determine who the user was who made this
      API call.\\n2. Contact the user and see if this was an API call which was made
      by the user.\\n3. If the API call was not made by the user:\\n * Rotate the
      user credentials and investigate what other API calls.\\n * Determine what other
      API calls the user made which were not made by the user.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1579013244994,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(StopConfigurationRecorder OR DeleteDeliveryChannel)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbw-ysr-vj0","isDefault":true,"name":"test test
      test"},{"creationAuthorId":0,"tags":["source:signal_sciences","scope:signal_sciences"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an IP is flagged by Signal Sciences.\n\n### Strategy\nThis
      rule lets you monitor Signal Sciences events submitted through the Signal Sciences
      [integration][1] to detect when an IP is flagged. \n\n### Triage & Response\n1.
      Determine whether the attack is a false positive.\n2. Determine whether the
      attack was successful.\n3. If the attack exploited a vulnerability in the application,
      triage the vulnerability.\n\n[1]: https://app.datadoghq.com/account/settings#integrations/sigsci","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1584464116420,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:signal_sciences
      @title:*flag","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"hhw-n3q-pq9","isDefault":true,"name":"Signal
      Sciences flagged an IP"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:aws"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when any user logs in to your AWS console without multi-factor
      authentication.\n\n### Strategy\nThis rule monitors CloudTrail and detects when
      any `@evt.name` has a value of  `Console Login`, and `@additionalEventData.MFAUsed`
      has a value of `no`. \n\n**Note:** This rule ignores logins using SAML because
      2FA is implemented on the IdP and not through AWS.\n\n### Triage & Response\n1.
      Reach out to the user to determine if the login was legitimate. \n2. If the
      login was legitimate, request that the user enables 2FA. \n3. If the login wasn''t
      legitimate, rotate the credentials. \n4. Review all user accounts to ensure
      MFA is enabled. \n\n**Note:** There is a separate rule to detect [Root Login
      without MFA][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-root-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058895478,"filters":[],"queries":[{"distinctFields":[],"name":"user_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      -@userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"user_login_without_mfa
      > 0"}],"type":"threshold","id":"jzy-cxc-ms2","isDefault":true,"name":"AWS Console
      login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect vulnerabilities in container images.\n\n### Strategy\nThis rule
      lets you monitor Twistlock logs to detect `Critical` severity vulnerabilities
      in a container image. \n\n### Triage & Response\n1. Determine the impact of
      this vulnerability.\n2. Update the container image in the registry with a patched
      version of the software.\n3. Deploy the new image to all containers running
      the vulnerable image.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058896752,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.cve","@vulnerability.package.name","@vulnerability.image_name"],"query":"source:twistlock
      @vulnerability.log_type:vulnerability @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9vt-nab-a2n","isDefault":true,"name":"Container
      image vulnerability detected"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.2","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a root user logs into the AWS console without multi-factor
      authentication.\n\n### Strategy\nMonitor CloudTrail and detect when any `@evt.name`
      has a value of `Console Login`, `@userIdentity.type` has a value of `Root`,
      and `@additionalEventData.MFAUsed` has a value of `no`. \n\n**Note:** This rule
      ignores logins using SAML because 2FA is implemented on the IdP and not through
      AWS.\n\n### Triage & Response\n1. Reach out to the user to determine if the
      login was legitimate. \n2. If the login was legitimate, request that the user
      enables 2FA on the root account. \n3. If the login wasn''t legitimate, rotate
      the credentials. \n4. Review all root user accounts to ensure MFA is enabled.
      \n\n**Note:** There is a separate rule to detect [Login without MFA for non-root
      users][1]. \n\n[1]: /security_monitoring/default_rules/cloudtrail-aws-login-without-mfa/","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1585058897422,"filters":[],"queries":[{"distinctFields":[],"name":"root_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @additionalEventData.MFAUsed:No @responseElements.ConsoleLogin:Success
      @userIdentity.type:Root -@additionalEventData.SamlProviderArn:*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"root_login_without_mfa
      > 0"}],"type":"threshold","id":"tqr-gr7-j2f","isDefault":true,"name":"AWS Console
      root login without MFA"},{"creationAuthorId":0,"tags":["source:twistlock"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a container is not running within compliance standards.\n\n###
      Strategy\nThis rule lets you monitor Twistlock logs to detect when `Critical`
      severity compliance issues are discovered in a running container. \n\n### Triage
      & Response\n1. Determine the impact of the compliance finding.\n2. Remediate
      the compliance finding.","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1585058901906,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@vulnerability.compliance_id","@vulnerability.container_name"],"query":"source:twistlock
      @vulnerability.log_type:compliance @vulnerability.severity:critical","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4td-afn-gcp","isDefault":true,"name":"Container
      violated compliance standards"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.7","source:cloudtrail","scope:kms"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a CMK is deleted or scheduled for deletion.\n\n### Strategy\nThis
      rule lets you monitor these CloudTrail API calls to detect if an attacker is
      deleting CMKs:\n* [DisableKey][1]\n* [ScheduleKeyDeletion][2]\n\n### Triage
      & Response\n1. Determine which user in your organization owns the API key that
      made this API call.\n2. Contact the user to see if they intended to make this
      API call.\n3. If the user did not make the API call:\n * Rotate the credentials.\n
      * Investigate if the same credentials made other unauthorized API calls.\n\n[1]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html\n[2]:
      https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html
      ","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":5,"createdAt":1586196604008,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DisableKey OR ScheduleKeyDeletion)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"xc3-a8q-aiq","isDefault":true,"name":"AWS CMK
      deleted or scheduled for deletion"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.8","source:cloudtrail","scope:s3"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a S3 Bucket policy is modified.\n\n### Strategy\nMonitor CloudTrail
      and detect when S3 policies are being modified via one of the following API
      calls:\n* [PutBucketAcl][1]\n* [PutBucketPolicy][2]\n* [PutBucketCors][3]\n*
      [PutBucketLifecycle][4]\n* [PutBucketReplication][5]\n* [DeleteBucketPolicy][6]\n*
      [DeleteBucketCors][7]\n* [DeleteBucketLifecycle][8]\n* [DeleteBucketReplication][9]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketAcl.html\n
      [2]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html\n
      [3]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketCors.html\n
      [4]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLifecycle.html\n
      [5]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html\n
      [6]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html\n
      [7]:  https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html\n
      [8]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html\n
      [9]: https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606187,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(PutBucketAcl OR PutBucketPolicy OR PutBucketCors OR PutBucketLifecycle
      OR PutBucketReplication OR DeleteBucketPolicy OR DeleteBucketCors OR DeleteBucketLifecycle
      OR DeleteBucketReplication)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"iqi-0vj-ud5","isDefault":true,"name":"AWS S3
      Bucket policy modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.11","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Access Control List (NACL) has been created
      or modified.\n\n### Strategy\nThis rule lets you monitor CloudTrail and detect
      when an AWS NACL has been created or modified with one of the following API
      calls:\n* [CreateNetworkAcl][1] \n* [CreateNetworkAclEntry][2] \n* [DeleteNetworkAcl][3]
      \n* [DeleteNetworkAclEntry][4] \n* [ReplaceNetworkAclEntry][5] \n* [ReplaceNetworkAclAssociation][6]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html\n[2]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html\n[3]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html\n[4]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html\n[5]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclEntry.html\n[6]:
      https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceNetworkAclAssociation.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196606343,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateNetworkAcl OR CreateNetworkAclEntry OR DeleteNetworkAcl OR
      DeleteNetworkAclEntry OR ReplaceNetworkAclEntry OR ReplaceNetworkAclAssociation)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"gii-kwt-7in","isDefault":true,"name":"AWS Network
      Access Control List created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.12","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Network Gateway has been created or modified.\n\n###
      Strategy\nMonitor CloudTrail and detect when an AWS Network Gateway has been
      created or modified with one of the following API calls:\n* [CreateCustomerGateway][1]
      \n* [DeleteCustomerGateway][2] \n* [AttachInternetGateway][3] \n* [CreateInternetGateway][4]\n*
      [DeleteInternetGateway][5] \n* [DetachInternetGateway][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateCustomerGateway
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteCustomerGateway
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AttachInternetGateway
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateInternetGateway
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteInternetGateway
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DetachInternetGateway.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196607314,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateCustomerGateway OR DeleteCustomerGateway OR AttachInternetGateway
      OR CreateInternetGateway OR DeleteInternetGateway OR DetachInternetGateway)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lfg-qnj-oxr","isDefault":true,"name":"AWS Network
      Gateway created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.6","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a user is a victim of an Account Take Over (ATO) by a brute
      force attack.\n\n### Strategy\n This rule monitors CloudTrail and detects when
      any `@evt.name` has a value of `Console Login`, and `@responseElements.ConsoleLogin`
      has a value of `Failure`.\n\n### Triage & Response\n1. Determine if the user
      logged in with 2FA.\n2. Reach out to the user and ensure the login was legitimate.","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196607801,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Failure","trackType":"logs"},{"distinctFields":[],"name":"successful_login_without_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:No","trackType":"logs"},{"distinctFields":[],"name":"successful_login_with_mfa","aggregation":"count","groupByFields":["@userIdentity.accountId","@usr.name"],"query":"source:cloudtrail
      @evt.name:ConsoleLogin @responseElements.ConsoleLogin:Success @additionalEventData.MFAUsed:Yes","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Potentially
      Successful - NO MFA","condition":"failed_login > 5 && successful_login_without_mfa
      > 0"},{"status":"info","notifications":[],"name":"Potentially Successful - MFA
      Used","condition":"failed_login > 5 && successful_login_with_mfa > 0"},{"status":"info","notifications":[],"name":"Unsuccessful","condition":"failed_login
      > 5"}],"type":"threshold","id":"ncf-eky-1i9","isDefault":true,"name":"AWS Console
      brute force login"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.13","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS Route Table has been created or modified.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail and detect when an AWS Route Table has been
      created or modified with one of the following API calls:\n* [CreateRoute][1]
      \n* [CreateRouteTable][2] \n* [ReplaceRoute][3] \n* [ReplaceRouteTableAssociation][4]
      \n* [DeleteRouteTable][5] \n* [DeleteRoute][6] \n* [DisassociateRouteTable][7]\n\n###
      Triage & Response\n1. Determine who the user was who made this API call.\n2.
      Contact the user and see if this was an API call which was made by the user.\n3.
      If the API call was not made by the user:\n   * Rotate the user credentials
      and investigate what other API calls.\n   * Determine what other API calls the
      user made which were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html
      \n [7]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608167,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(CreateRoute OR CreateRouteTable OR ReplaceRoute OR ReplaceRouteTableAssociation
      OR DeleteRouteTable OR DeleteRoute OR DisassociateRouteTable)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"5ly-pbe-y9x","isDefault":true,"name":"AWS Route
      Table created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.1","source:cloudtrail","scope:amazon"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity is detected in AWS.\n\n### Strategy\nThis
      rule lets you monitor CloudTrail to detect when the error message of `AccessDenied`
      is returned.\n\n### Triage & Response\n1. Determine which user in your organization
      owns the API key that made this API call.\n2. Contact the user to see if they
      intended to make this API call.\n3. If the user did not make the API call:\n
      * Rotate the credentials.\n * Investigate if the same credentials made other
      unauthorized API calls.\n","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608310,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      \"AccessDenied\"","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"rf2-pmp-qil","isDefault":true,"name":"AWS
      unauthorized activity"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.10","source:cloudtrail","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS security group has been modified.\n\n### Strategy\nMonitor
      CloudTrail and detect when an AWS security group has been created or modified
      with one of the following API calls:\n* [AuthorizeSecurityGroupIngress][1] \n*
      [AuthorizeSecurityGroupEgress][2] \n* [RevokeSecurityGroupIngress][3] \n* [RevokeSecurityGroupEgress][4]
      \n* [CreateSecurityGroup][5] \n* [DeleteSecurityGroup][6]\n\n### Triage & Response\n1.
      Determine who the user was who made this API call.\n2. Contact the user and
      see if this was an API call which was made by the user.\n3. If the API call
      was not made by the user:\n   * Rotate the user credentials and investigate
      what other API calls.\n   * Determine what other API calls the user made which
      were not made by the user.\n\n[1]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html
      \n [2]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html
      \n [3]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupIngress.html
      \n [4]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RevokeSecurityGroupEgress.html
      \n [5]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSecurityGroup.html
      \n [6]: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteSecurityGroup.html","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1586196608633,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(AuthorizeSecurityGroupIngress OR AuthorizeSecurityGroupEgress OR
      RevokeSecurityGroupIngress OR RevokeSecurityGroupEgress OR CreateSecurityGroup
      OR DeleteSecurityGroup)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"okf-rlw-vay","isDefault":true,"name":"AWS security
      group created or modified"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.4","source:cloudtrail","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to an AWS IAM Policy.\n\n### Strategy\nThis rule lets
      you monitor CloudTrail and detect when any event pertaining to an AWS IAM policy
      is detected with one of the following API calls:\n* [DeleteGroupPolicy][1]\n*
      [DeleteRolePolicy](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteRolePolicy.html)\n*
      [DeleteUserPolicy][2]\n* [PutGroupPolicy][3]\n* [PutRolePolicy]\n* [PutUserPolicy][5]\n*
      [CreatePolicy]\n* [DeletePolicy][7]\n* [CreatePolicyVersion][8]\n* [DeletePolicyVersion][9]\n*
      [AttachRolePolicy][10]\n* [DetachRolePolicy][11]\n* [AttachUserPolicy][12]\n*
      [DetachUserPolicy][13]\n* [AttachGroupPolicy][14]\n* [DetachGroupPolicy][15]\n\n###
      Triage & Response\n1. Review the IAM Policy change and ensure it does not negatively
      impact your risk in relation to authentication or authorization controls.\n\n[1]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroupPolicy.html\n[2]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteUserPolicy.html\n[3]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutGroupPolicy.html\n[4]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutRolePolicy.html\n[5]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_PutUserPolicy.html\n[6]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicy.html\n[7]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicy.html\n[8]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreatePolicyVersion.html\n[9]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeletePolicyVersion.html\n[10]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html\n[11]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachRolePolicy.html\n[12]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html\n[13]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachUserPolicy.html\n[14]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html\n[15]:
      https://docs.aws.amazon.com/IAM/latest/APIReference/API_DetachGroupPolicy.html","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1586196608971,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteGroupPolicy OR DeleteRolePolicy OR DeleteUserPolicy OR PutGroupPolicy
      OR PutRolePolicy OR PutUserPolicy OR CreatePolicy OR DeletePolicy OR CreatePolicyVersion
      OR DeletePolicyVersion OR AttachRolePolicy OR DetachRolePolicy OR AttachUserPolicy
      OR DetachUserPolicy OR AttachGroupPolicy OR DetachGroupPolicy)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"55q-nmv-pl6","isDefault":true,"name":"AWS IAM
      policy changed"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP logging sink has been made. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when any of the following methods are invoked:\n\n*
      `google.logging.v2.ConfigServiceV2.UpdateSink`\n* `google.logging.v2.ConfigServiceV2.DeleteSink`\n\n###
      Triage & Response\n1. Review the sink and ensure the sink is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205178345,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.project
      @evt.name:(google.logging.v2.ConfigServiceV2.UpdateSink OR google.logging.v2.ConfigServiceV2.DeleteSink)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"qgx-1b0-3of","isDefault":true,"name":"GCP logging
      sink modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a VPC network is created. \n\n### Strategy\nThis rule lets
      you monitor GCP GCE activity audit logs to determine when the following method
      is invoked to create a new VPC network:\n\n* `beta.compute.networks.insert`\n\n###
      Triage & Response\n1. Review the VPC network.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205179774,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name:beta.compute.networks.insert","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wqf-won-och","isDefault":true,"name":"GCP GCE
      VPC network modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account key is created.  An attacker could use
      this key as a backdoor to your account. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to detect the creation of a service account
      key. \n\n### Triage & Response\n1. Contact the user who created the service
      account key to ensure they''re managing the key securely.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205180248,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccountKey","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"uar-mlj-m8c","isDefault":true,"name":"GCP service
      account key created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when permissions have changed on a GCS Bucket.\n\n### Strategy\nMonitor
      GCS bucket admin activity audit logs to determine the following method is invoked:\n\n*
      `storage.setIamPermissions`\n\n### Triage & Response\n1. Review the bucket permissions
      and ensure they are not overly permissive.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205181966,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.setIamPermissions","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dxh-roh-3ox","isDefault":true,"name":"GCP Bucket
      permissions modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.firewall.rule","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created, modified or deleted. \n\n### Strategy\nMonitor
      GCP GCE activity audit logs to determine when any of the following methods are
      invoked:\n\n* `v1.compute.firewalls.delete`\n* `v1.compute.firewalls.insert`\n*
      `v1.compute.firewalls.patch` \n\n### Triage & Response\n1. Review the log and
      role and ensure the permissions are scoped properly.\n2. Review the users associated
      with the role and ensure they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182471,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceOriginalState.name","@usr.id"],"query":"source:gcp.gce.firewall.rule
      @evt.name:(v1.compute.firewalls.delete OR v1.compute.firewalls.insert OR v1.compute.firewalls.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"su0-y8i-jum","isDefault":true,"name":"GCP GCE
      Firewall rule modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.project","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect a change to the IAM policy. \n\n### Strategy\nThis rule lets you
      monitor GCP admin activity audit logs to determine when the `SetIamPolicy` method
      is invoked. \n\n### Triage & Response\n1. Review the log and inspect the policy
      deltas (`@data.protoPayload.serviceData.policyDelta.bindingDeltas`) and ensure
      none of the actions are `REMOVE`.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205182963,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.project
      @evt.name:SetIamPolicy","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nmz-rvc-eq0","isDefault":true,"name":"GCP IAM
      policy modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.service.account","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a new service account is created.\n\n### Strategy\nThis rule
      lets you monitor GCP admin activity audit logs to determine when a service account
      is created. \n\n### Triage & Response\n1. Contact the user who created the service
      account and ensure that the account is needed and that the role is scoped properly.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205184542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.service.account
      @evt.name:google.iam.admin.v1.CreateServiceAccount","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yab-fsz-bka","isDefault":true,"name":"GCP service
      account created"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.iam.role","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a custom role is created or modified. \n\n### Strategy\nMonitor
      GCP IAM activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.iam.admin.v1.CreateRole`\n* `google.iam.admin.v1.UpdateRole`
      \n\n### Triage & Response\n1. Review the log and role and ensure the permissions
      are scoped properly.\n2. Review the users associated with the role and ensure
      they should have the permissions attached to the role.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185432,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.iam.role
      @evt.name:(google.iam.admin.v1.CreateRole OR google.iam.admin.v1.UpdateRole)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yuj-ux7-yak","isDefault":true,"name":"GCP IAM
      custom role created or modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.cloudsql.database","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a Cloud SQL DB has been modified.\n\n### Strategy\nThis rule
      lets you monitor GCP Cloud SQL admin activity audit logs to determine when one
      of the following methods are invoked:\n\n* `cloudsql.instances.create`\n* `cloudsql.instances.create`\n*
      `cloudsql.users.update`\n\n### Triage & Response\n1. Review the Cloud SQL DB
      and ensure it is configured properly with the correct permissions.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185720,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","database_id","@usr.id"],"query":"source:gcp.cloudsql.database
      @evt.name:(cloudsql.instances.create OR cloudsql.instances.create OR cloudsql.users.create
      OR cloudsql.users.update)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"h0t-bsz-nop","isDefault":true,"name":"GCP Cloud
      SQL database modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gce.route","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a firewall rule is created or modified. \n\n### Strategy\nThis
      rule lets you monitor GCP GCE activity audit logs to determine if a firewall
      is being adjusted by showing you when any of the following methods are invoked:\n\n*
      `beta.compute.routes.insert`\n* `beta.compute.routes.patch`\n\n### Triage &
      Response\n1. Veirify that the GCP route is configured properly and that the
      user intended to modify the firewall.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205185981,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","@data.protoPayload.resourceName","@usr.id"],"query":"source:gcp.gce.route
      @evt.name(beta.compute.routes.insert OR beta.compute.routes.patch)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"wys-hsj-xqu","isDefault":true,"name":"GCP GCE
      network route created or modified"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when there is unauthorized activity by a service account in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a service account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the service
      account did not have permission to make the API call.\n\n### Triage & Response\n1.
      Determine the service account that made the unauthorized calls.\n2. Investigate
      if there is a misconfiguration in IAM permissions or if an attacker compromised
      the service account","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205297459,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 @usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"w7v-qb1-f4b","isDefault":true,"name":"GCP
      unauthorized service account activity"},{"creationAuthorId":0,"tags":["source:gcp","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when unauthorized activity by a user is detected in GCP\n\n###
      Strategy\nMonitor GCP logs and detect when a user account makes an API request
      and the request returns the status code equal to `7` within the log attribute
      `@data.protoPayload.status.code`. The status code `7` indicates the user account
      did not have permission to make the API call.\n\n### Triage & Response\n1. Determine
      the user who made the unauthorized calls.\n2. Determine if there is a misconfiguration
      in IAM permissions or whether an attacker has compromised the user account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205298392,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id"],"query":"source:gcp.*
      @data.protoPayload.status.code:7 -@usr.id:(*gserviceaccount.com OR *google.com)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"greater
      than 1000 failed attempts","condition":"a > 1000"},{"status":"medium","notifications":[],"name":"greater
      than 100 failed attempts","condition":"a > 100"},{"status":"low","notifications":[],"name":"greater
      than 10 failed attempts","condition":"a > 10"}],"type":"threshold","id":"kry-sy9-gi8","isDefault":true,"name":"GCP
      unauthorized user activity"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:attack","tactic:TA0007-discovery","technique:T1083-file-and-directory-discovery"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a service account lists out GCS Buckets.\n\n### Strategy\nThis
      rule lets you monitor GCS bucket admin activity audit logs to determine when
      a service account invokes the following method:\n\n* `storage.buckets.list`\n\n###
      Triage & Response\n1. Determine whether this service account should be making
      list bucket calls.\n * If the account was compromised, secure the account and
      investigate how it was compromised and if the account made other unauthorized
      calls.\n * If the owner of the service account intended to make the `ListBuckets`
      API call, consider whether this API call is needed. It could cause a security
      issue for the application to know the name of the bucket it needs to access.
      If it''s not needed, modify this rule''s filter to stop generating signals for
      this specific service account.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205301197,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.list @usr.id:*gserviceaccount.com","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"p7u-f3v-lh8","isDefault":true,"name":"GCP Bucket
      enumerated"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.gcs.bucket","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an administrative change to a GCS Bucket has been made. This
      could change the retention policy or bucket lock. For more information, see
      the [GCS Bucket Lock docs][1].\n\n### Strategy\nThis rule lets you monitor GCS
      bucket admin activity audit logs to determine if a bucket has been updated with
      the following method:\n\n* `storage.buckets.update`\n\n### Triage & Response\n1.
      Review the bucket to ensure that it is properly configured.\n\n[1]: https://cloud.google.com/storage/docs/bucket-lock","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586205336776,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["project_id","bucket_name","@usr.id"],"query":"source:gcp.gcs.bucket
      @evt.name:storage.buckets.update","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4zu-nwa-6pd","isDefault":true,"name":"GCP Bucket
      modified"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.topic","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a GCP Pub/Sub Subscribtion has been deleted. This could stop
      audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP admin activity
      audit logs to determine when the following method is invoked:\n\n* `google.pubsub.v1.Publisher.DeleteTopic`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207537027,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.topic
      @evt.name:google.pubsub.v1.Publisher.DeleteTopic","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ah-pzb-d1g","isDefault":true,"name":"GCP Pub/Sub
      topic deleted"},{"creationAuthorId":0,"tags":["source:gcp","scope:gcp.pubsub.subscription","security:compliance"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a change to a GCP Pub/Sub Subscription has been made. This
      could stop audit logs from being sent to Datadog.\n\n### Strategy\nMonitor GCP
      admin activity audit logs to determine when any of the following methods are
      invoked:\n\n* `google.pubsub.v1.Subscriber.UpdateSubscription`\n* `google.pubsub.v1.Subscriber.DeleteSubscription`\n\n###
      Triage & Response\n1. Review the subscribtion and ensure it is properly configured.","options":{"evaluationWindow":300,"maxSignalDuration":300,"keepAlive":300},"version":4,"createdAt":1586207539465,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@usr.id","@data.protoPayload.resourceName"],"query":"source:gcp.pubsub.subscription
      @evt.name:(google.pubsub.v1.Subscriber.UpdateSubscription OR google.pubsub.v1.Subscriber.DeleteSubscription)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"dav-jyh-q2g","isDefault":true,"name":"GCP Pub/Sub
      Subscriber modified"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is conducting a port scan.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Recon:EC2/Portscan][2]\n\n\n###
      Triage & Response\n1. Determine why traffic from the EC2 instance appears to
      be conducting a port scan.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n \n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524594934,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/Portscan)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"bex-kcr-4qq","isDefault":true,"name":"AWS EC2
      instance conducting a port scan"},{"creationAuthorId":0,"tags":["security:compliance","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user disables [S3 Block Public Access][1]\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][2] finding:\n\n*
      [Policy:IAMUser/S3BlockPublicAccessDisabled][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Contact the user and determine why the user disabled the S3 Block Access feature.   \n3.
      Re-enable S3 Block Public Access.\n\n[1]: https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html\n[2]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[3]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524595668,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/S3BlockPublicAccessDisabled)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"myo-ahr-nug","isDefault":true,"name":"AWS IAM
      user disabled S3 Block Public Access"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests from a malicious IP.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Recon:IAMUser/TorIPCaller][2]\n* [Recon:IAMUser/MaliciousIPCaller.Custom][3]\n*
      [Recon:IAMUser/MaliciousIPCaller][4]\n* [UnauthorizedAccess:IAMUser/MaliciousIPCaller][5]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][6]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524597386,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Recon\\:IAMUser\\/TorIPCaller OR Recon\\:IAMUser\\/MaliciousIPCaller.Custom
      OR Recon\\:IAMUser\\/MaliciousIPCaller OR UnauthorizedAccess\\:IAMUser\\/MaliciousIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"mwe-n2l-0gm","isDefault":true,"name":"AWS IAM
      user requests from malicious IP"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0007-discovery","technique:T1046-network-service-scanning","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being probed by a scanner.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [Recon:EC2/PortProbeUnprotectedPort][2]\n*
      [Recon:EC2/PortProbeEMRUnprotectedPort][3]\n\n\n### Triage & Response\n1. This
      is typically an informative signal. However, if this instance should not be
      publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#recon6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_recon.html#PortProbeEMRUnprotectedPort\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598073,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Recon\\:EC2\\/PortProbeUnprotectedPort OR Recon\\:EC2\\/PortProbeEMRUnprotectedPort)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ihv-sib-l1g","isDefault":true,"name":"AWS EC2
      instance probed by scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0011-command-and-control","technique:T1188-multi-hop-proxy","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorClient][2]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance should be making requests to TOR. \n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized13\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524598542,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorClient)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ek3-lfc-xfi","isDefault":true,"name":"AWS EC2
      instance outbound connections to TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is launching compute resources and has no
      prior history of invoking this API.\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [ResourceConsumption:IAMUser/ComputeResources][2]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_resource.html#resourceconsumption\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599205,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(ResourceConsumption\\:IAMUser\\/ComputeResources)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nxq-1ua-7aj","isDefault":true,"name":"AWS IAM
      user anomalous resource consumption"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance receives an inbound network connection from
      TOR.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty integration][1]
      finding:\n\n* [UnauthorizedAccess:EC2/TorIPCaller][2]\n\n\n### Triage & Response\n1.
      This is typically an informative signal. However, if this instance should not
      be publicly available, you should review the security group for this instance.
      \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized7\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599442,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorIPCaller)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"jn5-oee-6a1","isDefault":true,"name":"AWS EC2
      instance inbound connections from TOR"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is participating in a Denial of Service (DoS)
      attack.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Backdoor:EC2/DenialOfService.Tcp][2]\n* [Backdoor:EC2/DenialOfService.Udp][3]\n*
      [Backdoor:EC2/DenialOfService.Dns][4]\n* [Backdoor:EC2/DenialOfService.UdpOnTcpPorts][5]\n*
      [Backdoor:EC2/DenialOfService.UnusualProtocol][6]\n\n\n### Triage & Response\n1.
      Determine if the EC2 instance is compromised and participating in a DoS attack.\n2.
      If the instance is compromised:\n   * Review the AWS [documentation][7] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor8\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor9\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor10\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor11\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor12\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524599875,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/DenialOfService.Tcp OR Backdoor\\:EC2\\/DenialOfService.Udp
      OR Backdoor\\:EC2\\/DenialOfService.Dns OR Backdoor\\:EC2\\/DenialOfService.UdpOnTcpPorts
      OR Backdoor\\:EC2\\/DenialOfService.UnusualProtocol)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"zos-gkd-q3u","isDefault":true,"name":"AWS EC2
      instance participating in a DoS attack"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0005-defense-evasion","technique:T1089-disabling-security-tools","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is changing sensitive configurations and has
      no prior history of invoking these APIs.\n\n### Strategy\nThis rule lets you
      monitor these [GuardDuty integration][1] findings:\n\n* [Stealth:IAMUser/S3ServerAccessLoggingDisabled][2]\n*
      [Stealth:IAMUser/PasswordPolicyChange][3]\n* [Stealth:IAMUser/CloudTrailLoggingDisabled][4]\n*
      [Stealth:IAMUser/LoggingConfigurationModified][5]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][6] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth1\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth2\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_stealth.html#stealth3\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524600798,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Stealth\\:IAMUser\\/S3ServerAccessLoggingDisabled OR Stealth\\:IAMUser\\/PasswordPolicyChange
      OR Stealth\\:IAMUser\\/CloudTrailLoggingDisabled OR Stealth\\:IAMUser\\/LoggingConfigurationModified)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"8bk-f1j-nwb","isDefault":true,"name":"AWS IAM
      user changing sensitive configurations"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is compromised and sending spam emails.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Backdoor:EC2/Spambot][2]\n\n\n### Triage & Response\n1. Determine if the EC2
      should be sending out email over port 25. \n2. If the instance is compromised:\n   *
      Review the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601247,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Backdoor\\:EC2\\/Spambot)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"x0r-aks-npm","isDefault":true,"name":"AWS EC2
      instance Sending spam emails"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0003-persistence","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to gain persistence within an
      AWS account.\n\n### Strategy\nThis rule lets you monitor these [GuardDuty integration][1]
      findings:\n\n* [Persistence:IAMUser/NetworkPermissions][2]\n* [Persistence:IAMUser/ResourcePermissions][3]\n*
      [Persistence:IAMUser/UserPermissions][4]\n\n\n### Triage & Response\n1. Determine
      which user triggered the signal. This can be found in the signal.\n2. Determine
      if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][5] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_persistence.html#persistence3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524601694,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(Persistence\\:IAMUser\\/NetworkPermissions OR Persistence\\:IAMUser\\/ResourcePermissions
      OR Persistence\\:IAMUser\\/UserPermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kgf-2db-crd","isDefault":true,"name":"AWS IAM
      user attempting to gain persistence"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0040-impact","technique:T1496-resource-hijacking","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is being used as a TOR relay.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/TorRelay][2]\n\n\n###
      Triage & Response\n1. Determine if the EC2 instance should be uses as a TOR
      relay. \n2. If the instance is compromised:\n   * Review the AWS [documentation][3]
      on remediating a compromised EC2 instance. \n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized14\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602580,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/TorRelay)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nsb-0hq-cl4","isDefault":true,"name":"AWS EC2
      instance connecting to TOR as a relay"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user login is suspicious.\n\n### Strategy\nThis
      rule lets you monitor these [GuardDuty integration][1] findings:\n\n* [UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B][2]\n*
      [UnauthorizedAccess:IAMUser/ConsoleLogin][3]\n\n\n### Triage & Response\n1.
      Determine which user triggered the signal. This can be found in the signal.\n2.
      Determine if the user''s credentials are compromised.  \n3. If the user''s credentials
      are compromised:\n  * Review the AWS [documentation][4] on remediating compromised
      AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized12\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524602836,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/ConsoleLoginSuccess.B OR UnauthorizedAccess\\:IAMUser\\/ConsoleLogin)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cfl-udf-vvn","isDefault":true,"name":"AWS IAM
      user suspicious login"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes an outbound network connection to a
      malcious IP address.\n\n### Strategy\nThis rule lets you monitor this [GuardDuty
      integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MaliciousIPCaller.Custom][2]\n\n\n###
      Triage & Response\n1. Determine which IP address triggered the signal. This
      can be found in the sample.\n2. If the instance is compromised:\n   * Review
      the AWS [documentation][3] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized5\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524603816,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MaliciousIPCaller.Custom)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ciu-8qy-gsa","isDefault":true,"name":"AWS EC2
      instance communicating with malicious IP"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating over an unusual port.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/NetworkPortUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior3\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524605686,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/NetworkPortUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"74n-f6h-ihy","isDefault":true,"name":"AWS EC2
      instance communicating over unusual port"},{"creationAuthorId":0,"tags":["source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user makes API requests with hacking tools.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [PenTest:IAMUser/KaliLinux][2]\n* [PenTest:IAMUser/ParrotLinux][3]\n* [PenTest:IAMUser/PentooLinux][4]\n\n\n###
      Triage & Response\n1. Determine which user triggered the signal. This can be
      found in the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][5]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest2\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_pentest.html#pentest3\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606570,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PenTest\\:IAMUser\\/KaliLinux OR PenTest\\:IAMUser\\/ParrotLinux
      OR PenTest\\:IAMUser\\/PentooLinux)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"lp6-ffe-qr9","isDefault":true,"name":"AWS IAM
      user making API requests with hacking tools"},{"creationAuthorId":0,"tags":["security:attack","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance is communicating with a malicious server.\n\n###
      Strategy\nThis rule lets you monitor these [GuardDuty integration][1] findings:\n\n*
      [Backdoor:EC2/C&CActivity.B!DNS][2]\n* [Trojan:EC2/BlackholeTraffic][3]\n* [Trojan:EC2/DropPoint][4]\n*
      [Trojan:EC2/BlackholeTraffic!DNS][5]\n* [Trojan:EC2/DriveBySourceTraffic!DNS][6]\n*
      [Trojan:EC2/DropPoint!DNS][7]\n* [Trojan:EC2/DGADomainRequest.B][8]\n* [Trojan:EC2/DGADomainRequest.C!DNS][9]\n*
      [Trojan:EC2/DNSDataExfiltration][10]\n* [Trojan:EC2/PhishingDomainRequest!DNS][11]\n\n\n###
      Triage & Response\n1. Determine which domain name or IP address triggered the
      signal. This can be found in the samples.\n2. If the instance is compromised:\n   *
      Review the AWS [documentation][12] on remediating a compromised EC2 instance.\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_backdoor.html#backdoor6\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan4\n[4]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan5\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan6\n[6]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan7\n[7]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan8\n[8]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan9\n[9]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan95\n[10]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan10\n[11]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_trojan.html#trojan11\n[12]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524606780,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Trojan\\:EC2\\/BlackholeTraffic OR Trojan\\:EC2\\/DropPoint OR Trojan\\:EC2\\/BlackholeTraffic\\!DNS
      OR Trojan\\:EC2\\/DriveBySourceTraffic\\!DNS OR Trojan\\:EC2\\/DropPoint\\!DNS
      OR Trojan\\:EC2\\/DGADomainRequest.B OR Trojan\\:EC2\\/DGADomainRequest.C\\!DNS
      OR Backdoor\\:EC2\\/C&CActivity.B\\!DNS OR Trojan\\:EC2\\/PhishingDomainRequest\\!DNS)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"4nc-chp-w7r","isDefault":true,"name":"AWS EC2
      instance communicated with a malicious server"},{"creationAuthorId":0,"tags":["security:compliance","framework:cis-aws","control:cis-3.3","control:cis-1.1","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when the AWS root user credentials are used.\n\n### Strategy\nThis
      rule lets you monitor this [GuardDuty integration][1] finding:\n\n* [Policy:IAMUser/RootCredentialUsage][2]\n\n\n###
      Triage & Response\n1. Determine whether the root account activity was legitimate.
      \n * Review the sample for context. \n * Review CloudTrail logs for a full investigation.
      \n3. If the root user''s credentials are compromised:\n * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n**[Root Account Best Practices][4]**\n\n[1]:
      https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_policy.html#policy1\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n[4]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607023,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:guardduty
      @evt.name:(Policy\\:IAMUser\\/RootCredentialUsage)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"low","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"1ta-ruh-vf1","isDefault":true,"name":"AWS Root
      credential activity"},{"creationAuthorId":0,"tags":["security:anomaly","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance network traffic volume is unusual.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [Behavior:EC2/TrafficVolumeUnusual][2]\n\n\n### Triage & Response\n1. Determine
      which port triggered the signal. This can be found in the samples.\n2. If the
      instance is compromised:\n   * Review the AWS [documentation][3] on remediating
      a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_behavior.html#behavior4\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524607258,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(Behavior\\:EC2\\/TrafficVolumeUnusual)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"ppc-pz9-m0y","isDefault":true,"name":"AWS EC2
      instance network traffic volume unusual"},{"creationAuthorId":0,"tags":["security:threat-intel","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS API call is made from a non EC2 IP for a credential
      which is scoped to an EC2 Instance.  \n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration][2]\n\n\n###
      Triage & Response\n1. Determine the EC2 instance this credential is scoped to.
      This can be found in the samples. \n2. Determine if the EC2 instance credentials
      are compromised.  \n3. If the instance is compromised:\n   * Review the AWS
      [documentation][3] on remediating a compromised EC2 instance.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#unauthorized11\n[3]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-ec2\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524648558,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:IAMUser\\/InstanceCredentialExfiltration)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"veb-jpj-1fv","isDefault":true,"name":"AWS EC2
      instance credential exfiltrated"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0004-privilege-escalation","source:guardduty","scope:iam"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an AWS IAM user is attempting to escalate permissions.\n\n###
      Strategy\nThis rule lets you monitor this [GuardDuty integration][1] finding:\n\n*
      [PrivilegeEscalation:IAMUser/AdministrativePermissions][2]\n\n\n### Triage &
      Response\n1. Determine which user triggered the signal. This can be found in
      the signal.\n2. Determine if the user''s credentials are compromised.  \n3.
      If the user''s credentials are compromised:\n  * Review the AWS [documentation][3]
      on remediating compromised AWS credentials.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_privilegeescalation.html#privilegeescalation1\n[5]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_remediate.html#compromised-creds\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524652630,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@detail.resource.accessKeyDetails.userName"],"query":"source:guardduty
      @evt.name:(PrivilegeEscalation\\:IAMUser\\/AdministrativePermissions)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"tkr-nvc-x3u","isDefault":true,"name":"AWS IAM
      user escalating privileges"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1522-cloud-instance-metadata-api","source:guardduty","scope:ec2"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when an EC2 instance makes a DNS request and resolves to the AWS
      metadata IP address (169.254.169.254).\n\n### Strategy\nThis rule lets you monitor
      this [GuardDuty integration][1] finding:\n\n* [UnauthorizedAccess:EC2/MetadataDNSRebind][2]\n\n\n###
      Triage & Response\n1. Determine which process made the DNS request. The DNS
      request can be found in the samples.\n2. Ensure the process is not a victim
      of an SSRF attack to steal the AWS EC2 Instance profile''s STS credentials.  \n2.
      If the STS credentials are compromised:\n   * Review the AWS [documentation][3]
      on revoking the session.\n\n[1]: https://docs.datadoghq.com/integrations/amazon_guardduty/\n[2]:
      https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_unauthorized.html#ec2-metadatadnsrebind\n[3]:
      https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587524685843,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["instance-id"],"query":"source:guardduty
      @evt.name:(UnauthorizedAccess\\:EC2\\/MetadataDNSRebind)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"scc-cjb-wi3","isDefault":true,"name":"AWS EC2
      Instance Victim to Metadata DNS Rebind Attack"},{"creationAuthorId":0,"tags":[],"isEnabled":false,"hasExtendedTitle":true,"message":"test
      staging rule","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587543386976,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:(DeleteTrail OR UpdateTrail OR StopLogging)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"7vy-r7g-pwy","isDefault":true,"name":"Staged
      Test"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:apache","scope:apache"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733579122,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:apache
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"nwm-rt2-fus","isDefault":true,"name":"Apache
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx-ingress-controller","scope:nginx-ingress-controller"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733581879,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx-ingress-controller
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"w55-j9n-k0p","isDefault":true,"name":"NGINX
      ingress controller HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:elb","scope:elb"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous User Agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an INFO signal.  \n\n### Triage and Response\n1. Determine if this
      IP is making authenticated requests to the application.\n2. If the IP is making
      authenticated requests to the application:\n * Investigate the HTTP logs and
      determine if the user is attacking your application.\n\nThe HTTP headers in
      the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733593867,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:elb
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"vvn-mwu-mt2","isDefault":true,"name":"AWS ELB
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:fastly","scope:fastly"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This identifies attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2]. \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603017,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:fastly
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"yrp-piw-ary","isDefault":true,"name":"Fastly
      HTTP Requests from Security Scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:nginx","scope:nginx"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1587733603665,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:nginx
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"cbx-4ze-zzn","isDefault":true,"name":"NGINX
      HTTP requests from security scanner"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0001-initial-access","technique:T1190-exploit-public-facing-application","source:iis","scope:iis"],"isEnabled":false,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a web application is being scanned. This will identify attacker
      IP addresses who are not trying to hide their attempt to attack your system.
      More advanced hackers will use an inconspicuous user agent. \n\n### Strategy\nInspect
      the user agent in the HTTP headers to determine if an IP is scanning your application
      and generate an `INFO` signal. \n\n### Triage and Response\n1. Determine if
      this IP is making authenticated requests to the application.\n2. If the IP is
      making authenticated requests to the application:\n * Investigate the HTTP logs
      and determine if the user is attacking your application.\n\nThe HTTP headers
      in the query are from [darkqusar][1]''s [gist][2] \n\n[1]: https://gist.github.com/darkquasar\n[2]:
      https://gist.github.com/darkquasar/84fb2cec6cc1668795bd97c02302d380\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1588695211431,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:iis
      @http.useragent:(*burp* OR *burpcollaborator.net* OR *qualys* OR *nexpose* OR
      *OpenVAS* OR *Nikto* OR *Meterpreter* OR *IceWeasel* OR *DirB* OR *Comodo* OR
      *Tripwire* OR *Retina* OR *MBSA* OR *ImmuniWeb* OR *Netsparker* OR *Acunetix*
      OR *Intruder* OR *nmap* OR *CVE* OR *base64* OR *eval* OR *javascript* OR *alert*)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"kww-dtj-4yd","isDefault":true,"name":"IIS HTTP
      requests from security scanner"},{"creationAuthorId":0,"tags":["test:test"],"isEnabled":false,"hasExtendedTitle":true,"message":"moo","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":4,"createdAt":1589966425792,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"source:undefined","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"blop","condition":"a
      > 0"}],"type":"threshold","id":"41l-5j8-qef","isDefault":true,"name":"test staged
      rule"},{"creationAuthorId":0,"tags":["security:compliance","control:blabla","framework:dsadsad"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when EBS encryption is disabled by default \n\n## **Strategy:**\nMonitor
      CloudTrail and detect when EBS encryption is disabled by default via the following
      API call:\n* [DisableEbsEncryptionByDefault](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html)\n\n##
      **Triage & Response:**\n1. Determine who the user was who made this API call.\n2.
      Contact the user and inform them of best practices to enable EBS encryption
      by default.\n3. Re-enable EBS encryption by default.\n\nMore details on Amazon
      EBS Encryption can be found [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html).","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":3,"createdAt":1590491153677,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":["@userIdentity.arn"],"query":"source:cloudtrail
      @evt.name:DisableEbsEncryptionByDefault","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 2"}],"type":"threshold","id":"cem-v7j-fcx","isDefault":true,"name":"AWS EBS
      Default Encryption Disabled test 5"},{"creationAuthorId":0,"tags":["source:synthetics"],"isEnabled":false,"hasExtendedTitle":true,"message":"This
      is a Default Rule","options":{"evaluationWindow":900,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596641034323,"filters":[],"queries":[{"distinctFields":[],"name":"","aggregation":"count","groupByFields":[],"query":"*","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"info","notifications":[],"name":"","condition":"a
      > 3"}],"type":"threshold","id":"9u4-qsd-eve","isDefault":true,"name":"Test default
      rule"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect log ins from the same user from multiple countries within
      a short time frame.\n\n## **Strategy:**\nUtilize geo-ip data to detect when
      a user logs in from two IP addresses which are in different countries within
      a short time frame.\n\n## **Triage & Response:**\n1. See if 2FA was used for
      authentication.\n2. Contact the user and see if this behavior is expected.\n3.
      If the user was compromised, rotate the user credentials.\n","options":{"evaluationWindow":3600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725043098,"filters":[],"queries":[{"distinctFields":["@network.client.geoip.country.name"],"name":"successful_logins_by_country","aggregation":"cardinality","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"successful_logins_by_country
      > 1"}],"type":"threshold","id":"khw-l2t-wjz","isDefault":true,"name":"Auth0
      user authenticating from multiple countries"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0001-initial-access","technique:T1078-valid-accounts"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect when a user logs in with a breached password.\n\n## **Strategy:**\nAuth0
      logs an event when a user logs in with a breached password. When this event
      is detected, Datadog generates a `MEDIUM` severity Security Signal.\n\nYou can
      see more information on how Auth0 detects breached passwords on their [documentation][1].\n\n##
      **Triage & Response:**\n1. Inspect the policy and user location to see if this
      was a login from approved location\n2. See if 2FA was authenticated\n3. If the
      user was compromised, rotate user credentials.\n\n[1][https://auth0.com/docs/anomaly-detection/brute-force-protection]\n","options":{"evaluationWindow":0,"maxSignalDuration":0,"keepAlive":0},"version":4,"createdAt":1596725044171,"filters":[],"queries":[{"distinctFields":[],"name":"breached_password","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:breached_password","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"breached_password
      > 0"}],"type":"threshold","id":"abt-ai6-dgv","isDefault":true,"name":"Auth0
      user logged in with a breached password"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect Account Take Over (ATO) through credential stuffing attack.\n\n##
      **Strategy:**\n**To determine a successful attempt:** Detect a high number of
      failed logins from at least ten unique users and at least one successful login
      for a user. This generates a `HIGH` severity signal.\n\n**To determine an unsuccessful
      attempt:** Detect a high number of failed logins from at least ten unique users.
      This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1. Inspect
      the logs to see if this was a valid login attempt.\n2. See if 2FA was authenticated\n3.
      If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725046890,"filters":[],"queries":[{"distinctFields":["@usr.id"],"name":"unique_users_failing_to_login","aggregation":"cardinality","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@network.client.ip"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"Successful","condition":"unique_users_failing_to_login>10
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"unique_users_failing_to_login>10"}],"type":"threshold","id":"jyz-j5r-dbj","isDefault":true,"name":"Credential
      stuffing attack on Auth0"},{"creationAuthorId":0,"tags":["source:auth0","security:attack","tactic:TA0006-credential-access","technique:T1110-brute-force"],"isEnabled":false,"hasExtendedTitle":true,"message":"##
      **Goal:**\nDetect a brute force attack on a user. \n\n## **Strategy:**\n**To
      determine a successful attempt:** Detect when the same user fails to login five
      times and then successfully logs in. This generates a `MEDIUM` severity signal.\n\n**To
      determine an unsuccessful attempt:** Detect when the same user fails to login
      five times. This generates an `INFO` severity signal.\n\n## **Triage & Response:**\n1.
      Inspect the logs to see if this was a valid login attempt.\n2. See if 2FA was
      authenticated\n3. If the user was compromised, rotate user credentials.\n\n","options":{"evaluationWindow":600,"maxSignalDuration":86400,"keepAlive":3600},"version":4,"createdAt":1596725050657,"filters":[],"queries":[{"distinctFields":[],"name":"failed_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:(failed_login_incorrect_password OR failed_login_invalid_email_or_username)","trackType":"logs"},{"distinctFields":[],"name":"successful_login","aggregation":"count","groupByFields":["@usr.id"],"query":"source:auth0
      @evt.name:success_login","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"Successful","condition":"failed_login>5
      && successful_login>=1"},{"status":"info","notifications":[],"name":"Attempt","condition":"failed_login>10"}],"type":"threshold","id":"u7m-qam-mqq","isDefault":true,"name":"Brute
      force attack on an Auth0 user"},{"creationAuthorId":0,"tags":["security:attack","tactic:TA0006-credential-access","technique:T1552-unsecured-credentials","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain resolves to the AWS Metadata IP (169.254.169.254).\n\n###
      Strategy\nInspect the Route 53 logs and determine if the response data for a
      DNS request matches the AWS Metadata IP (169.254.169.254). This could indicate
      an attacker is attempting to steal your credentials from the AWS metadata service.\n\n###
      Triage and Response\n1. Determine which instance is associated with the DNS
      request.\n2. Determine whether the domain name which was requested (`dns.question.name`)
      should be permitted. If not, conduct an investigation and determine what requested
      the domain and determine if the AWS metadata credentials were accessed by an
      attacker.\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352825520,"filters":[],"queries":[{"distinctFields":[],"name":"domain_resolve_to_metadata_ip","aggregation":"count","groupByFields":["instance-id"],"query":"source:route53
      @answers.Rdata:169.254.169.254","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"domain_resolve_to_metadata_ip
      > 0"}],"type":"threshold","id":"ccv-ip5-kow","isDefault":true,"name":"EC2 instance
      resolved a suspicious AWS metadata DNS query"},{"creationAuthorId":0,"tags":["security:attack","source:route53"],"isEnabled":true,"hasExtendedTitle":true,"message":"###
      Goal\nDetect when a requested domain has a suspicious TLD.\n\n### Strategy\nInspect
      the Route 53 logs and determine if the TLD of the DNS question (`@dns.question.name`)
      matches one of the top 5 TLDs on [Spamhaus''s Most Abused Top Level Domains
      list][1].\n\n### Triage and Response\n1. Determine which instance is associated
      with the DNS request.\n2. Determine whether the domain name which was requested
      (`dns.question.name`) should be permitted. If not, conduct an investigation
      and determine what requested the domain and determine if the AWS metadata credentials
      were accessed by an attacker.\n\n[1]: https://www.spamhaus.org/statistics/tlds/\n","options":{"evaluationWindow":300,"maxSignalDuration":3600,"keepAlive":3600},"version":1,"createdAt":1603352826881,"filters":[],"queries":[{"distinctFields":[],"name":"suspicious_tld","aggregation":"count","groupByFields":["instance-id"],"query":"@dns.question.name:(*.fit.
      OR *.work. OR *.webcam. OR *.loan. OR *.cf.)","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"medium","notifications":[],"name":"","condition":"suspicious_tld
      > 0"}],"type":"threshold","id":"kyr-eqk-odx","isDefault":true,"name":"EC2 instance
      requested a suspicious domain"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030255,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"9hy-bzg-pxd","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_OnlyRequiredFields-local-1605892029"},{"creationAuthorId":42577,"tags":[],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030277,"filters":[],"queries":[{"distinctFields":[],"name":"","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":[],"name":"","condition":"a
      > 0"}],"type":"threshold","id":"sgk-ds9-jzw","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Import-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1605892030297,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"wni-zyl-nke","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRule_Basic-local-1605892029"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606130137358,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"el6-wwo-tt9","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606130136"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606230157296,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"25j-s8v-x2t","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringRuleDatasource-local-1606230156"},{"creationAuthorId":42577,"tags":["i:tomato","u:tomato"],"isEnabled":true,"hasExtendedTitle":false,"message":"acceptance
      rule triggered","options":{"evaluationWindow":300,"maxSignalDuration":900,"keepAlive":600},"version":1,"createdAt":1606233623345,"filters":[],"queries":[{"distinctFields":[],"name":"first","metric":"","aggregation":"count","groupByFields":["host"],"query":"does
      not really match much","trackType":"logs"},{"distinctFields":["@orgId"],"name":"second","metric":"@network.bytes_read","aggregation":"cardinality","groupByFields":["host"],"query":"does
      not really match much either","trackType":"logs"}],"isDeleted":false,"cases":[{"status":"high","notifications":["@user"],"name":"high
      case","condition":"first > 3 || second > 10"},{"status":"medium","notifications":[],"name":"warning
      case","condition":"first > 0 || second > 0"}],"type":"threshold","id":"ern-ufg-zfk","isDefault":false,"name":"tf-TestAccDatadogSecurityMonitoringDefaultRule_Basic-local-1606233622"}]}'
    headers:
      Cache-Control:
      - no-cache
      Content-Disposition:
      - inline
      Content-Security-Policy:
      - frame-ancestors 'self'; report-uri https://api.datad0g.com/csp-report
      Content-Type:
      - application/json;charset=utf-8
      Date:
      - Thu, 26 Nov 2020 09:51:03 GMT
      Pragma:
      - no-cache
      Set-Cookie:
      - DD-PSHARD=1; Max-Age=604800; Path=/; expires=Thu, 03-Dec-2020 09:51:03 GMT;
        secure; HttpOnly
      Strict-Transport-Security:
      - max-age=15724800;
      Vary:
      - Accept-Encoding
      X-Content-Type-Options:
      - nosniff
      X-Dd-Version:
      - "35.3435668"
      X-Frame-Options:
      - SAMEORIGIN
    status: 200 OK
    code: 200
    duration: ""
